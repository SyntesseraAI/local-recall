---
id: 3dd88fc5-d621-4d72-8b1e-f0340a23162c
subject: >-
  The SearchEngine is passing the scope option correctly to vectorStore.search.
  But the...
applies_to: global
occurred_at: '2025-12-01T20:32:05.080Z'
content_hash: 41a8bdef4b06883c
---
The SearchEngine is passing the scope option correctly to vectorStore.search. But the vectorStore.search should be filtering. Let me debug by adding some logging and checking what's happening. Actually wait - I think the issue is that the VectorStore is a singleton. Let me check...

Looking at the singleton pattern in vector-store.ts, the `getVectorStore` function creates a singleton instance. When tests run, they might be sharing the same instance across test runs, causing data leakage between tests.

Actually, looking at the test setup, the tests create a new testDir each time, and they call `getVectorStore(testDir)`. But the singleton pattern in vector-store.ts returns the existing instance if one exists, ignoring the baseDir parameter!

Let me check the getVectorStore function:
