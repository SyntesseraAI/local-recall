---
id: 4d4592c5-de18-470f-ac43-d0b7257773c2
subject: >-
  I see the issue. The `spawn` function is being called with a `timeout` option
  on line 41, but this...
applies_to: global
occurred_at: '2025-11-30T15:04:41.114Z'
content_hash: c20624f23633e083
---
I see the issue. The `spawn` function is being called with a `timeout` option on line 41, but this option causes Node.js to kill the child process after the timeout, which throws an AbortError if not handled properly.

The problem is that when the timeout triggers via the spawn options, it causes an unhandled promise rejection. The code has its own timeout handler (lines 114-118), but the spawn's built-in timeout may be conflicting with it.

There are a few issues:
1. The `spawn` function has a `timeout: 30000` option that automatically aborts the child process
2. When this happens, it can trigger an unhandled AbortError
3. The code also has a manual timeout (lines 114-122) which creates a duplicate timeout mechanism

The fix should be to either:
1. Remove the `timeout` option from spawn and rely on the manual timeout
2. Or properly handle the abort error from spawn's timeout

Let me also check if there's any issue with the promise rejection handling. The `child.on('error')` handler resolves with an empty array, but the AbortError might be coming from somewhere else.

Looking at the Node.js documentation, when a child process is killed due to a timeout set via spawn options, it can throw an AbortError that needs to be caught.

The safest fix is to:
1. Remove the `timeout` option from spawn (since we have our own timeout handler)
2. Make sure we handle the SIGTERM properly

Let me also check if there are any issues with duplicate 'close' event listeners - I see two `child.on('close', ...)` handlers on lines 60 and 120, which is problematic.
