---
id: 8f6d8c8d-0af9-4054-baaa-8e5dd9257413
subject: >-
  Now let me fix the code. The best approach is to have `stop.ts` import and use
  the parsing function...
applies_to: global
occurred_at: '2025-11-29T22:15:20.301Z'
content_hash: 9ba2d52e4347150d
---
Now let me fix the code. The best approach is to have `stop.ts` import and use the parsing function from `transcript.ts` rather than maintaining duplicate logic.

Looking at `transcript.ts`, it has `parseRawMessage` function that correctly handles both text and thinking extraction. But it's not exported. I should either:
1. Export `parseRawMessage` from `transcript.ts` and use it in `stop.ts`
2. Or use the helper functions `extractTextFromBlocks` and `extractThinkingFromBlocks`

Actually, looking more closely at `transcript.ts`:
- `extractTextFromBlocks` and `extractThinkingFromBlocks` are not exported
- `parseRawMessage` is not exported
- Only `parseTranscript`, `extractNewMessages`, `analyzeForMemories`, and `readStdin` are exported

So I need to either:
1. Export the helper functions from `transcript.ts`
2. Or fix `stop.ts` inline

Given the structure, I think the cleanest fix is to:
1. Export the extraction functions from `transcript.ts`
2. Import and use them in `stop.ts`

Let me do that.
