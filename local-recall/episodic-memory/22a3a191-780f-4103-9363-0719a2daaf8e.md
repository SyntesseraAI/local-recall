---
id: 22a3a191-780f-4103-9363-0719a2daaf8e
subject: >-
  Memory extraction prompt requires [LOCAL_RECALL_INTERNAL] prefix for session
  guarding
keywords:
  - local_recall_internal
  - prefix
  - session-guarding
  - user-prompt-submit
  - memory-extraction
  - recursion-prevention
applies_to: 'file:src/hooks/user-prompt-submit.ts'
occurred_at: '2025-12-01T15:56:41.514Z'
content_hash: 03aecf1bda4a8dcc
---
The memory extraction prompt must include the `[LOCAL_RECALL_INTERNAL]` prefix at the beginning to enable proper session guarding and prevent recursive memory extraction loops.

The `user-prompt-submit.ts` hook checks for this prefix to distinguish between:
1. Regular user prompts (which trigger memory search)
2. Internal memory extraction prompts (which should skip memory injection to avoid circular dependencies)

Without this prefix, the hook will attempt to search memories for the memory extraction prompt itself, creating infinite recursion.
