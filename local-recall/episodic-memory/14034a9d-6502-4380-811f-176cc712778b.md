---
id: 14034a9d-6502-4380-811f-176cc712778b
subject: >-
  Mutex errors were caused by onnxruntime-node (fastembed dependency), not
  sqlite
keywords:
  - mutex
  - onnxruntime-node
  - fastembed
  - native bindings
  - concurrent processes
  - locking
applies_to: global
occurred_at: '2025-12-21T19:21:45.415Z'
content_hash: 380e62e6f4f19d60
---
After migrating from sqlite-vec to Orama, mutex errors persisted because the hooks were still loading `fastembed` directly, which depends on `onnxruntime-node`. This native module has the same mutex/locking issues as sqlite-vec when multiple concurrent processes try to load it.

The original daemon architecture was designed to solve this: a single daemon process would handle all fastembed operations, and hooks would call it via HTTP. This architecture was removed during the Orama migration but the problem with native bindings remains.

Solution implemented: File-based locking using `proper-lockfile` to serialize access to fastembed initialization and embedding operations across concurrent hook processes.
