---
id: 8de543d3-b809-4dec-832a-5acb00a99fb0
subject: Memory extraction handles both object and array responses from Claude CLI
keywords:
  - memory-extractor
  - claude-response-parsing
  - array-handling
  - zod-validation
applies_to: 'file:src/core/memory-extractor.ts'
occurred_at: '2025-12-01T16:01:49.770Z'
content_hash: c53dc453d107177e
---
## Issue Fixed
The `parseClaudeResponse` method expected Claude to return `{ memories: [...] }` but Claude (Haiku model) sometimes returns memories as a raw array `[...]`.

## Solution
Updated the parsing logic to handle both formats:
1. Check if response is an array - if so, wrap it as `{ memories: response }`
2. If it's an object, use it directly
3. Then validate with Zod schema

## Implementation
In `src/core/memory-extractor.ts`, the `parseClaudeResponse` method now:
- Attempts JSON parse
- If array: wraps as object with memories key
- If object: uses directly
- Validates against Zod schema

This makes the memory extraction more robust and handles both LLM response formats.
