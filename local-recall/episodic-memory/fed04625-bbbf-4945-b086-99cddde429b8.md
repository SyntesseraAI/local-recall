---
id: fed04625-bbbf-4945-b086-99cddde429b8
subject: User prompt submission hook architecture and keyword extraction
keywords:
  - hook
  - user-prompt-submit
  - keyword-extraction
  - claude-haiku
  - memory-search
  - architecture
applies_to: 'file:src/hooks/user-prompt-submit.ts'
occurred_at: '2025-12-01T16:15:45.848Z'
content_hash: 7811ac5b0e3551fc
---
# User Prompt Submit Hook Implementation

The UserPromptSubmit hook is triggered before Claude processes user input and uses Claude Haiku to extract keywords from prompts.

## Architecture

1. Receives JSON input via stdin containing:
   - `session_id`: Current session identifier
   - `transcript_path`: Path to current transcript
   - `cwd`: Current working directory
   - `prompt`: The user's submitted prompt text

2. Calls Claude Haiku with the `-p` flag to extract keywords from the prompt text
   - This is a synchronous operation (not async)
   - Uses the small model for efficiency

3. Searches memory index for matching keywords using fuzzy matching

4. Outputs matching memories to stdout (injected into Claude's context)

## Implementation Details

- The hook must complete within the timeout window (30 seconds configured in hooks.json)
- Keywords extracted are used for fuzzy matching against the memory index
- This provides context-aware memory injection before Claude responds
