---
id: dcfd74e9-1e62-4e0c-9069-0c39ad7690d7
subject: >-
  UserPromptSubmit hook searches both episodic and thinking memories with
  configurable thresholds
keywords:
  - user-prompt-submit
  - hook
  - search
  - thinking-memory
  - episodic-memory
applies_to: 'file:src/hooks/user-prompt-submit.ts'
occurred_at: '2025-12-21T19:19:15.418Z'
content_hash: 3213ca98e120e2b2
---
The UserPromptSubmit hook is a unified entry point that handles both episodic and thinking memory retrieval. It receives user prompts and performs semantic search based on configuration:

- Skips internal prompts containing [LOCAL_RECALL_INTERNAL] tag
- If episodicEnabled: searches episodic memories using vector store
- If thinkingEnabled: searches thinking memories using separate vector store
- Filters results by similarity threshold and token budget
- Combines results from both memory types and injects into context

Each memory type has independent configuration for max tokens and minimum similarity threshold (default 0.5), allowing fine-grained control over how much memory context to inject per prompt.
