---
id: 9de5ec2c-8ae9-45e0-b043-210e7229a6c2
subject: >-
  UserPromptSubmit hook causes infinite recursion by calling 'claude -p' which
  triggers itself
keywords:
  - userpromptsubmit
  - hook
  - recursion
  - infinite loop
  - claude command
  - subprocess
applies_to: 'file:src/hooks/user-prompt-submit.ts'
occurred_at: '2025-12-02T17:43:40.027Z'
content_hash: d28a3c23a9a11628
---
The UserPromptSubmit hook in src/hooks/user-prompt-submit.ts calls `claude -p` to extract keywords from user prompts. However, executing `claude -p` spawns a subprocess that triggers the same UserPromptSubmit hook, creating infinite recursion. This causes the hook to hang and timeout (30 second limit). The hook should NOT call Claude as a subprocess - instead it should use the vector store directly for semantic search without invoking Claude.
