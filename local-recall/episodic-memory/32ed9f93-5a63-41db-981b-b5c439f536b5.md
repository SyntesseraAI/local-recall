---
id: 32ed9f93-5a63-41db-981b-b5c439f536b5
subject: UserPromptSubmit hook causes infinite recursion when calling claude -p CLI
keywords:
  - hook
  - recursion
  - claude -p
  - user-prompt-submit
  - infinite loop
  - keyword extraction
applies_to: 'file:src/hooks/user-prompt-submit.ts'
occurred_at: '2025-12-02T07:10:48.826Z'
content_hash: 8bde400fcd65ce4b
---
The UserPromptSubmit hook is triggered for every prompt submission, including those from `claude -p` CLI calls. When the hook tries to call `claude -p` to extract keywords from user prompts, it creates an infinite recursion because each CLI invocation triggers the hook again. This is a critical architectural issue that needs to be resolved by either:

1. Detecting and skipping the hook for internal claude -p calls
2. Using an alternative method for keyword extraction that doesn't trigger the hook
3. Adding a flag or context to identify internal vs user prompts

The current implementation in user-prompt-submit.ts attempts to extract keywords but fails due to this recursion problem.
