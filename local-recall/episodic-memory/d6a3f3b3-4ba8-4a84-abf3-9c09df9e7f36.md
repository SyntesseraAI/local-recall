---
id: d6a3f3b3-4ba8-4a84-abf3-9c09df9e7f36
subject: Memory creation should handle duplicates idempotently
keywords:
  - memory-creation
  - deduplication
  - idempotent
  - content-hash
  - occurred-at
applies_to: 'file:src/core/memory.ts'
occurred_at: '2025-12-02T07:35:13.910Z'
content_hash: f483cb8f61a23ee4
---
# Idempotent Memory Creation

Memory creation is designed to be idempotent to prevent duplicates.

## Deduplication Strategy

- Each memory file includes `content_hash`: A SHA-256 hash prefix (16 chars) of the content
- Each memory includes `occurred_at`: ISO-8601 timestamp of when the original event occurred
- The `createMemory()` function checks for duplicates before creating new memories
- Uses `findDuplicate(occurredAt, contentHash)` to detect existing memories with the same content and timestamp
- If a duplicate exists, returns the existing memory ID instead of creating a new one

## Benefits

- Prevents the same memory from being created multiple times when the transcript is processed repeatedly
- Allows memory extraction to be safely re-run without creating duplicates
- The combination of `occurred_at` and `content_hash` provides a unique constraint
- Supports scenarios where the MCP server processes the same transcript multiple times
