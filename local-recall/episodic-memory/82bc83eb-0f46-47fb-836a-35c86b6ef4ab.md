---
id: 82bc83eb-0f46-47fb-836a-35c86b6ef4ab
subject: File locking mechanism for database initialization
keywords:
  - file lock
  - concurrent access
  - database initialization
  - resource sharing
applies_to: 'file:src/utils/database.ts'
occurred_at: '2025-12-03T10:22:44.117Z'
content_hash: 59b2061d57cd9af4
---
A file-based locking mechanism using a lock file at `{memoryDir}/.db.lock` was implemented to serialize database initialization. The lock is acquired with retry logic and released after initialization. Lock acquisition includes timing information and attempt counting. However, this approach only works within a single machine and only for file I/O - it cannot prevent the mutex error from sqlite-vec's internal C++ locking when multiple processes load the extension simultaneously.
