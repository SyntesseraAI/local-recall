---
id: 007ec209-360f-4189-9c21-00551b07488d
subject: Fix AbortError in user-prompt-submit hook by removing spawn timeout
keywords:
  - abort error
  - spawn timeout
  - child process
  - user-prompt-submit hook
  - error handling
applies_to: 'file:src/hooks/user-prompt-submit.ts'
occurred_at: '2025-12-21T19:20:27.934Z'
content_hash: 64c5cd6e49128671
---
The user-prompt-submit hook was throwing an uncaught AbortError when calling Claude for keyword extraction. The root cause was the `timeout` option in the `spawn` call (line 41), which Node.js kills via an AbortError that wasn't being caught.

**Solution**: Removed the `timeout` option from spawn and replaced it with a custom `safeResolve` wrapper that ensures the promise resolves only once. This prevents race conditions and properly handles both normal completion and timeout scenarios.

**Additional fixes**: Removed duplicate `child.on('close', ...)` handlers that could cause multiple resolutions and added an early-exit guard in the close handler.

This ensures the hook completes gracefully without throwing unhandled promise rejections.
