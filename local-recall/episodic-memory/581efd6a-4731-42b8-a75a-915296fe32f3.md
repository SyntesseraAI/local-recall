---
id: 581efd6a-4731-42b8-a75a-915296fe32f3
subject: Fix AbortError in user-prompt-submit hook's Claude CLI subprocess handling
keywords:
  - abort error
  - spawn timeout
  - child process
  - promise rejection
  - user-prompt-submit hook
applies_to: 'file:src/hooks/user-prompt-submit.ts'
occurred_at: '2025-12-02T06:39:38.532Z'
content_hash: ec396d675bb9cc4d
---
The user-prompt-submit hook was throwing an unhandled AbortError when calling Claude CLI for keyword extraction. The issue was caused by:

1. **Root cause**: The `spawn()` function's AbortSignal was being passed to the subprocess, which rejected the promise with AbortError when the timeout occurred. This unhandled promise rejection crashed the hook.

2. **Solution**: Added proper error handling with a try-catch block around the `subprocess()` call to catch and handle the AbortError gracefully. The error handler logs the timeout and allows the function to continue without extracting keywords.

3. **Key learning**: AbortSignal timeouts cause the entire spawn promise to reject - they don't just kill the process. The promise rejection must be caught and handled explicitly.

4. **Implementation**: The fix wraps the subprocess call in try-catch, catches `AbortError`, logs it with context, and returns an empty keywords array as fallback.
