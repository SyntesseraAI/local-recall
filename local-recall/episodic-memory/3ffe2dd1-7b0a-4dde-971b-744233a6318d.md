---
id: 3ffe2dd1-7b0a-4dde-971b-744233a6318d
subject: >-
  Stop hook processes transcripts asynchronously via MCP server daemon, not
  synchronously
keywords:
  - stop-hook
  - mcp-server
  - daemon
  - async
  - transcript-processing
  - memory-extraction
applies_to: 'area:memory-extraction'
occurred_at: '2025-12-01T16:27:22.444Z'
content_hash: ecd456349d4dc311
---
# Stop Hook Architecture

The Stop hook in local-recall does **not** process transcripts synchronously. Instead:

1. The Stop hook is currently **disabled**
2. Memory extraction is handled by the **MCP server daemon**
3. The daemon processes transcripts **asynchronously every 5 minutes**
4. Transcripts are synced from Claude's cache and converted to memories

## Why This Design?

- **Performance**: Stop hook runs synchronously and can't block Claude's session end
- **Reliability**: Daemon can retry on failure without blocking the user
- **Flexibility**: Background processing allows for complex transcript analysis

## Important Implication

Memories from a session won't be immediately available - they'll be indexed within 5 minutes when the daemon runs. This is a design trade-off for performance.

See `src/mcp-server/server.ts` for daemon implementation.
