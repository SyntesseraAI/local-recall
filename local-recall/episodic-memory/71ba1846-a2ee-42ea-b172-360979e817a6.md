---
id: 71ba1846-a2ee-42ea-b172-360979e817a6
subject: >-
  Backward compatibility required for transcript parsing to support both old and
  new formats
keywords:
  - backward compatibility
  - transcript format
  - parsing
  - format detection
applies_to: 'file:src/utils/transcript.ts'
occurred_at: '2025-12-21T18:29:39.576Z'
content_hash: c877f5d40551c493
---
When updating transcript parsing to support new Claude Code format with content blocks, backward compatibility is essential:

- Tests and existing code may use the old string-based `content` format
- New production Claude Code transcripts use the content blocks array format
- Solution: Implement format detection that tries new format first, then falls back to legacy
- Use `extractThinkingFromContent()` helper to parse content blocks and extract thinking
- Silently skip invalid messages rather than throwing errors (better for real-world transcripts)

This ensures old test data continues to work while supporting new transcript format.
