---
id: 67034c2e-0f14-4504-a997-9c9868678339
subject: 'UserPromptSubmit hook prevents recursion with [LOCAL_RECALL_INTERNAL] token'
keywords:
  - recursion guard
  - internal prompts
  - user prompt submit
  - token-based skipping
  - extraction process
applies_to: 'file:src/hooks/user-prompt-submit.ts'
occurred_at: '2025-12-21T19:43:18.015Z'
content_hash: f003e2d7d953986d
---
The UserPromptSubmit hook can create recursive loops when calling `claude -p` for memory extraction. To prevent this, internal extraction prompts should be prefixed with `[LOCAL_RECALL_INTERNAL]` token at the start. The hook checks `prompt.startsWith('[LOCAL_RECALL_INTERNAL]')` to skip internal prompts. Additionally, `--strict-mcp-config` flag is passed to the claude subprocess to disable MCP servers during extraction, providing an extra layer of recursion prevention.
