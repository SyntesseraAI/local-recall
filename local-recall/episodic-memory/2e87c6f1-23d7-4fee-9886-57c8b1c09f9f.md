---
id: 2e87c6f1-23d7-4fee-9886-57c8b1c09f9f
subject: Thinking extraction requires backward compatibility with test format
keywords:
  - transcript parsing
  - backward compatibility
  - thinking messages
  - test format
applies_to: 'file:src/utils/transcript.ts'
occurred_at: '2025-12-21T19:23:27.035Z'
content_hash: e4c5390c4fe4ae3a
---
The transcript parser must support both formats:
1. **Real Claude Code format** - `content` as array of blocks with `type` field
2. **Test format** - Messages with `role` and `content` as string (used in existing tests)

The `parseMessage` function tries the real format first (looking for `type` field), then falls back to the test format (looking for `role` field). This ensures backward compatibility while supporting the new thinking block extraction.

Thinking is extracted from content blocks during parsing and stored in the normalized `TranscriptMessage.thinking` field.
