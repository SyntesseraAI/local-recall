---
id: b798c79f-51cc-4ec4-b358-1f5af0105122
subject: >-
  Session start hook must be idempotent and handle multiple calls within same
  session
keywords:
  - hooks
  - session-start
  - idempotent
  - multiple-invocations
  - memory-injection
  - context-injection
applies_to: 'file:src/hooks/session-start.ts'
occurred_at: '2025-12-02T12:27:44.947Z'
content_hash: 710a16bb95f4b228
---
# SessionStart Hook Idempotency Requirement

## Key Discovery

The SessionStart hook can be called multiple times within a single session without causing issues. It must be designed to be idempotent.

## Behavior

- Hook is triggered at the beginning of a Claude Code session
- May be invoked multiple times if user restarts session or re-opens the same project
- Should return the same 5 most recent memories each time
- Memories are injected into Claude's context via stdout

## Implementation Details

From `src/hooks/session-start.ts`:
- Loads all memories from disk via `MemoryManager.listMemories()`
- Returns top 5 most recent memories (sorted by `occurred_at`)
- Does NOT use the vector store (to avoid slow initialization)
- Does NOT modify any state that would change on subsequent calls

## Why This Matters

If the hook stored session state or had side effects, multiple invocations could:
- Corrupt memory state
- Cause duplicate memory injection
- Slow down performance by reinitializing resources unnecessarily

The current implementation avoids all these issues by being purely functional.
