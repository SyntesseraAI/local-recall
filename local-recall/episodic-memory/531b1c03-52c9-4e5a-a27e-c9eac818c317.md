---
id: 531b1c03-52c9-4e5a-a27e-c9eac818c317
subject: 'Memory extraction workflow: transcript processing and deduplication'
keywords:
  - memory-extraction
  - transcript-parsing
  - deduplication
  - content-hash
  - occurred-at
  - idempotent
applies_to: 'area:memory-lifecycle'
occurred_at: '2025-12-02T01:00:56.407Z'
content_hash: a9143c517081a72f
---
# Memory Extraction Workflow

## Key Concept: Idempotent Memory Creation

Memories must be created idempotently - calling the memory creation function multiple times with the same content should not create duplicates.

## Deduplication Strategy

The system uses two fields to detect duplicates:
1. **`occurred_at`** - Timestamp of when the original event occurred
2. **`content_hash`** - SHA-256 hash prefix (first 16 characters) of the memory content

When creating a memory:
- Calculate the content hash of the memory body
- Check if a memory with matching `occurred_at` AND `content_hash` already exists
- If found, return the existing memory ID instead of creating a duplicate
- If not found, create the new memory

## Implementation Notes

- `occurred_at` should be the timestamp from the transcript event, not the current time
- Content hash is calculated from the actual memory content (post-formatting)
- This allows the same memory to be recreated from different transcripts without duplication
- See `src/core/memory.ts` `findDuplicate()` function for implementation
