---
id: 665522d6-a987-44a7-be07-a05911faaa71
subject: Test mocking structure for Claude CLI invocation in memory extractor tests
keywords:
  - memory-extractor
  - testing
  - mocking
  - spawn
  - child-process
applies_to: 'file:tests/unit/core/memory-extractor.test.ts'
occurred_at: '2025-12-21T19:22:56.476Z'
content_hash: ff9871f38cab91de
---
When testing `callClaudeCLI`, mock the entire child process: both `spawn()` for the claude command and `spawn()` for the stdin cat command. Properly simulate stdout/stderr/exit events on mock child processes. The test structure mirrors the internal pipe-based message passing used when sending large prompts via stdin.
