---
id: cdca8109-596a-4d87-9e04-32033270c341
subject: Readonly mode for vector stores in hooks to avoid concurrent writes
keywords:
  - readonly
  - hooks
  - vector-store
  - search
  - concurrency
applies_to: 'file:src/core/vector-store.ts file:src/core/thinking-vector-store.ts'
occurred_at: '2025-12-03T09:48:06.256Z'
content_hash: 34a63415b26d2224
---
Vector stores (`VectorStore` and `ThinkingVectorStore`) now support a `readonly` option that opens the SQLite database in read-only mode. This is used by hooks (UserPromptSubmit, SessionStart) which only perform searches.

**Implementation**:
- Added `VectorStoreOptions` interface with `readonly` boolean property
- `getVectorStore()` and `getThinkingVectorStore()` now accept options parameter
- Hooks call `getVectorStore({ basePath, readonly: true })` to avoid write locks
- Daemon/main process uses default writable mode for add/sync operations

**Benefit**: Completely eliminates mutex contention between hooks and daemon since hooks can't acquire write locks.
