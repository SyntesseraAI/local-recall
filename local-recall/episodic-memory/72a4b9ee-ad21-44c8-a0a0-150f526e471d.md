---
id: 72a4b9ee-ad21-44c8-a0a0-150f526e471d
subject: UserPromptSubmit hook causes infinite recursion when calling claude -p CLI
keywords:
  - hook
  - recursion
  - claude-p
  - user-prompt-submit
  - stdin
  - bug
  - infinite-loop
applies_to: 'file:src/hooks/user-prompt-submit.ts'
occurred_at: '2025-12-01T21:26:14.992Z'
content_hash: 77ed10416d0fd5c6
---
The UserPromptSubmit hook invokes `claude -p` to extract keywords from user prompts. This creates a recursion problem: the inner Claude process also triggers UserPromptSubmit hook, which calls `claude -p` again, creating infinite recursion.

**Root Cause:** The hook receives prompt text via stdin and immediately passes it to `claude -p`, but the inner Claude instance also triggers the same hook.

**Solution:** The hook should not pass user input directly to `claude -p`. Instead, it should either:
1. Extract keywords using a local NLP method (not requiring Claude)
2. Use a different approach that doesn't re-trigger the hook
3. Implement safeguards to prevent nested hook execution (e.g., environment variable flag)

**Current Status:** Hook is disabled pending a fix for this recursion issue.
