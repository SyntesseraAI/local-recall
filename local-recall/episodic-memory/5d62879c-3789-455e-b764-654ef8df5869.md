---
id: 5d62879c-3789-455e-b764-654ef8df5869
subject: Memory file structure uses SHA-256 content hash for deduplication
keywords:
  - memory
  - deduplication
  - content-hash
  - sha256
  - frontmatter
  - occurred-at
  - idempotent
applies_to: 'file:src/core/memory.ts'
occurred_at: '2025-12-01T16:12:57.387Z'
content_hash: 8b107b9b0929ba81
---
# Memory Deduplication Strategy

Memory files use content hashing for deduplication to prevent duplicate memories from being created when the same information is processed multiple times.

## Deduplication Fields

1. **content_hash**: SHA-256 hash of the memory content (16 character prefix)
   - Located in YAML frontmatter
   - Calculated from the actual memory content (everything after frontmatter)
   - Used to detect identical content across different times

2. **occurred_at**: ISO-8601 timestamp
   - When the original event occurred
   - Used to identify if two memories refer to the same event from different transcripts

## Duplicate Detection Logic

The `findDuplicate()` function checks for existing memories with:
- Same `occurred_at` timestamp AND
- Same `content_hash` value

If a duplicate is found, the existing memory is returned instead of creating a new one.

## Implementation Note

This design allows the MCP server daemon to safely process transcripts multiple times without creating duplicate memories, making the system idempotent.
