---
id: cebcc475-b0bd-4547-8fdd-8b758c124855
subject: Mutex errors caused by concurrent sqlite-vec operations across processes
keywords:
  - sqlite-vec
  - mutex
  - concurrent
  - database
  - locking
  - file-based
applies_to: global
occurred_at: '2025-12-21T19:11:29.598Z'
content_hash: 59b04848435d8e22
---
The mutex errors ('mutex lock failed: Invalid argument') were caused by concurrent database operations attempting to use sqlite-vec simultaneously. The issue manifested when:

1. Multiple processes (hooks) opened separate database connections
2. Each loaded sqlite-vec into their connection
3. Concurrent operations caused sqlite-vec's internal mutexes to become corrupted

The original file lock only protected the `sqliteVec.load()` call, not the subsequent vector operations. Solution: implemented cross-process file-based locking in `withDbMutex()` to serialize ALL database operations, preventing concurrent access at the SQLite level.
