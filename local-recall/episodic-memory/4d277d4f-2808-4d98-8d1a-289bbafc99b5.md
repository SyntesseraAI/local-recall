---
id: 4d277d4f-2808-4d98-8d1a-289bbafc99b5
subject: Session guarding implementation for memory extraction prompts
keywords:
  - session guarding
  - LOCAL_RECALL_INTERNAL
  - memory extraction
  - prefix guard
  - recursion prevention
applies_to: global
occurred_at: '2025-12-21T19:23:52.480Z'
content_hash: ead4922eb65bbc57
---
The UserPromptSubmit hook filters internal prompts by checking for the `[LOCAL_RECALL_INTERNAL]` prefix to prevent recursive processing. The memory extraction prompt from `buildMemoryExtractionPrompt()` in `src/prompts/memory-extraction.ts` must include this prefix (e.g., `[LOCAL_RECALL_INTERNAL] You are analyzing a Claude Code session transcript...`) so that when the MCP daemon calls `claude -p` for memory extraction, the hook detects it and skips processing. Without this prefix, the memory extraction prompt itself gets processed by the hook, causing infinite recursion.
