---
id: 20831636-c874-45e8-b7ac-362cae97b9a6
subject: Memory extraction prompt and test structure in place
keywords:
  - memory-extractor
  - prompts
  - testing
  - callClaudeCLI
  - stripMarkdownCodeBlocks
applies_to: 'file:src/core/memory-extractor.ts'
occurred_at: '2025-12-21T18:15:07.227Z'
content_hash: fb83d7d598674787
---
# Memory Extractor Architecture

## Key Components

1. **Memory Extraction Prompt** (`src/prompts/memory-extraction.ts`)
   - Detailed prompt template for extracting structured memories from transcripts
   - Outputs JSON with memory objects containing subject, keywords, applies_to, content fields

2. **callClaudeCLI Method** (`src/core/memory-extractor.ts:75-128`)
   - Invokes Claude via CLI to process transcripts
   - Handles markdown code block responses with `stripMarkdownCodeBlocks` utility
   - Previously had no explicit model specification (defaulted to claude-3-5-sonnet)

3. **Test Coverage** (`tests/unit/core/memory-extractor.test.ts`)
   - 32 unit tests covering various extraction scenarios
   - Tests verify memory structure, keyword extraction, scope detection
   - All tests pass with Haiku implementation

## Configuration

Memory extraction is part of the MCP server daemon which processes transcripts asynchronously every 5 minutes. This is a high-frequency operation making model choice (Haiku vs Sonnet) significant for cost and performance.
