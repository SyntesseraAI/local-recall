---
id: d019093d-008e-4932-9884-b94f606976d6
subject: >-
  UserPromptSubmit hook needs recursion guard using [LOCAL_RECALL_INTERNAL]
  token
keywords:
  - recursion guard
  - hook
  - internal prompts
  - extraction
  - mcp config
applies_to: 'file:src/hooks/user-prompt-submit.ts'
occurred_at: '2025-12-21T18:25:22.045Z'
content_hash: f46b153db5aa7c50
---
When the UserPromptSubmit hook calls `claude -p` for extraction, it triggers another UserPromptSubmit hook recursion. Solution: prefix internal extraction prompts with [LOCAL_RECALL_INTERNAL] token and skip any prompts starting with this token. Also pass --strict-mcp-config to disable MCP servers during internal extraction calls to prevent cascading recursion.
