---
id: a5563863-e281-4906-aeaf-e14aa2860aac
subject: >-
  Stop hook workflow uses claude -p to process transcripts and extract memories
  asynchronously
keywords:
  - stop-hook
  - transcript
  - memory-extraction
  - claude-haiku
  - keywords
  - async
  - mcp-server
applies_to: global
occurred_at: '2025-12-01T15:55:36.260Z'
content_hash: 3accd997c9777d05
---
The Stop hook (`src/hooks/stop.ts`) and MCP server daemon implement an asynchronous memory extraction workflow:

**Workflow**:
1. Hook/daemon reads transcript files from `~/.claude/projects/<project>/transcripts/`
2. Uses `claude -p --model haiku` to extract keywords from transcript content
3. Parses extracted keywords and transcript events into memory objects
4. Creates memories using the Memory Manager (idempotent operation)
5. Tracks processed transcripts to detect changes

**Key Characteristics**:
- Uses `claude -p` for intelligent keyword extraction (Claude Haiku model)
- Memories are created asynchronously to avoid blocking user interaction
- MCP server daemon runs every 5 minutes to process transcripts
- Transcript processing is idempotent - same transcript won't create duplicates
- Handles transcript updates by deleting old memories and creating new ones

**Important**: This is the preferred approach over the disabled Stop hook, as it avoids blocking the user's session end.
