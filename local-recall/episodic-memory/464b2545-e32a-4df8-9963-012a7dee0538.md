---
id: 464b2545-e32a-4df8-9963-012a7dee0538
subject: UserPromptSubmit hook recursion prevention using LOCAL_RECALL_INTERNAL token
keywords:
  - hook
  - recursion
  - local_recall_internal
  - token
  - user-prompt-submit
  - extraction
applies_to: 'file:src/hooks/user-prompt-submit.ts'
occurred_at: '2025-12-01T16:24:31.080Z'
content_hash: d3fa6694835309d5
---
The UserPromptSubmit hook uses the `[LOCAL_RECALL_INTERNAL]` token prefix to identify internal memory extraction calls. When the hook needs to call `claude -p` for keyword extraction, it prefixes the prompt with this token. The hook checks if incoming prompts start with this token and skips processing them to prevent recursive firing. The claude command also uses `--strict-mcp-config` to disable MCP servers during keyword extraction, adding another layer of recursion protection.
