---
id: 10bd0a05-d39e-4900-bbe6-727b7ac9bb20
subject: >-
  Use [LOCAL_RECALL_INTERNAL] token prefix to prevent recursive UserPromptSubmit
  hook execution
keywords:
  - recursion-guard
  - user-prompt-submit
  - hook
  - internal-token
  - extraction-process
applies_to: 'file:src/hooks/user-prompt-submit.ts'
occurred_at: '2025-12-21T18:23:40.594Z'
content_hash: e7b7908c39c18337
---
The UserPromptSubmit hook calls `claude -p` with --strict-mcp-config to extract keywords, which would normally trigger another UserPromptSubmit hook. To prevent this recursive loop, prefix internal prompts with [LOCAL_RECALL_INTERNAL] token and check for it at the start of prompts using startsWith('[LOCAL_RECALL_INTERNAL]'). This allows the hook to skip extraction-related calls while still allowing users to test with extraction prompts manually.
