---
id: c4306ed3-f343-4c66-93f5-f081b820459d
subject: ONNX runtime mutex errors prevent concurrent hook execution in fastembed
keywords:
  - onnx
  - mutex
  - concurrency
  - fastembed
  - embedding
  - hooks
  - race-condition
applies_to: global
occurred_at: '2025-12-21T18:24:57.085Z'
content_hash: d5965851d4cee9e7
---
The project experienced mutex errors when running multiple Claude instances concurrently. The root cause is NOT sqlite-vec (which was replaced with Orama), but rather **ONNX runtime** (used by fastembed for embeddings). When multiple processes initialize the ONNX model concurrently (e.g., in user-prompt-submit hooks), the ONNX runtime's internal mutex causes crashes. The `proper-lockfile` file-based locking doesn't prevent ONNX's kernel-level mutex issues. This is a fundamental limitation of ONNX - multiple processes can't safely initialize it simultaneously.
