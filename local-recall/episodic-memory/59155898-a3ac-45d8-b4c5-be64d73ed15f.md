---
id: 59155898-a3ac-45d8-b4c5-be64d73ed15f
subject: >-
  Claude Code streams thinking and text as separate JSONL lines with same
  message.id
keywords:
  - thinking extraction
  - jsonl parsing
  - message grouping
  - transcript format
  - thinking memories
applies_to: 'file:src/core/thinking-extractor.ts'
occurred_at: '2025-12-03T09:47:36.366Z'
content_hash: 4779ba7c1306a98c
---
Claude Code streams assistant responses as separate JSONL lines - each content block (thinking, text, tool_use) gets its own line but they share the same `message.id`. The thinking extractor was expecting them in the same content array. Fixed by:

1. Parsing all JSONL lines from transcript
2. Grouping entries by `message.id` using a Map
3. Aggregating thinking and text content from entries with the same message ID
4. Creating thinking memory pairs from the grouped content

Lines 89-159 in thinking-extractor.ts now correctly groups by message ID before extracting thinking blocks.
