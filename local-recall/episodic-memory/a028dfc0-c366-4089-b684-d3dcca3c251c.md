---
id: a028dfc0-c366-4089-b684-d3dcca3c251c
subject: Memory lifecycle spans multiple sessions via MCP server daemon
keywords:
  - memory-lifecycle
  - mcp-server
  - daemon
  - background-processing
  - transcript-processing
applies_to: global
occurred_at: '2025-12-02T06:44:10.733Z'
content_hash: c789ec12f08e4df3
---
# Memory Lifecycle Architecture

## Overview

Memories are created through an asynchronous lifecycle managed by the MCP server daemon:

1. **Session 1-N:** User interacts with Claude via hooks (SessionStart, UserPromptSubmit)
2. **Daemon Process:** MCP server runs background job every 5 minutes
3. **Memory Creation:** Daemon processes transcripts and extracts memories
4. **Persistence:** Created memories are stored and indexed

## Key Components

### SessionStart Hook
- Triggered at session start
- Loads existing memory index
- Injects relevant memories into Claude's context
- No memory creation at this stage

### UserPromptSubmit Hook  
- Triggered before Claude processes user prompt
- Extracts keywords from prompt using Claude Haiku
- Searches memory index for matches
- Injects matching memories into context
- No memory creation at this stage

### Stop Hook
- Currently disabled
- Memory extraction now handled by MCP daemon instead

### MCP Server Daemon
- Runs asynchronously in background (every 5 minutes)
- Syncs transcripts from `~/.claude/projects/<project>/transcripts/`
- Processes transcripts using `claude -p` (prompt caching)
- Extracts memories from transcript content
- Tracks processed transcripts with content hashes for change detection
- Deletes and recreates memories when transcripts change

## Important Implications

- Memories are **not created immediately** after conversations
- Memory extraction happens asynchronously via daemon
- Multiple sessions contribute to the same memory index
- Content hash tracking prevents duplicate processing
- The daemon is the single source of truth for memory creation
