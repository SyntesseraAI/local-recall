---
id: dfe0f495-3327-4fe8-aa77-03aff1687df3
subject: User-prompt-submit hook architecture and keyword extraction workflow
keywords:
  - user-prompt-submit
  - keyword extraction
  - claude cli
  - memory search
  - hook workflow
applies_to: 'file:src/hooks/user-prompt-submit.ts'
occurred_at: '2025-12-01T15:58:30.716Z'
content_hash: 0338c88e0a6eed15
---
The user-prompt-submit hook follows this workflow:

1. **Receives Input**: JSON with session_id, transcript_path, cwd, and user's prompt
2. **Extract Keywords**: Calls Claude Haiku via `callClaudeForKeywords()` to extract relevant keywords from the user's prompt
   - Uses `claude -p --model haiku` subprocess call
   - Has 5-second timeout via AbortSignal
   - Must be wrapped with proper error handling
3. **Search Memories**: Uses extracted keywords to search the memory index via `searchByKeywords()`
4. **Output Results**: Sends matching memories to stdout for injection into Claude's context

## Error Handling Requirement
The keyword extraction step must have robust error handling because:
- The subprocess can timeout
- Claude CLI may not be available
- Promise rejections need to be caught, not allowed to propagate
- Hook should degrade gracefully and continue with empty keywords if extraction fails
