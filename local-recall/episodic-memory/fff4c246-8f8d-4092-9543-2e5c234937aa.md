---
id: fff4c246-8f8d-4092-9543-2e5c234937aa
subject: >-
  UserPromptSubmit hook infinite recursion when calling claude -p without
  disabling hooks
keywords:
  - userpromptsubmit
  - hook
  - claude -p
  - recursion
  - abort error
  - child process
applies_to: 'file:src/hooks/user-prompt-submit.ts'
occurred_at: '2025-12-01T21:16:11.067Z'
content_hash: 79d9e3086f42c114
---
When the UserPromptSubmit hook calls `claude -p` to extract keywords from user prompts, it triggers the UserPromptSubmit hook again, causing infinite recursion. This results in an abort error from the child process.

**Solution:** Disable hooks when invoking Claude internally by using `claude -p --hooks=off` or similar mechanism. This prevents the cascade of recursive hook invocations.

**Root cause:** The hook is invoked on every prompt submission, including prompts generated internally by Claude itself when processing with `-p`.

**Impact:** Critical - prevents the system from functioning at all when trying to use Claude for keyword extraction.
