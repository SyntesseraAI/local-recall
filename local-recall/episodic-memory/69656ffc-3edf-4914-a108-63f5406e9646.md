---
id: 69656ffc-3edf-4914-a108-63f5406e9646
subject: Mutex errors caused by onnxruntime-node native bindings in fastembed
keywords:
  - mutex
  - fastembed
  - onnxruntime-node
  - native bindings
  - concurrent processes
  - hooks
applies_to: global
occurred_at: '2025-12-21T18:27:48.823Z'
content_hash: 512db5d6644aef2f
---
After migrating from sqlite-vec to Orama, mutex errors persisted because fastembed (used for embeddings) depends on onnxruntime-node which has native bindings. When multiple hook processes load onnxruntime-node concurrently, mutex contention occurs - same issue as sqlite-vec had.

The solution implemented: file-based locking using proper-lockfile to serialize access to fastembed initialization and embedding operations. Lock file at `/tmp/local-recall-embedding.lock` with 10 retries and 30-second stale timeout.
