---
id: 6945cd79-7b03-42fe-b3f0-082fbfb4801b
subject: Memory deduplication uses occurred_at timestamp and content_hash
keywords:
  - deduplication
  - memory-creation
  - occurred-at
  - content-hash
  - idempotent
applies_to: 'file:src/core/memory.ts'
occurred_at: '2025-12-01T15:56:51.922Z'
content_hash: e94bb227152e31a1
---
# Memory Deduplication Strategy

The memory system uses two fields to detect and prevent duplicate memories:

## Fields Used

1. **occurred_at** - ISO-8601 timestamp of when the original event occurred
2. **content_hash** - SHA-256 hash prefix (16 characters) of the memory content

## Deduplication Logic

Before creating a new memory, `findDuplicate(occurredAt, contentHash)` checks:
- Searches existing memories for matching `occurred_at` and `content_hash` combination
- If found, returns the existing memory ID instead of creating a new one
- If not found, proceeds with memory creation

## Implications

- `createMemory()` is idempotent - calling it multiple times with the same data is safe
- Same event processed multiple times won't create duplicate memories
- Timestamp precision is important - ensure consistent timestamp formatting
- Content hash should be stable - identical content always produces the same hash

## Usage Pattern

This allows safe re-processing of transcripts:
1. Transcript collector can reprocess transcripts without worrying about duplicates
2. If a transcript hasn't changed (same content hash), no new memories created
3. If transcript changes, old memories are deleted and new ones created
