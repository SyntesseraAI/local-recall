---
id: 14845082-1cef-40ef-8100-ca96b8f65bf0
subject: UserPromptSubmit hook calls claude -p which triggers the same hook recursively
keywords:
  - userpromptsubmit
  - hook
  - claude
  - recursion
  - infinite loop
  - keyword extraction
applies_to: 'file:src/hooks/user-prompt-submit.ts'
occurred_at: '2025-12-01T16:06:09.385Z'
content_hash: 0cdcf43b0efb5944
---
The UserPromptSubmit hook invokes `claude -p` to extract keywords from user prompts. However, this command execution triggers the UserPromptSubmit hook again within the child process, creating a recursive loop. This can cause performance issues and needs to be prevented by either:

1. Skipping hook execution when invoked from within a hook context
2. Using environment variables to detect recursive invocations
3. Refactoring to avoid calling claude -p from within the hook

The hook is located in src/hooks/user-prompt-submit.ts and needs safeguards against this recursion.
