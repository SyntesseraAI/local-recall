---
id: 70e2cddd-5fb5-484f-9b3c-9382e48cfdfd
subject: >-
  Architecture: user-prompt-submit hook uses sync keyword extraction via Claude
  CLI
keywords:
  - user-prompt-submit
  - keywords
  - extraction
  - claude cli
  - callClaudeForKeywords
  - semantic search
applies_to: 'file:src/hooks/user-prompt-submit.ts'
occurred_at: '2025-12-21T19:20:20.014Z'
content_hash: 2d8ae1c5425e1a4a
---
## Implementation Detail
The user-prompt-submit hook extracts keywords from user prompts by calling the Claude CLI synchronously via `spawn()`. This happens inside `callClaudeForKeywords()` function.

## Process Flow
1. Hook receives user prompt text
2. Calls `callClaudeForKeywords()` which spawns `claude` command with internal prompt
3. Waits for Claude to extract structured keywords from the prompt
4. Returns extracted keywords for memory search

## Important Note
This uses `[LOCAL_RECALL_INTERNAL]` prefix in prompts to indicate these are internal system prompts used for memory extraction, not user-facing interactions. The hook specifically skips processing when this prefix is detected to avoid recursive loops.

## Configuration
The timeout behavior is controlled via spawn options - ensure any timeout implementation properly handles process abortion.
