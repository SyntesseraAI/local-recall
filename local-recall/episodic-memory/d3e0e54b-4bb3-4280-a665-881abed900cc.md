---
id: d3e0e54b-4bb3-4280-a665-881abed900cc
subject: >-
  Local Recall memory extraction pipeline uses claude -p for interactive memory
  parsing
keywords:
  - memory-extraction
  - claude
  - subprocess
  - interactive-prompt
  - transcript-processing
  - pipeline
applies_to: 'area:memory-extractor'
occurred_at: '2025-12-02T17:40:01.978Z'
content_hash: bdee4341da25e6cc
---
# Memory Extraction Pipeline Architecture

Local Recall's memory extraction uses Claude in interactive prompt mode (`claude -p`) to parse transcripts and identify valuable memories.

## Process Flow

1. **Transcript Collection**: `transcript-collector.ts` gathers JSONL transcripts from `~/.claude/projects/`
2. **Condensing**: `transcript-condenser.ts` summarizes transcript events into a compact format
3. **Extraction**: `memory-extractor.ts` calls `claude -p` with condensed transcript
4. **Parsing**: Claude returns structured memory data that's converted to markdown files
5. **Storage**: New memories are written to `local-recall/episodic-memory/`
6. **Deduplication**: Existing memories with same `occurred_at` and `content_hash` are skipped

## Claude Interactive Prompt Usage

The `claude -p` command is used for interactive processing:
- Input: Condensed transcript via stdin
- Output: Structured memory data (JSON or markdown)
- Timeout: Should be configured appropriately for transcript size

## Important Considerations

- Memory extraction must be deterministic (same input = same output) for proper deduplication
- The MCP server runs extraction asynchronously every 5 minutes
- Processed transcripts are tracked via `processed-log.ts` to avoid re-processing
- Memory subject, keywords, and scope must follow the format defined in CLAUDE.md
