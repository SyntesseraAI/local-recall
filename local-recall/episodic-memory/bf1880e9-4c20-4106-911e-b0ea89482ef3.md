---
id: bf1880e9-4c20-4106-911e-b0ea89482ef3
subject: >-
  Session guarding requires [LOCAL_RECALL_INTERNAL] prefix on memory extraction
  prompts
keywords:
  - session guarding
  - memory extraction
  - internal prompt
  - recursion prevention
  - user prompt submit hook
applies_to: global
occurred_at: '2025-12-21T18:29:11.578Z'
content_hash: 4f73fd3e76a00614
---
The UserPromptSubmit hook filters prompts with `[LOCAL_RECALL_INTERNAL]` prefix to prevent recursive processing of internal memory extraction prompts. The memory extraction prompt in `buildMemoryExtractionPrompt()` must include this prefix, otherwise the MCP daemon's `claude -p` calls for memory extraction will trigger the hook and create unwanted recursion. The guard is checked at line 161 of `user-prompt-submit.ts`.
