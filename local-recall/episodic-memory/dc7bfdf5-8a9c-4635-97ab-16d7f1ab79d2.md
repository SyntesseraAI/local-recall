---
id: dc7bfdf5-8a9c-4635-97ab-16d7f1ab79d2
subject: sqlite-vec vector search requires 'k = ?' parameter in match clause
keywords:
  - sqlite-vec
  - vector-search
  - sql
  - constraint
  - limit
applies_to: 'file:src/core/vector-store.ts'
occurred_at: '2025-12-21T19:15:38.757Z'
content_hash: 5018db6739b5d907
---
The sqlite-vec extension has a requirement that vector JOIN queries must include 'k = ?' parameter in the match clause (e.g., 'vectors MATCH ? AND k = ?'). Without this, queries fail. Additionally, sqlite-vec applies the k limit before any WHERE clause filters, so when filtering by scope, the k results might not include matches in the requested scope. Solution: retrieve more results than needed, then filter by scope in application code.
