---
id: e3a35851-6efe-4cbc-8216-6bc5d0862c2d
subject: Refactor stop.ts to use parseTranscriptForMemories from transcript.ts
keywords:
  - stop.ts
  - transcript.ts
  - parsing
  - duplication
  - refactoring
applies_to: 'file:src/hooks/stop.ts'
occurred_at: '2025-12-21T18:27:11.223Z'
content_hash: 2424697000033b73
---
The stop.ts hook had duplicate parsing logic that was broken. It checked `c.text` for thinking blocks, but thinking blocks have `c.thinking` property. This caused thinking content to be dropped.

Solution: Moved all parsing logic to transcript.ts as `parseTranscriptForMemories()` function that takes raw JSONL content and returns memory suggestions ready to save. stop.ts now just reads the transcript file, calls parseTranscriptForMemories(), and saves the results.

This removes code duplication and makes the transcript parsing reusable from any location.
