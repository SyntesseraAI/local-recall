---
id: 3a169959-d565-4b30-8c59-67cbba4398bf
subject: >-
  Memory extraction should use [LOCAL_RECALL_INTERNAL] token prefix for internal
  prompts
keywords:
  - internal token
  - extraction prompts
  - testing friendly
  - recursion prevention
applies_to: 'file:src/hooks/user-prompt-submit.ts'
occurred_at: '2025-12-21T19:19:12.033Z'
content_hash: 669f1eb2e8d5a28e
---
Use [LOCAL_RECALL_INTERNAL] as a prefix token at the start of internal/system prompts (like keyword extraction) rather than checking the content. This makes the system more testable - users can test with prompts containing 'Extract keywords...' without triggering the recursion guard. The hook checks startsWith('[LOCAL_RECALL_INTERNAL]') to identify internal calls.
