---
id: be1152a4-cb5a-4dbc-95f1-eac617034538
subject: Hooks system architecture and execution flow in Local Recall
keywords:
  - hooks
  - session-start
  - user-prompt-submit
  - stop
  - integration
  - claude-code
applies_to: global
occurred_at: '2025-12-01T22:30:46.065Z'
content_hash: 6ac49cb4218ece8d
---
Local Recall integrates with Claude Code through three hooks:

1. **SessionStart Hook** (`src/hooks/session-start.ts`)
   - Triggered when a Claude Code session begins
   - Loads memory index from `local-recall/index.json`
   - Searches for relevant memories based on context (files, areas)
   - Outputs memories to stdout (injected into Claude's context)
   - Shows index statistics

2. **UserPromptSubmit Hook** (`src/hooks/user-prompt-submit.ts`)
   - Triggered before Claude processes a user prompt
   - Extracts keywords from the prompt using Claude Haiku
   - Searches memory index for matching keywords (fuzzy matching)
   - Outputs matching memories to stdout

3. **Stop Hook** (`src/hooks/stop.ts`)
   - Currently disabled - memory extraction is handled by MCP server daemon
   - MCP server processes transcripts asynchronously every 5 minutes
   - Uses `claude -p` to extract memories from transcripts

Hooks configuration is defined in `hooks.json` and uses `${CLAUDE_PLUGIN_ROOT}` to reference bundled scripts.
