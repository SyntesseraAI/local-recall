---
id: e957f9c9-eef9-4313-aedd-05c2101ce047
subject: >-
  Memory extraction from UserPromptSubmit hook returns malformed data when
  processing short transcripts
keywords:
  - memory extraction
  - claude response parsing
  - validation error
  - undefined fields
  - transcript processing
applies_to: 'file:src/core/memory-extractor.ts'
occurred_at: '2025-12-02T06:19:00.665Z'
content_hash: fe9ba54b229e0888
---
When Claude is called to extract memories from very short transcripts (like single-line greetings), it may return an array of empty objects `[{}, {}, {}, {}]` instead of the expected `{ "memories": [...] }` structure. This causes validation failures with undefined `subject`, `keywords`, `applies_to`, and `content` fields. The issue occurs in the `parseClaudeResponse` function (line 175) when it receives an array and wraps it as `{ memories: parsed }`, but the array contains incomplete memory objects. The error manifests as validation failures in `MemorySchema.parseAsync()`.
