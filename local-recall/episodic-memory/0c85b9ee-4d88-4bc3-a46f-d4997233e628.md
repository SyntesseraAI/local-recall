---
id: 0c85b9ee-4d88-4bc3-a46f-d4997233e628
subject: >-
  Fix transcript parsing duplication - stop.ts should use transcript.ts
  utilities
keywords:
  - transcript parsing
  - code duplication
  - stop.ts
  - transcript.ts
  - refactoring
applies_to: 'file:src/hooks/stop.ts'
occurred_at: '2025-12-21T18:24:55.963Z'
content_hash: a4003b5c3da9f4b9
---
The stop.ts hook had duplicate parsing logic that was broken:

1. **Bug**: Checked `c.text` for thinking blocks, but thinking blocks have `c.thinking` property
2. **Bug**: Never populated the `thinking` field on messages passed to `analyzeForMemories`
3. **Design issue**: Duplicated parsing logic from transcript.ts

Solution: Exported `parseTranscriptForMemories()` function from transcript.ts that takes raw JSONL content and returns memory suggestions ready to save. This removes all parsing/looping from stop.ts, making it a simple: read file → parse → save memories.

This also enables reusing the same transcript parsing elsewhere in the codebase.
