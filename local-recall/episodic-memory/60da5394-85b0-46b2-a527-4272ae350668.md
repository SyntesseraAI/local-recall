---
id: 60da5394-85b0-46b2-a527-4272ae350668
subject: >-
  User-prompt-submit hook performs lazy vector store initialization for semantic
  search
keywords:
  - user-prompt-submit
  - hook
  - semantic-search
  - vector-store
  - lazy-initialization
  - embeddings
applies_to: 'area:hooks'
occurred_at: '2025-12-02T17:11:09.082Z'
content_hash: b20dd3a96e034ded
---
# UserPromptSubmit Hook

## Lazy Initialization Pattern

The UserPromptSubmit hook uses lazy vector store initialization:
- On first call: Initializes vector store (includes embedding model setup)
- On subsequent calls: Reuses cached vector store
- This delay is acceptable because hook is triggered per-prompt (not per-session)

## Search Flow

1. Claude Code triggers hook when user submits a prompt
2. Hook receives: `session_id`, `transcript_path`, `cwd`, `prompt`
3. Hook initializes vector store (if not already done)
4. Performs semantic search using user's prompt as query
5. Outputs matching memories to stdout
6. Claude Code injects into context before processing prompt

## Performance Considerations

- First semantic search of a session may take 30-60 seconds (model initialization)
- Subsequent searches are fast (cached vector store)
- Trade-off: User experiences one slow interaction but gets semantic search benefits
- This is acceptable for interactive development workflows

## Difference from SessionStart

- **SessionStart**: Fast, recent memories only, no search
- **UserPromptSubmit**: Slower, but context-aware semantic matching
- Both strategies serve different purposes in the workflow
