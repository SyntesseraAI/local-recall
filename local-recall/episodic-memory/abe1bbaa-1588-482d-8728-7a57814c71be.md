---
id: abe1bbaa-1588-482d-8728-7a57814c71be
subject: Vector store concurrent creation has race condition bug
keywords:
  - concurrency
  - vector-store
  - race-condition
  - memory-creation
  - parallel
applies_to: 'file:src/core/memory.ts, file:tests/integration/memory-lifecycle.test.ts'
occurred_at: '2025-12-21T17:21:11.889Z'
content_hash: 7b276ab8c4ea2b25
---
Discovered race condition when creating memories in parallel: each `getVectorStore()` call in `MemoryManager` creates a new instance that loads, modifies, and persists the Orama index independently. When multiple memories are created simultaneously, their modifications overwrite each other. Test `should handle vector store sync while creating memories in parallel` exposed this bug. Currently skipped with TODO marker. Needs fix: use singleton pattern or mutex for vector store access.
