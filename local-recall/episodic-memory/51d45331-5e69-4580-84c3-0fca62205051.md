---
id: 51d45331-5e69-4580-84c3-0fca62205051
subject: >-
  Local Recall uses MCP server background daemon to process transcripts and
  extract memories asynchronously
keywords:
  - mcp-server
  - background-daemon
  - transcript-processing
  - memory-extraction
  - async
  - 5-minute-interval
applies_to: 'area:mcp-server'
occurred_at: '2025-12-01T15:55:54.836Z'
content_hash: 0975d7807bb7e73a
---
# MCP Server Background Daemon Architecture

## Purpose

The MCP server runs a background daemon that processes Claude Code transcripts and extracts memories asynchronously, enabling the Local Recall system to learn and improve over time.

## Operation

### Processing Loop

- Runs on a **5-minute interval** by default
- Monitors `~/.claude/projects/<encoded-path>/transcripts/` for new/changed files
- Processes JSONL transcript files to extract valuable memories
- Uses content hashes to detect changes and avoid reprocessing

### Transcript Processing Steps

1. **Scan**: List all `.jsonl` files in the transcripts directory
2. **Hash**: Calculate SHA-256 hash of each file content
3. **Detect Changes**: Compare with stored hashes to identify new/modified transcripts
4. **Parse**: Convert JSONL to structured events (User, Assistant, Tool invocations)
5. **Extract**: Use Claude to analyze events and identify memories
6. **Organize**: Structure extracted information with metadata (keywords, scope, timestamps)
7. **Store**: Save as markdown files in `local-recall/episodic-memory/`
8. **Track**: Update hash records to prevent reprocessing

## Key Implementation Details

- **Idempotent**: Same transcript content always produces same memories
- **Change Detection**: Uses content hashes to efficiently detect modifications
- **Error Handling**: Continues processing other transcripts if one fails
- **Memory Deduplication**: Checks for existing memories with same occurred_at and content_hash

## Relationship to Other Components

- **SessionStart Hook**: Loads index of existing memories into Claude's context at session start
- **UserPromptSubmit Hook**: Searches for relevant memories based on user's prompt
- **Memory Files**: Created/updated based on transcript analysis
- **Index**: Built from memory files to enable fast searching
