---
id: b8c3a9f8-9b3e-4496-b142-6a9c910233f6
subject: >-
  Session-start hook is safe (file-based), user-prompt-submit hook is
  problematic (loads embeddings)
keywords:
  - hooks
  - session-start
  - user-prompt-submit
  - embedding
  - safety
applies_to: global
occurred_at: '2025-12-03T11:24:27.209Z'
content_hash: 9330895f70d2c1c7
---
Session-start.ts only uses MemoryManager (file-based operations, no embeddings) which is safe for concurrent execution. However, user-prompt-submit.ts directly instantiates SearchEngine and ThinkingSearchEngine to perform semantic search, which loads the ONNX embedding model and triggers the mutex errors when multiple Claude instances run hooks concurrently.
