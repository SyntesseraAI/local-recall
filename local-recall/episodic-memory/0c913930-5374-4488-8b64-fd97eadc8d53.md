---
id: 0c913930-5374-4488-8b64-fd97eadc8d53
subject: Memory extractor must handle Claude's direct array responses
keywords:
  - memory-extractor
  - parseClaudeResponse
  - schema-validation
  - claude-response-format
  - array-wrapping
applies_to: 'file:src/core/memory-extractor.ts'
occurred_at: '2025-12-21T19:19:41.326Z'
content_hash: 737f7ccd5a3d3678
---
Claude (Haiku) sometimes returns memories as a plain array `[{...}, {...}]` instead of wrapped in an object `{ memories: [...] }`. The parseClaudeResponse method at line 174 needs to detect this case and wrap raw arrays in the expected format before Zod validation. This is a common pattern across different Claude models and API responses.

Fix: Added array detection that wraps raw arrays: `if (Array.isArray(parsed)) { parsed = { memories: parsed }; }`
