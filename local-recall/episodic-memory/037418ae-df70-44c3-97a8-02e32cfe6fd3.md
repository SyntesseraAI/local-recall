---
id: 037418ae-df70-44c3-97a8-02e32cfe6fd3
subject: sqlite-vec requires explicit k parameter and LIMIT in vector search queries
keywords:
  - sqlite-vec
  - vector-search
  - sql
  - constraint
applies_to: 'file:src/core/vector-store.ts'
occurred_at: '2025-12-01T21:47:19.758Z'
content_hash: b049e04677b4e8a3
---
The sqlite-vec extension requires `k = ?` in the match clause when using `vec_search()`. Queries like `vec_search(embedding, ?)` followed by `JOIN` with scope filtering need special handling:

1. The `k` parameter must be explicit in the vec_search match
2. sqlite-vec applies the k limit BEFORE JOIN filters
3. When filtering by scope, must retrieve more results (k * 2) then filter in code

**Fix:** Changed vector search to fetch k*2 results without scope filter, then post-process to apply scope filtering in JavaScript.
