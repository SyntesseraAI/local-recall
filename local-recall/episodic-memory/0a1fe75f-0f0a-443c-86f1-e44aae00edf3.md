---
id: 0a1fe75f-0f0a-443c-86f1-e44aae00edf3
subject: >-
  Duplicate close event handlers cause race conditions in child process
  management
keywords:
  - close
  - event handler
  - duplicate
  - race condition
  - child process
applies_to: 'file:src/hooks/user-prompt-submit.ts'
occurred_at: '2025-12-21T18:27:26.099Z'
content_hash: 8db32eac0a8738ba
---
The user-prompt-submit hook had duplicate `child.on('close', ...)` event listeners registered on the same child process. This can cause multiple resolutions of the promise, race conditions between the timeout and normal completion, and unpredictable behavior. When managing child processes, ensure only one 'close' handler is registered and use a guard variable (e.g., `resolved` flag) to prevent multiple resolutions.
