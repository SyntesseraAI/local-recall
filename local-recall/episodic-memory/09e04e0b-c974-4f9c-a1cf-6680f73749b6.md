---
id: 09e04e0b-c974-4f9c-a1cf-6680f73749b6
subject: >-
  Memory extraction system processes LOCAL_RECALL_INTERNAL causing recursion -
  filter these messages
keywords:
  - memory extraction
  - bug
  - recursion
  - transcript processing
  - LOCAL_RECALL_INTERNAL
  - transcript collector
  - infinite loop
applies_to: global
occurred_at: '2025-12-01T22:56:19.892Z'
content_hash: 14581572bc58ca23
---
The transcript collection and memory extraction pipeline has a critical bug where it processes messages prefixed with `[LOCAL_RECALL_INTERNAL]`. These internal system prompts are being treated as regular transcript content and fed back into the memory extraction system, causing infinite recursion.

**Root Cause:** When extracting memories from transcripts, the system includes the full LOCAL_RECALL_INTERNAL system prompt in the output, which then gets added to subsequent transcripts as user/assistant messages.

**Solution:** Filter out any messages starting with `[LOCAL_RECALL_INTERNAL]` or containing internal system prompts before processing transcripts for memory extraction. The transcript collector in `src/core/transcript-collector.ts` should strip these messages during transcript parsing.

**Impact:** This affects the memory extraction lifecycle and could cause the system to malfunction during sessions. Must be fixed before deploying memory extraction features.
