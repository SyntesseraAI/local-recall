---
id: d7706275-ca37-452f-8048-b1f0adafa366
subject: >-
  Local Recall memory model refactored to episodic architecture with idempotent
  deduplication
keywords:
  - episodic memory
  - idempotent
  - deduplication
  - occurred_at
  - content_hash
  - memory lifecycle
applies_to: global
occurred_at: '2025-12-01T22:33:56.355Z'
content_hash: 4d72f41bd58e386d
---
The memory model was refactored from mutable knowledge base to immutable episodic memory log. Key decisions:

1. **Immutability**: Memories cannot be updated or deleted by agents - only users can remove them manually
2. **Idempotent deduplication**: Memories are deduplicated using composite key of `occurred_at` (timestamp from source transcript) + `content_hash` (SHA-256 truncated to 16 chars)
3. **Timestamps**: Each memory now has:
   - `occurred_at`: When the event happened (from transcript timestamp)
   - `created_at`: When the memory file was written
   - `content_hash`: For deduplication purposes
4. **Processing strategy**: Stop hook now processes entire transcript history, not just recent messages (removed 30-second time window). Deduplication prevents duplicate memories from being created on re-processing.
5. **API changes**:
   - Removed `memory_update` and `memory_delete` MCP tools
   - Updated `createMemory()` to check for duplicates before writing
   - Added `findDuplicate()` method to check existing memories by occurred_at + content_hash
   - Removed `updated_at` field from schema
   - Removed `UpdateMemoryInput` type
