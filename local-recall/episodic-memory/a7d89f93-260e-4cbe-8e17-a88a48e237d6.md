---
id: a7d89f93-260e-4cbe-8e17-a88a48e237d6
subject: Memory extraction pipeline tolerates Claude Haiku response format variations
keywords:
  - memory-extraction
  - claude-haiku
  - response-format
  - robustness
  - error-handling
applies_to: global
occurred_at: '2025-12-01T22:24:27.124Z'
content_hash: b412866da2a9932c
---
The memory extraction process uses Claude Haiku to analyze transcripts and extract memories. The implementation is resilient to response format variations:

1. **Direct array parsing**: Handles case where Claude returns array directly
2. **Field normalization**: Accepts alternative field names before validation
3. **Wrapper format handling**: Processes memories wrapped in objects with 'memories' key
4. **Fallback JSON extraction**: Extracts JSON from markdown code blocks if parsing fails
5. **Zod validation**: Final validation ensures all required fields are present

This multi-level approach prevents memory extraction failures due to minor variations in Claude's output format, improving reliability across different sessions.
