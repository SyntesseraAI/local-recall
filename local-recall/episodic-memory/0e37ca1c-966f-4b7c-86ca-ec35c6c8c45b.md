---
id: 0e37ca1c-966f-4b7c-86ca-ec35c6c8c45b
subject: >-
  MCP server background daemon processes transcripts asynchronously for memory
  extraction
keywords:
  - mcp
  - server
  - daemon
  - background
  - transcript
  - memory
  - extraction
  - async
  - interval
applies_to: 'area:mcp-server'
occurred_at: '2025-12-02T07:40:20.871Z'
content_hash: a5bb1616b09cffb4
---
# MCP Server Background Daemon

The MCP server includes a background daemon that processes transcripts asynchronously, separate from the hook-based memory creation.

## How It Works

The daemon:
1. Runs on a configurable interval (default: every 5 minutes)
2. Scans the Claude project transcripts directory (`~/.claude/projects/<project>/transcripts/`)
3. Processes new or modified JSONL transcript files
4. Extracts memories from transcripts using the `claude -p` process (Haiku model)
5. Tracks processed transcripts by content hash to avoid reprocessing
6. Creates memory files with `applies_to: global` scope

## Advantages Over Hook-Based Extraction

- **Asynchronous**: Doesn't block Claude's UI during session
- **Deduplicatable**: Content hashes prevent duplicate memories from same transcript
- **Recoverable**: Can re-run extraction if memories are deleted
- **Configurable**: Can adjust processing interval and batch size

## Why Stop Hook is Disabled

The Stop hook was disabled in favor of the background daemon because:
- The daemon provides better reliability and flexibility
- Transcripts aren't immediately written when stop occurs - they're finalized asynchronously
- The daemon can handle edge cases like partial transcripts or upload failures

## Transcript Processing State

Tracked in `src/core/transcript-collector.ts` and the MCP server configuration:
- Last processed timestamp and content hashes stored in memory
- Only new/modified files trigger extraction
- Successfully processed transcripts are recorded to avoid reprocessing
