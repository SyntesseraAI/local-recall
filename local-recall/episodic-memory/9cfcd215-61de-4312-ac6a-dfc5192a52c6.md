---
id: 9cfcd215-61de-4312-ac6a-dfc5192a52c6
subject: >-
  UserPromptSubmit hook causes infinite recursion by calling 'claude -p' which
  triggers itself
keywords:
  - userpromptsubmit
  - hook
  - recursion
  - infinite loop
  - claude command
  - subprocess
applies_to: 'file:src/hooks/user-prompt-submit.ts'
occurred_at: '2025-12-01T21:15:51.788Z'
content_hash: 6dfecc8911c1f983
---
The UserPromptSubmit hook in src/hooks/user-prompt-submit.ts calls `claude -p` to extract keywords from user prompts. However, executing `claude -p` spawns a subprocess that inherits the same hooks configuration, causing the UserPromptSubmit hook to trigger again within that subprocess. This creates an infinite recursion problem that halts execution.

The hook needs to prevent its own execution when called from within `claude -p`. Solutions include:
1. Setting an environment variable (e.g., `LOCAL_RECALL_EXTRACTING=true`) to skip hook execution in child processes
2. Removing the UserPromptSubmit hook temporarily during keyword extraction
3. Using a different method for keyword extraction that doesn't invoke Claude
