---
id: 819b9b90-7927-4e69-bdc6-b307f63f392a
subject: >-
  Memory system redesigned to use episodic/idempotent model with content
  deduplication
keywords:
  - architecture
  - memory
  - episodic
  - idempotent
  - deduplication
  - occurred_at
  - content_hash
applies_to: global
occurred_at: '2025-12-21T18:20:12.298Z'
content_hash: 0071ec0d99e5c055
---
# Memory System Redesign

Shifted from mutable knowledge base to episodic memory log model:

## Key Changes
1. **Immutability**: Memories cannot be updated or deleted via API - only manually by user
2. **Deduplication**: Uses `occurred_at` + `content_hash` (SHA-256, 16 char prefix) as dedup key
3. **Timestamps**: Each memory has:
   - `occurred_at`: When the conversation/event happened (from transcript)
   - `created_at`: When the memory file was written
   - `content_hash`: Hash of content for deduplication
4. **Idempotency**: Creating the same memory twice checks the dedup key; if exists, skips creation

## Rationale
This mirrors how human episodic memory works - preserving events with timestamps rather than maintaining a mutable knowledge base. Allows reframing memories as needed without modification.

## Implementation
- Removed `updateMemory()` and `deleteMemory()` from API
- Removed `updated_at` field from schema
- Added `findDuplicate(occurredAt, contentHash)` method to check before creation
- Memory `computeContentHash()` uses SHA-256 truncated to 16 characters
- Removed `timeWindow` configuration (now processes entire history)

## Stop Hook Behavior
No longer filters by 30-second time window. Processes entire transcript history, relying on deduplication to prevent duplicate memories from repeated hook runs.
