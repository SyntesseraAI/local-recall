---
id: 8dd636d5-0fe3-4162-9df1-d278f0f04b34
subject: >-
  Session guarding: Memory extraction prompt needs [LOCAL_RECALL_INTERNAL]
  prefix
keywords:
  - session guarding
  - memory extraction
  - prompt prefix
  - internal flag
  - recursion prevention
applies_to: 'file:src/prompts/memory-extraction.ts'
occurred_at: '2025-12-21T18:30:03.315Z'
content_hash: 25c7e59bf573adba
---
The memory extraction prompt generated by `buildMemoryExtractionPrompt()` must include the `[LOCAL_RECALL_INTERNAL]` prefix at the start of the returned prompt string. This allows the UserPromptSubmit hook to detect and skip processing these internal extraction requests, preventing recursion when the MCP daemon calls `claude -p` for memory extraction. The guard checks for this prefix at line 161 of `user-prompt-submit.ts`.
