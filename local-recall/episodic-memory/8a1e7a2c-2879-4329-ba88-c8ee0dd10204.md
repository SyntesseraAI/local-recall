---
id: 8a1e7a2c-2879-4329-ba88-c8ee0dd10204
subject: Fix AbortError in user-prompt-submit hook's Claude CLI subprocess handling
keywords:
  - abort error
  - spawn timeout
  - child process
  - promise rejection
  - user-prompt-submit hook
applies_to: 'file:src/hooks/user-prompt-submit.ts'
occurred_at: '2025-12-01T16:33:15.069Z'
content_hash: 161ac92c985f84c8
---
The user-prompt-submit hook was throwing an unhandled AbortError when calling Claude CLI for keyword extraction. The issue was caused by:

1. **Root cause**: The `spawn()` function was being called with a 30-second timeout via AbortSignal, but the process rejection wasn't being caught
2. **Solution**: Added proper error handling with `.catch()` to gracefully handle abort errors and other promise rejections
3. **Key lesson**: When using AbortSignal with spawn(), must handle promise rejections appropriately - the signal rejection is not automatically caught by the normal process event handlers
4. **Location**: `src/hooks/user-prompt-submit.ts` - specifically in the keyword extraction logic that calls `claude -p`
5. **Testing**: The hook now gracefully handles timeouts and continues processing instead of crashing the session
