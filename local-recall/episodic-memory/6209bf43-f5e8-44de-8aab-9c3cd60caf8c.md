---
id: 6209bf43-f5e8-44de-8aab-9c3cd60caf8c
subject: UserPromptSubmit hook triggers recursive hook execution via claude -p command
keywords:
  - userpromptsubmit
  - hook
  - recursion
  - claude
  - keyword extraction
  - subprocess
applies_to: 'file:src/hooks/user-prompt-submit.ts'
occurred_at: '2025-12-02T01:02:17.279Z'
content_hash: 0b465e8b1d36bda1
---
The UserPromptSubmit hook in src/hooks/user-prompt-submit.ts:40 invokes `claude -p --model haiku` to extract keywords from user prompts. This command execution inherits the parent process environment and triggers the same hook again in the child process, creating a recursive loop. The hook needs to be redesigned to either:

1. Disable the hook when running as a subprocess (via environment variable check)
2. Move keyword extraction to a separate tool/utility that doesn't trigger hooks
3. Use a different approach to extract keywords that doesn't invoke claude

This is a critical issue that prevents the UserPromptSubmit hook from functioning correctly and must be resolved before the hook can be reliably used.
