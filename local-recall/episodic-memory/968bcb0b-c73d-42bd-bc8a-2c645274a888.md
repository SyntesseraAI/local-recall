---
id: 968bcb0b-c73d-42bd-bc8a-2c645274a888
subject: Memory extraction uses internal prompt token instead of text matching
keywords:
  - extraction process
  - prompt token
  - recursion prevention
  - testability
applies_to: 'file:src/hooks/user-prompt-submit.ts'
occurred_at: '2025-12-21T18:24:15.046Z'
content_hash: 0e635436c5b9578b
---
Instead of checking for specific text like 'Extract keywords from this text' to identify internal extraction prompts, use a dedicated `[LOCAL_RECALL_INTERNAL]` token at the start of the prompt. This approach is more reliable, easier to test (users can test with prompts containing extraction keywords), and makes the intent explicit.
