---
id: c72b6661-3c0b-443b-a271-16a7583a9447
subject: Zod schema validation in memory extractor requires careful type handling
keywords:
  - zod-schema
  - type-coercion
  - validation
  - memory-data
  - error-handling
applies_to: 'file:src/core/memory-extractor.ts'
occurred_at: '2025-12-01T21:56:13.504Z'
content_hash: 2036abe202e166ab
---
## Key Insights

1. **Type Coercion**: When using Zod schemas with `parse()`, ensure input data matches expected types exactly. For example, `occurred_at` should be a Date object, not a string (unless explicitly using `coerce.date()`)

2. **Error Messages**: Zod validation errors provide detailed type mismatch information. Use these to identify when Claude's response format doesn't match the expected schema.

3. **Defensive Parsing**: Always validate Claude's response through the full Zod schema, not just checking for the presence of fields. This catches type mismatches early.

## Common Issues

- If Claude returns `occurred_at` as a string, Zod will reject it unless the schema uses `z.coerce.date()`
- Array responses need explicit handling if Claude returns data in unexpected formats
