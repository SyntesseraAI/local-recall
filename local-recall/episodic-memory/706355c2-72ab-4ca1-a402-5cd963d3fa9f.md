---
id: 706355c2-72ab-4ca1-a402-5cd963d3fa9f
subject: UserPromptSubmit hook needs recursion guard for internal extraction prompts
keywords:
  - recursion guard
  - internal prompts
  - extraction process
  - hook loop prevention
applies_to: 'file:src/hooks/user-prompt-submit.ts'
occurred_at: '2025-12-21T19:19:12.033Z'
content_hash: e22bf87cb8aacc0c
---
The UserPromptSubmit hook triggers when calling `claude -p` for keyword extraction, which creates a recursive loop. Add a recursion guard by prefixing internal prompts with [LOCAL_RECALL_INTERNAL] token and checking for it at the start. Also pass --strict-mcp-config to the claude subprocess to disable MCP servers during internal extraction calls, adding an additional layer of protection against recursion.
