---
id: c0854a7c-1f89-4371-8b56-d5d057677cfe
subject: Memory extraction workflow in MCP server background daemon
keywords:
  - mcp-server
  - background-daemon
  - memory-extraction
  - transcripts
  - workflow
  - asynchronous
applies_to: 'area:mcp-server'
occurred_at: '2025-12-01T16:15:44.657Z'
content_hash: 15d4e5337afa9868
---
# Memory Extraction Workflow in MCP Server

## Overall Process

The MCP server runs a background daemon that processes transcripts asynchronously (every 5 minutes) to extract and create memories.

## Workflow Steps

1. **Transcript Discovery**: Daemon scans `~/.claude/projects/<project>/transcripts/` for new or modified JSONL files

2. **Change Detection**: Uses content hashes to detect if a transcript has changed since last processing

3. **Transcript Condensing**: Condenses the transcript (from `transcript-collector.ts`) to extract only relevant events

4. **Memory Extraction**: Sends condensed transcript to Claude using `claude -p` to extract valuable memories

5. **Memory Management**:
   - Creates new memories for extracted information
   - Deletes old memories if a transcript changes (based on content hash)
   - Recreates memories with updated content

6. **Tracking**: Records the hash of processed transcripts to avoid reprocessing unchanged files

## Key Implementation Files

- `src/core/transcript-collector.ts` - Handles transcript condensing
- `src/mcp-server/server.ts` - Background daemon implementation
- `src/core/memory.ts` - Memory CRUD operations

## Why Async Processing

The daemon runs asynchronously to:
- Not block the MCP server from handling tool requests
- Process transcripts in the background
- Allow incremental memory building over time
