---
id: d58b3730-d917-4bc7-aaa9-79af87b00fb9
subject: Memory extractor handles recursive callback loop through session guarding
keywords:
  - recursion
  - callback-loop
  - session-guard
  - internal-prompts
applies_to: global
occurred_at: '2025-12-21T18:29:15.440Z'
content_hash: 7d85d40c0e43ee36
---
Memory extraction creates a callback loop: MCP daemon calls `claude -p` with a memory extraction prompt → UserPromptSubmit hook fires → hook searches memories → potentially creates new memories. To prevent infinite loops, the hook must filter out internal prompts using the `[LOCAL_RECALL_INTERNAL]` prefix. This guards the system from processing its own internal operations as user-initiated semantic searches.
