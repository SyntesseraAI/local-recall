---
id: 0efebabb-8c4e-43ea-8f6d-8b01270a4c75
subject: Fix AbortError in user-prompt-submit hook's Claude CLI subprocess handling
keywords:
  - abort error
  - spawn timeout
  - child process
  - promise rejection
  - user-prompt-submit hook
  - claude cli
  - subprocess
applies_to: 'file:src/hooks/user-prompt-submit.ts'
occurred_at: '2025-12-01T16:01:46.526Z'
content_hash: 2bc4f8aad5102960
---
The user-prompt-submit hook was throwing an unhandled AbortError when calling Claude CLI for keyword extraction via the `callClaudeForKeywords()` function. The issue occurred when the subprocess was terminated (likely due to timeout or user cancellation). The solution was to wrap the subprocess call in a try-catch block and properly handle both error cases:

1. Subprocess errors: Check `error.code === 'ABORT_ERR'` to identify AbortError
2. Stderr output: Log stderr as warnings when Claude CLI execution fails
3. Graceful fallback: Return empty keywords array instead of propagating the error

This prevents the hook from crashing and allows the memory search to continue even if keyword extraction fails.
