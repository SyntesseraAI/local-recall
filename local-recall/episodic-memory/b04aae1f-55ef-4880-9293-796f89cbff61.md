---
id: b04aae1f-55ef-4880-9293-796f89cbff61
subject: >-
  transcript-collector.ts needs refactoring to handle JSONL format and path
  normalization
keywords:
  - transcript-collector
  - jsonl
  - parsing
  - path-normalization
  - cwd
  - refactoring
  - bug
applies_to: 'file:src/core/transcript-collector.ts'
occurred_at: '2025-12-01T16:12:09.704Z'
content_hash: 2a11713e1641e4b2
---
# Transcript Collector Refactoring Needs

The `transcript-collector.ts` file has several issues that need addressing:

## Current Issues

1. **JSONL Format Not Handled**: The collector currently doesn't parse JSONL format (JSON Lines). Each line is a separate JSON object, not a single JSON array.

2. **Path Normalization**: The collector needs to normalize file paths when reading transcript files, as paths may contain different separators or formats.

3. **CWD Handling**: The collector should properly pass the current working directory (`cwd`) to Claude when processing transcripts, as this provides context about which project the transcript belongs to.

4. **Content Hash Logic**: Need to verify the content hash calculation properly handles JSONL format and deduplication.

## Refactoring Steps

1. Update JSONL parsing to handle newline-delimited JSON
2. Implement proper path normalization (resolve relative paths, handle different separators)
3. Ensure CWD is correctly passed through the memory extraction process
4. Add tests for JSONL parsing with various transcript formats
5. Verify deduplication logic works with the new format

## Impact

This refactoring is critical for the MCP server daemon to correctly process Claude Code transcripts and extract memories.
