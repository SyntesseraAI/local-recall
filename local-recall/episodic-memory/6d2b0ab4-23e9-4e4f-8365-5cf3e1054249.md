---
id: 6d2b0ab4-23e9-4e4f-8365-5cf3e1054249
subject: Refactor transcript parsing to centralize JSONL processing logic
keywords:
  - transcript parsing
  - jsonl
  - memory extraction
  - stop hook
  - code duplication
  - refactoring
applies_to: global
occurred_at: '2025-12-21T19:20:20.675Z'
content_hash: fb4f65f56ba17001
---
The stop.ts hook had duplicate parsing logic that reimplemented transcript parsing instead of using shared utilities from transcript.ts. The refactored architecture now:

1. **Centralized parsing in transcript.ts**: Exported `parseTranscriptForMemories()` function that takes raw JSONL content and returns memory suggestions
2. **Simplified stop.ts**: Now just reads the transcript file, calls `parseTranscriptForMemories()`, and saves the results
3. **Fixed thinking block handling**: Previously, stop.ts checked `c.text` for thinking blocks (which have `c.thinking` property), causing thinking content to be dropped
4. **Enables reusability**: Same parsing logic can now be used by other parts of the codebase that need to extract memories from transcripts

This pattern avoids code duplication and makes the parsing logic testable in isolation.
