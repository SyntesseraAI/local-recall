---
id: 88aa7cb6-2899-4bc2-a02f-9bb1be658bc3
subject: Vector store concurrency bug in parallel memory creation
keywords:
  - concurrency-bug
  - vector-store
  - race-condition
  - parallel-operations
applies_to: 'file:src/core/vector-store.ts'
occurred_at: '2025-12-21T18:32:04.567Z'
content_hash: 5d4e95275c039a44
---
When multiple memories are created in parallel, each calls `getVectorStore()` creating independent instances. Each instance loads, modifies, and persists the index separately, causing race conditions and data loss. The test `should handle vector store sync while creating memories in parallel` exposes this issue. The test was marked as TODO for fixing. A proper fix requires either:
1. Locking/mutex for vector store operations
2. Batching concurrent adds before persisting
3. Using a shared instance with atomic operations
