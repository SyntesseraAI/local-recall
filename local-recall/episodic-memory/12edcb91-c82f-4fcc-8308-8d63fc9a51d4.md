---
id: 12edcb91-c82f-4fcc-8308-8d63fc9a51d4
subject: UserPromptSubmit hook calls claude -p which triggers the same hook recursively
keywords:
  - userpromptsubmit
  - hook
  - claude
  - recursion
  - infinite loop
  - keyword extraction
applies_to: 'file:src/hooks/user-prompt-submit.ts'
occurred_at: '2025-12-01T16:15:47.607Z'
content_hash: 6cb24023f80fb60b
---
The UserPromptSubmit hook invokes `claude -p` to extract keywords from user prompts. However, this command execution triggers the UserPromptSubmit hook again within the child process, causing infinite recursion. This is a critical issue that prevents the hook from functioning properly. The hook should either:

1. Use an environment variable to prevent re-triggering (e.g., `CLAUDE_SKIP_HOOKS=1` or custom flag)
2. Call Claude programmatically without shell invocation
3. Use a separate script that doesn't trigger hooks

This recursive hook invocation is likely the root cause of any hang or timeout issues in UserPromptSubmit functionality.
