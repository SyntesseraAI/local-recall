---
id: 86c1ce53-1725-4182-a76c-e988aeea7221
subject: >-
  Hook implementation should use HTTP daemon client instead of direct vector
  store
keywords:
  - hook architecture
  - daemon client
  - http communication
  - separation of concerns
applies_to: 'file:src/hooks/user-prompt-submit.ts'
occurred_at: '2025-12-03T10:22:44.117Z'
content_hash: e59653d3f139e394
---
The UserPromptSubmit hook should not directly instantiate VectorStore, SearchEngine, or ThinkingSearchEngine classes. Instead, it should use the DaemonClient to make HTTP requests to the MCP daemon on localhost:7847. The daemon owns the sqlite-vec connection and handles all vector store operations. This prevents the mutex error that occurs when hooks try to load sqlite-vec concurrently. The hook implementation exists but needs verification that it's actually using HTTP calls and not accidentally loading the vector stores directly.
