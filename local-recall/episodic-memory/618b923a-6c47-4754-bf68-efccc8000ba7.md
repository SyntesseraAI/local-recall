---
id: 618b923a-6c47-4754-bf68-efccc8000ba7
subject: Fix Claude response parsing for raw array memories in memory extractor
keywords:
  - memory-extractor
  - parseClaudeResponse
  - array-handling
  - zod-validation
  - json-parsing
  - bug-fix
applies_to: 'file:src/core/memory-extractor.ts'
occurred_at: '2025-12-01T21:13:14.001Z'
content_hash: b1f7b1d86a45009c
---
## Bug Description

The `parseClaudeResponse` method in memory-extractor.ts expected Claude CLI to return `{ memories: [...] }` but Claude (Haiku) sometimes returns the array directly.

## Solution

Modified parseClaudeResponse to handle both formats:
1. Try parsing as-is
2. If it's an array, wrap it as `{ memories: array }`
3. Validate with Zod schema

This handles cases where Claude returns raw JSON arrays instead of objects, making the extractor more robust.
