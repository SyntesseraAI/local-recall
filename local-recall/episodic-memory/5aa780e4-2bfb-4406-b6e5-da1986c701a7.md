---
id: 5aa780e4-2bfb-4406-b6e5-da1986c701a7
subject: >-
  Transcript collector needs to handle async file operations and stream
  processing
keywords:
  - transcript-collector
  - async
  - streams
  - file-io
  - jsonl
  - performance
applies_to: 'file:src/core/transcript-collector.ts'
occurred_at: '2025-12-01T16:19:00.471Z'
content_hash: 733bd505ddd5ddb3
---
# Transcript Collector File Operations

## Key Requirements

The transcript-collector needs to:
1. Asynchronously read files from the Claude transcripts directory
2. Parse `.jsonl` format (JSON Lines - one JSON object per line)
3. Stream process transcripts rather than loading entire files into memory
4. Handle file system operations that may fail or timeout
5. Track which transcripts have been processed via content hashes

## Implementation Considerations

- Use Node.js streams (fs.createReadStream) for large files
- Implement line-by-line parsing with a readline interface
- Handle partial reads and incomplete lines gracefully
- Consider using async/await patterns for cleaner code
- Implement proper error handling for file not found, permission denied, etc.

## Related Files

- `src/core/memory.ts` - Has `findDuplicate()` which uses content_hash for deduplication
- `src/utils/transcript.ts` - Should contain transcript parsing utilities
- Background daemon in MCP server processes transcripts every 5 minutes
