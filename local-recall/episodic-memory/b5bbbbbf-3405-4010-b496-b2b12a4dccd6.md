---
id: b5bbbbbf-3405-4010-b496-b2b12a4dccd6
subject: 'UserPromptSubmit hook recursion guard using [LOCAL_RECALL_INTERNAL] token'
keywords:
  - recursion guard
  - hook
  - internal prompts
  - token prefix
applies_to: 'file:src/hooks/user-prompt-submit.ts'
occurred_at: '2025-12-01T23:06:57.689Z'
content_hash: 17d90eff4122bbf1
---
To prevent recursive hook firing when calling `claude -p` for keyword extraction, the hook uses `[LOCAL_RECALL_INTERNAL]` token as a prefix for internal prompts. The recursion guard checks `prompt.startsWith('[LOCAL_RECALL_INTERNAL]')` to skip processing. The `claude` command also uses `--strict-mcp-config` flag to disable MCP servers during keyword extraction subprocess, providing an additional recursion prevention layer.
