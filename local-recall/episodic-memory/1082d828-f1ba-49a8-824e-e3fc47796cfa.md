---
id: 1082d828-f1ba-49a8-824e-e3fc47796cfa
subject: >-
  User-prompt-submit hook requires proper error handling for Claude CLI
  integration
keywords:
  - user-prompt-submit
  - error handling
  - subprocess
  - timeout
  - robustness
  - logging
applies_to: 'file:src/hooks/user-prompt-submit.ts'
occurred_at: '2025-12-01T15:55:46.979Z'
content_hash: d46d746997637bd7
---
The user-prompt-submit hook calls Claude CLI (`claude -p --model haiku`) to extract keywords from user prompts. Critical considerations:

1. **Timeout handling**: The 30-second timeout can trigger AbortError if Claude CLI takes too long
2. **Error recovery**: Errors should not crash the hook - they should be logged and gracefully handled
3. **Fallback behavior**: When Claude CLI fails, the hook should still function (possibly with empty keywords or cached index)
4. **Logging**: All errors should be logged to `local-recall/recall.log` for debugging
5. **User experience**: Hook failures should not block user prompt submission - the system must remain responsive
