---
id: 6d5407e5-7c0d-4092-b908-1bde4cf0cc3d
subject: Fix AbortError in user-prompt-submit hook's Claude CLI subprocess handling
keywords:
  - abort error
  - spawn timeout
  - child process
  - promise rejection
  - user-prompt-submit hook
applies_to: 'file:src/hooks/user-prompt-submit.ts'
occurred_at: '2025-12-02T16:39:25.462Z'
content_hash: afd924905c55c5e2
---
The user-prompt-submit hook was throwing an unhandled AbortError when calling Claude CLI for keyword extraction. The issue was caused by:

1. **Root cause**: The `spawn()` function's `timeout` option rejects the promise, but the rejection wasn't being caught before the promise was awaited, leaving the process orphaned

2. **Solution**: Wrap the `spawn()` call in a try-catch block to properly handle AbortError exceptions. The error occurs when the subprocess timeout is exceeded.

3. **Implementation**: Added try-catch around the spawn call in `src/hooks/user-prompt-submit.ts` to gracefully handle timeout cases where Claude CLI fails to respond within the 30-second timeout.

4. **Prevention**: When calling spawn with a timeout option, always wrap in try-catch to handle potential AbortError rejections before awaiting the promise.
