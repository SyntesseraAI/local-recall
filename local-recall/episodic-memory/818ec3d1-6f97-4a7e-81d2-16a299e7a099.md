---
id: 818ec3d1-6f97-4a7e-81d2-16a299e7a099
subject: UserPromptSubmit hook causes infinite recursion when calling claude -p CLI
keywords:
  - hook
  - recursion
  - claude -p
  - user-prompt-submit
  - infinite loop
  - keyword extraction
applies_to: 'file:src/hooks/user-prompt-submit.ts'
occurred_at: '2025-12-01T16:31:23.220Z'
content_hash: a82f3f93b90b5c96
---
The UserPromptSubmit hook is triggered for every user prompt submission, including prompts generated by `claude -p` CLI calls. When the hook attempts to call `claude -p` to extract keywords from the user's prompt, it triggers itself recursively, creating an infinite loop.

**Root cause:** The hook doesn't distinguish between user-initiated prompts and CLI-generated prompts.

**Impact:** This makes keyword extraction via `claude -p` unfeasible in the UserPromptSubmit hook.

**Solution:** The keyword extraction approach for the UserPromptSubmit hook needs to be reconsidered. Alternative approaches could include:
- Using a different keyword extraction method that doesn't invoke the CLI
- Implementing a flag or mechanism to prevent hook recursion
- Moving keyword extraction to a different component (e.g., MCP server or transcript processor)
