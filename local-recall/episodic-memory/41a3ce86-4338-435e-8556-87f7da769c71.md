---
id: 41a3ce86-4338-435e-8556-87f7da769c71
subject: Transcript parsing needs backward compatibility for test format
keywords:
  - transcript
  - parsing
  - backward-compatibility
  - testing
  - role-field
applies_to: 'file:src/utils/transcript.ts'
occurred_at: '2025-12-21T18:28:33.686Z'
content_hash: b51195c5ade5ef44
---
When updating transcript parsing to handle actual Claude Code format (with content blocks), maintain backward compatibility with existing test format that uses `role: "assistant"|"user"` instead of `type: "message"|"user_message"`.

The parser should gracefully handle both formats:
1. Modern format: `type` field with `content` as array of blocks
2. Legacy test format: `role` field with `content` as string or already-extracted thinking

This prevents breaking existing tests while supporting the real transcript format.
