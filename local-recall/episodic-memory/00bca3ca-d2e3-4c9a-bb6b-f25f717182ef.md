---
id: 00bca3ca-d2e3-4c9a-bb6b-f25f717182ef
subject: >-
  Hooks should NOT directly instantiate SearchEngine to avoid loading ONNX in
  multiple processes
keywords:
  - hooks
  - user-prompt-submit
  - search-engine
  - embedding
  - architecture
applies_to: 'file:src/hooks/user-prompt-submit.ts'
occurred_at: '2025-12-03T11:35:39.170Z'
content_hash: 7a7334620e64883c
---
The user-prompt-submit hook currently loads SearchEngine and ThinkingSearchEngine directly, which triggers ONNX embedding model initialization. This causes mutex errors in concurrent environments. The session-start hook avoids this by only using MemoryManager (file-based operations). Hooks should either use text-based search (no embeddings) or call an HTTP daemon for vector search.
