---
id: 9280c221-20ca-43a3-9bef-ee4223fe28ba
subject: >-
  Mutex lock failed error in UserPromptSubmit hook is caused by direct
  sqlite-vec loading
keywords:
  - mutex error
  - sqlite-vec
  - hook
  - file locking
  - concurrent access
applies_to: 'area:hooks'
occurred_at: '2025-12-03T10:22:44.117Z'
content_hash: 6d2ff7063fe1d0bc
---
The 'libc++abi: terminating due to uncaught exception of type std::__1::system_error: mutex lock failed: Invalid argument' error in UserPromptSubmit hook occurs when the hook directly instantiates SearchEngine and ThinkingSearchEngine, which attempt to load the sqlite-vec native extension. This causes mutex contention when multiple processes try to load sqlite-vec concurrently. The fix is to use the HTTP daemon client instead of direct vector store instantiation, which is already implemented via DaemonClient. The hook should not instantiate VectorStore or SearchEngine directly - it should only call HTTP endpoints on the daemon.
