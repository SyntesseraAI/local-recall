---
id: 00dc3fb3-d4ec-422a-b2d1-644fa4ac1e11
subject: Multiple local-recall instances in same folder have concurrent write conflicts
keywords:
  - concurrency
  - multi-instance
  - orama-index
  - processed-log
  - file-locking
applies_to: global
occurred_at: '2025-12-21T18:22:39.533Z'
content_hash: 196bcc83900a38cc
---
When multiple Claude Code instances run local-recall on the same codebase folder, they cause concurrent write conflicts:

- `orama-episodic-index.json` and `orama-thinking-index.json`: Multiple processes write without coordination, causing data loss
- `processed-log.jsonl`: Append operations can interleave, corrupting the log format
- `thinking-processed-log.jsonl`: Same append issue as episodic version

**Root cause**: No file locking mechanism or process coordination. Each process assumes exclusive access.

**Current workaround**: Hooks are disabled to prevent concurrent writes. Only MCP server daemon writes to memory files.

**Solution needed**: Implement file-based locking (using `proper-lockfile` npm package) or mutex mechanism to coordinate writes across multiple processes.

**Files affected**:
- `src/core/episodic-jsonl-store.ts` - Appends to processed-log.jsonl
- `src/core/thinking-jsonl-store.ts` - Appends to thinking-processed-log.jsonl
- `src/core/vector-store.ts` - Writes index JSON files
- All hook files that write memory

**Current status**: Session-start and user-prompt-submit hooks disabled in CLAUDE.md to prevent the problem.
