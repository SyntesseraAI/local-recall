---
id: 16c9a4a5-15de-483b-8bda-b252a10c168f
subject: >-
  Mutex lock error in hooks caused by direct sqlite-vec loading instead of
  daemon
keywords:
  - mutex
  - sqlite-vec
  - hook
  - error
  - libc++abi
  - locking
applies_to: global
occurred_at: '2025-12-21T18:18:36.755Z'
content_hash: 9532f1e731779968
---
The UserPromptSubmit hook was throwing 'libc++abi: terminating due to uncaught exception of type std::__1::system_error: mutex lock failed: Invalid argument'. This occurs when hooks directly instantiate SearchEngine and ThinkingSearchEngine which attempt to load sqlite-vec. The root cause is that sqlite-vec's native mutex operations fail when called from within the hook subprocess context. Solution: Hooks should use HTTP daemon approach instead of direct database loading to avoid subprocess isolation issues.
