---
id: 2f144a88-f98f-4780-80bd-ebcd0d81f675
subject: Transcript parsing must support both new and legacy message formats
keywords:
  - backward compatibility
  - transcript parsing
  - role vs type
applies_to: 'file:src/utils/transcript.ts'
occurred_at: '2025-12-21T18:30:41.521Z'
content_hash: f7a510435fc3c9b1
---
The transcript parser must handle both:
1. New format: `message.type` field with content as array of blocks
2. Legacy format: `message.role` field with content as string

The `extractThinkingAndContent` helper normalizes both formats into:
- `thinking`: string (extracted from thinking blocks or root thinking field)
- `content`: string (extracted from text blocks or root content field)

This allows the rest of the pipeline (analyzeForMemories, thinking extraction) to work with a consistent format.
