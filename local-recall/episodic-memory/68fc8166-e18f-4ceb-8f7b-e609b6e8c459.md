---
id: 68fc8166-e18f-4ceb-8f7b-e609b6e8c459
subject: transcript-collector.ts implementation - file I/O and jsonl parsing
keywords:
  - transcript-collector
  - jsonl
  - file-io
  - path-construction
  - line-by-line
  - error-handling
  - node-fs
applies_to: 'file:src/core/transcript-collector.ts'
occurred_at: '2025-12-01T16:02:02.840Z'
content_hash: efa9ecda0f74a334
---
# Transcript Collector Implementation Notes

## Key Implementation Details

1. **Path Construction**: The project folder name must replace all slashes in the working directory path with dashes
   - Use `cwd.replace(/\//g, '-')` to convert the path
   - Full transcript path: `~/.claude/projects/{project-folder-name}/transcripts/`

2. **JSONL Parsing**: Transcripts are in JSON Lines format
   - Each line is a separate JSON object
   - Use `readFileSync().toString().split('\n')` then parse each line
   - Handle empty lines gracefully (filter them out)
   - Each object represents a transcript event

3. **File Existence Handling**: The transcript directory may not exist initially
   - Wrap file operations in try-catch blocks
   - Handle `ENOENT` (file not found) errors gracefully
   - Return empty array if no transcripts found yet

4. **Home Directory Expansion**: The `~` character must be expanded to the user's home directory
   - Use `os.homedir()` in Node.js
   - Or manually expand: `process.env.HOME` on Unix/Mac, `process.env.USERPROFILE` on Windows

## Testing Considerations

When testing the transcript collector:
- Create sample `.jsonl` files in test fixtures
- Test both existing and non-existing transcript directories
- Verify JSONL parsing handles edge cases (empty lines, malformed JSON)
