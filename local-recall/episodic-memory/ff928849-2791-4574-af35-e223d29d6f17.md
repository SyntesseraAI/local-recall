---
id: ff928849-2791-4574-af35-e223d29d6f17
subject: Stop hook design changed from time-windowed to full-history processing
keywords:
  - stop-hook
  - memory-extraction
  - transcript-processing
  - architecture
applies_to: 'file:src/hooks/stop.ts'
occurred_at: '2025-12-21T18:20:31.269Z'
content_hash: 30c2e74d88706d27
---
## Stop Hook History Processing Change

### Previous Design (Problematic)
- Used a 30-second time window (default in config)
- Only processed messages from the last 30 seconds of the session
- Problem: By the time the stop hook fired, most transcript messages were older than 30 seconds, so they were filtered out
- Result: Minimal or no memories were created

### New Design
- Processes the entire transcript history
- Relies on deduplication (using `occurred_at` + `content_hash`) to prevent duplicate memories
- Idempotency ensures safe re-processing without duplicates
- Simpler logic: extract suggested memories from all messages, let dedup handle prevention of duplicates
