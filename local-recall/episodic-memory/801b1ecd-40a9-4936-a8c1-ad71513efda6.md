---
id: 801b1ecd-40a9-4936-a8c1-ad71513efda6
subject: Transcript-collector should track processed files using content hashes
keywords:
  - content-hash
  - deduplication
  - transcript-collector
  - file-tracking
  - processed-transcripts
applies_to: 'file:src/core/transcript-collector.ts'
occurred_at: '2025-12-01T16:11:14.136Z'
content_hash: 030f45b8b33f6fd4
---
# Content-Based Tracking for Transcript Processing

When processing JSONL transcript files from Claude's cache, use content hashing instead of file modification times:

## Why Content Hashing is Better

1. **Handling incremental writes**: JSONL files grow line-by-line during sessions. Using mtime will cause reprocessing of the entire file on each write, which is inefficient.

2. **Change detection**: By storing SHA-256 hashes of previously processed files, you can detect when actual new content has been added rather than just checking file timestamps.

3. **Deduplication**: This aligns with the existing memory deduplication logic in `memory.ts` which uses `occurred_at` and `content_hash` to prevent duplicate memories.

## Implementation Pattern

Store a manifest tracking:
- Transcript file path
- SHA-256 hash of the file content
- Timestamp when it was last processed

On each processing cycle:
1. List files in the transcripts directory
2. Calculate hash of each file
3. Compare to stored hash
4. If hash differs or file is new, process the changes
5. Update stored hash

This pattern is already used by the MCP server's background daemon for tracking processed transcripts and is the correct approach.
