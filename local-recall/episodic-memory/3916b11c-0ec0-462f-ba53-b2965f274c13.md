---
id: 3916b11c-0ec0-462f-ba53-b2965f274c13
subject: Fix Claude response parsing for raw array memories in memory extractor
keywords:
  - memory-extractor
  - parseClaudeResponse
  - array-handling
  - zod-validation
  - json-parsing
  - bug-fix
applies_to: 'file:src/core/memory-extractor.ts'
occurred_at: '2025-12-01T21:56:13.504Z'
content_hash: 725cb9a3c1a0ad22
---
## Bug Description

The `parseClaudeResponse` method in memory-extractor.ts expected Claude CLI to return `{ memories: [...] }` but Claude (Haiku) sometimes returns the array directly without the wrapper object.

## Solution

Update the parsing logic to handle both formats:
1. First attempt to parse as `{ memories: [...] }` (wrapped format)
2. If that fails or the memories field is missing, check if the response is an array directly
3. Normalize both formats to ensure consistency

This allows the memory extractor to work reliably with different Claude response formats while maintaining backward compatibility.
