---
id: 98d1d38b-2e07-4ac9-94bf-956b9228e322
subject: Memory extraction handles both object and array response formats from Claude
keywords:
  - memory-extractor
  - parseClaudeResponse
  - claude-output
  - json-parsing
  - error-handling
applies_to: 'file:src/core/memory-extractor.ts'
occurred_at: '2025-12-01T16:04:14.831Z'
content_hash: b4d97aae26cd2efa
---
The `parseClaudeResponse` method must handle both response formats from Claude CLI:

1. **Object format**: `{ memories: [...] }` - Expected format with memories wrapped in object
2. **Array format**: `[...]` - Raw array returned directly by Claude

The parser should:
- First check if response is an array
- If array, use it directly as memories
- If object, extract the `memories` property
- Parse with Zod validation after extracting

This handles Claude Haiku sometimes returning raw arrays instead of the expected object structure.
