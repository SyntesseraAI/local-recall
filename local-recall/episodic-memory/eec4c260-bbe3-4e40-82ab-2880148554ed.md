---
id: eec4c260-bbe3-4e40-82ab-2880148554ed
subject: 'UserPromptSubmit hook uses [LOCAL_RECALL_INTERNAL] token to prevent recursion'
keywords:
  - recursion guard
  - internal prompts
  - hook safety
  - memory extraction
applies_to: 'file:src/hooks/user-prompt-submit.ts'
occurred_at: '2025-12-21T18:24:15.046Z'
content_hash: f088ae035d6d7a3f
---
The UserPromptSubmit hook can trigger recursively when calling `claude -p` for memory extraction. To prevent this, all internal extraction prompts should be prefixed with `[LOCAL_RECALL_INTERNAL]` at the start. The hook checks `prompt.startsWith('[LOCAL_RECALL_INTERNAL]')` to skip processing these internal calls. Additionally, the `claude` command should include `--strict-mcp-config` to disable MCP servers during extraction subprocess calls.
