---
id: 6921ce96-42b8-45a0-9494-9ec1f2cd83d8
subject: >-
  Session guarding issue: memory extraction prompt wasn't filtered by
  [LOCAL_RECALL_INTERNAL] prefix
keywords:
  - session guarding
  - memory extraction
  - local recall internal
  - prompt filtering
  - recursion prevention
applies_to: global
occurred_at: '2025-12-21T19:22:59.576Z'
content_hash: a7e3f89afd3b5098
---
The UserPromptSubmit hook guards against processing internal prompts by checking for `[LOCAL_RECALL_INTERNAL]` prefix, but the memory extraction prompt generated by `buildMemoryExtractionPrompt()` in `src/prompts/memory-extraction.ts` didn't include this prefix. This caused the memory extraction prompt itself to be processed as a regular user prompt, creating unwanted recursion in logs. Fixed by adding the prefix to the start of the memory extraction prompt (line 62-63).
