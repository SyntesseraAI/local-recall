---
id: 77398b7e-084c-4d7e-a6ef-3de483ffdd48
subject: sqlite-vec requires 'k = ?' parameter in vector search queries
keywords:
  - sqlite-vec
  - vector-search
  - query
  - syntax
applies_to: 'file:src/core/vector-store.ts'
occurred_at: '2025-12-21T18:17:30.301Z'
content_hash: e9231241783d026a
---
The sqlite-vec extension requires the 'k = ?' parameter in the vector search clause when using JOINs. Initial implementation failed because scope filtering was applied in the SQL JOIN, causing sqlite-vec to enforce the k limit before the JOIN filtered results. Fixed by fetching more results than needed (k * 2) and filtering by scope in JavaScript post-processing to avoid this constraint.
