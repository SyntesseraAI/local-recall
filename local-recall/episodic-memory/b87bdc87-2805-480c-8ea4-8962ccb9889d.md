---
id: b87bdc87-2805-480c-8ea4-8962ccb9889d
subject: >-
  Plugin hooks were using stale better-sqlite3 dependency that was replaced with
  Orama
keywords:
  - plugin
  - hooks
  - better-sqlite3
  - orama
  - migration
  - stale-code
applies_to: 'area:plugin-integration'
occurred_at: '2025-12-21T18:29:21.341Z'
content_hash: c98e5a7bde5c8d8f
---
The dev-marketplace/local-recall-plugin had stale hook files (user-prompt-submit-thinking.js) that tried to import better-sqlite3, a native module that cannot be bundled. The main codebase migrated from better-sqlite3 to Orama (pure JavaScript vector store) but the plugin's hooks.json still referenced the old thinking hook file. The fix involved:

1. Removing the stale user-prompt-submit-thinking.js file
2. Updating hooks.json to point to user-prompt-submit.js (which handles both episodic and thinking memories via configuration)
3. Rebuilding the plugin scripts

Key lesson: Plugin bundled hooks should be kept in sync with main project migrations, especially when swapping dependencies from native modules (better-sqlite3) to pure JavaScript (Orama).
