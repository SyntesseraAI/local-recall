---
id: 894b058f-30a3-462f-a350-8a9df3f591d9
subject: Memory extractor parseClaudeResponse fails when Claude returns array directly
keywords:
  - memory-extractor
  - parseClaudeResponse
  - zod-validation
  - claude-response-format
  - array-wrapping
  - haiku-model
applies_to: 'file:src/core/memory-extractor.ts'
occurred_at: '2025-12-21T19:18:46.281Z'
content_hash: 151058a89cb4f412
---
The `parseClaudeResponse` method in memory-extractor.ts expects Claude to return an object with a `memories` key: `{ memories: [...] }`. However, Claude (particularly Haiku) sometimes returns memories as a plain array directly: `[...]`. This causes Zod validation to fail with 'Expected object, received array'. The fix wraps raw arrays in the expected format before validation (lines 174-177). Added comprehensive unit tests in tests/unit/core/memory-extractor.test.ts covering this scenario.
