---
id: cf6c3157-221a-4ab8-8c2c-f5816b45cd7a
subject: Local Recall uses vector embeddings for semantic search
keywords:
  - vector-embeddings
  - semantic-search
  - fastembed
  - bge-small
  - similarity-score
  - cosine-distance
applies_to: 'area:search'
occurred_at: '2025-12-02T21:15:40.272Z'
content_hash: 29b92cac6cce8016
---
# Vector Embeddings and Semantic Search

## Technology Stack

- **Embedding Model**: BGE-small-en-v1.5 (Baidu General Embedding)
- **Library**: fastembed (fast, lightweight embedding generation)
- **Vector Store**: SQLite with sqlite-vec extension
- **Database**: better-sqlite3 for fast, synchronous access

## Model Cache

- Model files (~133MB) automatically downloaded on first use
- Cached in `local_cache/fast-bge-small-en-v1.5/`
- First run may take 30-60 seconds for download
- Subsequent runs load from cache (very fast)

## Search Scoring

- Uses **cosine distance** similarity metric
- Score range: 0.0 (no match) to 1.0 (identical)
- Scores rounded to 2 decimal places (e.g., 0.65)
- Results sorted by score descending
- **Recency tie-breaker**: When scores equal, more recent memories ranked first

## Search Implementation

Both hooks use the vector store:
- `UserPromptSubmit` hook performs semantic search on user input
- Lazy initialization: vector store initialized on first search, cached after
- `SessionStart` hook loads 5 most recent memories (doesn't use vector store to avoid slow initialization)

## Advantages

- Semantic understanding of memory content (not just keyword matching)
- Fast search even with hundreds of memories
- Automatic relevance ranking based on similarity
