---
id: 60e57dfe-a5b3-466d-9d9f-0f3306bf215a
subject: Memory files must deduplicate based on occurred_at and content_hash
keywords:
  - deduplication
  - memory-files
  - occurred_at
  - content_hash
  - idempotent
  - duplicates
applies_to: 'file:src/core/memory.ts'
occurred_at: '2025-12-02T06:30:04.182Z'
content_hash: 318314ec805a3b65
---
# Memory Deduplication Strategy

Memory files are deduplicated using a combination of:

1. **occurred_at** - The timestamp when the original event/conversation occurred
2. **content_hash** - A SHA-256 hash prefix (16 characters) of the memory content

## Deduplication Logic

When creating a new memory, the system checks if a duplicate already exists by:
- Comparing the `occurred_at` timestamp
- Comparing the `content_hash` of the content

If a duplicate is found, the existing memory is returned instead of creating a new one. This ensures that processing the same transcript multiple times doesn't create duplicate memories.

## Implementation Details

- The `findDuplicate(occurredAt, contentHash)` method in `src/core/memory.ts` checks for existing duplicates
- Both the timestamp and content hash must match to be considered a duplicate
- This enables idempotent memory creation - same input always produces the same result

## Why This Matters

The memory system processes transcripts asynchronously and may process the same transcript multiple times (if it's updated or for error recovery). Deduplication prevents the same insights from being stored multiple times.
