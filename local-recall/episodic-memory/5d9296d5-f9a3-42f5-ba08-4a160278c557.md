---
id: 5d9296d5-f9a3-42f5-ba08-4a160278c557
subject: >-
  Mutex lock failed error caused by concurrent sqlite-vec loading across
  processes
keywords:
  - sqlite-vec
  - mutex
  - concurrency
  - threading
  - error
  - pthread
  - EINVAL
applies_to: global
occurred_at: '2025-12-21T18:28:52.966Z'
content_hash: be94ba3699fdccdb
---
The 'mutex lock failed: Invalid argument' error occurs when multiple processes try to load sqlite-vec simultaneously. The error is a C++ pthread_mutex_lock() returning EINVAL, which happens when a thread attempts to lock a mutex that was destroyed or already locked in an invalid state.

### Root Cause
When the parent process creates a child process (via execFile), the child inherits a copy of the parent's memory, including any partially-initialized sqlite-vec state. If the parent had begun loading sqlite-vec but hadn't fully initialized it, the child gets an invalid/corrupted mutex that causes pthread_mutex_lock() to fail with EINVAL.

### Solution
Avoid loading sqlite-vec in the parent process before spawning children. Instead:
1. Load sqlite-vec only in the child process after execFile returns
2. Or use a different approach that doesn't require sqlite-vec in the parent
3. Ensure proper initialization order and process isolation

### Technical Details
- Error message: 'mutex lock failed: Invalid argument (os error 22)'
- Occurs with native modules that use mutexes (sqlite-vec, Orama integration)
- Most common when using child_process.execFile() to spawn TypeScript/Node.js subprocesses
