---
id: fe80f2a6-0f85-4e45-a3fc-2ba9c9b666c9
subject: MCP server transcript processing and memory extraction workflow
keywords:
  - mcp-server
  - transcript
  - memory-extraction
  - background-daemon
  - claude-api
  - content-hash
  - deduplication
applies_to: 'area:mcp-server'
occurred_at: '2025-12-01T15:59:51.586Z'
content_hash: 2a21cdd93d6d5198
---
# MCP Server Transcript Processing

## Background Daemon Process

The MCP server runs a background daemon that:
1. Syncs transcripts from Claude's cache (`~/.claude/projects/<project>/transcripts/`)
2. Processes transcripts using `claude -p` to extract memories
3. Tracks processed transcripts with content hashes for change detection
4. Deletes and recreates memories when transcripts change
5. Runs every 5 minutes

## Memory Extraction from Transcripts

- The daemon uses `claude -p --model haiku` to analyze transcripts
- It prompts Claude to extract valuable memories from the session
- The prompt instructs Claude to return JSON with memory objects
- Each memory includes: subject, keywords, applies_to scope, and content

## Deduplication Strategy

- Memories are tracked by occurred_at timestamp and content_hash
- The `findDuplicate()` function checks for existing memories before creation
- When a transcript changes (detected via content hash), old memories are deleted
- New memories are created from the updated transcript

## Important Implementation Details

- The MCP server should handle transcript path resolution carefully
- Claude's transcript format is JSONL (JSON Lines)
- The background daemon should handle errors gracefully and continue processing
- Transcript processing should not block the main MCP server thread
