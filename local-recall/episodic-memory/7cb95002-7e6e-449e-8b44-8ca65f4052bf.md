---
id: 7cb95002-7e6e-449e-8b44-8ca65f4052bf
subject: Thinking memory retrieval changed from count-based to token-based limiting
keywords:
  - thinking-memory
  - retrieval
  - token-limit
  - memory-injection
applies_to: 'file:src/hooks/user-prompt-submit-thinking.ts'
occurred_at: '2025-12-03T09:47:22.389Z'
content_hash: 352669b55e9488da
---
Memory retrieval now uses token-based limiting instead of fixed count limits. Configurable via LOCAL_RECALL_THINKING_MAX_TOKENS (default 1000). Memories are added until hitting the token budget. Also added LOCAL_RECALL_THINKING_MIN_SIMILARITY (default 0.8) for similarity threshold filtering. This provides more consistent context injection regardless of memory sizes.
