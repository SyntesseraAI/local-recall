---
id: 55516468-0ecb-4dd1-89f8-8aee32620b32
subject: >-
  Stop hook is currently disabled; MCP server handles memory extraction
  asynchronously
keywords:
  - stop-hook
  - mcp-server
  - memory-extraction
  - asynchronous
  - daemon
  - disabled
applies_to: global
occurred_at: '2025-12-02T17:11:09.082Z'
content_hash: 4a7f33ef9b64be1f
---
# Memory Extraction Architecture

## Current Approach: MCP Server Daemon

Memory extraction is NOT handled by the Stop hook. Instead:
1. **Stop Hook**: Currently disabled (not in active use)
2. **MCP Server**: Runs a background daemon that handles memory extraction
3. **Processing**: Asynchronous, runs every 5 minutes

## Background Daemon Flow

1. Syncs transcripts from Claude's cache (`~/.claude/projects/<project>/transcripts/`)
2. Processes transcripts using `claude -p` to extract memories
3. Tracks processed transcripts with content hashes for change detection
4. Deletes and recreates memories when transcripts change
5. Runs every 5 minutes

## Why This Design?

- **Decouples memory extraction from session lifecycle**: Sessions end quickly, extraction can take time
- **Batching**: Processing multiple transcripts in one daemon cycle is more efficient
- **Error resilience**: If extraction fails, daemon retries on next cycle
- **User experience**: No blocking on session end

## Implementation Location

The daemon logic is in `src/mcp-server/server.ts`. The extraction happens via MCP tools that accept transcript data.

## Important Note

The Stop hook is currently disabled - any implementation of transcript processing should happen in the MCP daemon, not in hooks.
