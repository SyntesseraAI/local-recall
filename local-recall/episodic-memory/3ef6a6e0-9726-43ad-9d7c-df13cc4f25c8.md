---
id: 3ef6a6e0-9726-43ad-9d7c-df13cc4f25c8
subject: >-
  Fixed stop hook transcript parsing - type field was checking for 'message'
  instead of 'user'/'assistant'
keywords:
  - stop hook
  - transcript parsing
  - bug fix
  - type field
  - message filter
applies_to: 'file:src/hooks/stop.ts'
occurred_at: '2025-12-01T16:00:18.618Z'
content_hash: a4bba7c42a437226
---
## Bug Fixed

The stop hook at `src/hooks/stop.ts:97` was checking `entry.type === 'message'` but the actual transcript format uses `entry.type === 'user'` or `entry.type === 'assistant'`. This caused the transcript parsing to fail silently, not filtering entries correctly.

## Root Cause

The transcript format from Claude Code has entries with `type` values of 'user' or 'assistant', not 'message'. The code was filtering for the wrong type value.

## Solution

Changed the type check from `entry.type === 'message'` to check for both 'user' and 'assistant' types, or use a negation pattern to filter out other types.

## Impact

This fix ensures the transcript parser correctly identifies user and assistant messages in the transcript, allowing the stop hook to properly extract memories from session transcripts.
