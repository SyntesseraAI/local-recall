---
id: 3af2510f-5ef3-4f32-959d-afacc0c664df
subject: Fix Claude response parsing for raw array memories in memory extractor
keywords:
  - memory-extractor
  - parseClaudeResponse
  - array-handling
  - zod-validation
  - json-parsing
applies_to: 'file:src/core/memory-extractor.ts'
occurred_at: '2025-12-01T21:53:44.359Z'
content_hash: e8be208cb12ff9f4
---
## Issue
The `parseClaudeResponse` method in memory-extractor.ts expected Claude CLI to return `{ memories: [...] }` but Claude (Haiku) sometimes returns memories as a raw array `[...]`.

## Solution
Updated the parsing logic to handle both formats:
1. First attempt to parse as object with `memories` property
2. Fall back to parsing as raw array if that fails
3. Validate all items against the memory schema using Zod

## Code Location
`src/core/memory-extractor.ts` - `parseClaudeResponse` method

## Impact
This fix ensures the memory extraction pipeline is robust to different Claude CLI response formats, preventing memory loss when Claude returns unexpected response structures.
