---
id: 5d6e962f-8c38-4a7b-a397-e98c6374c2d9
subject: >-
  User-prompt-submit hook now directly uses vector stores with file-based
  locking
keywords:
  - hooks
  - user-prompt-submit
  - episodic
  - thinking
  - direct-access
applies_to: 'file:src/hooks/user-prompt-submit.ts'
occurred_at: '2025-12-03T10:13:19.759Z'
content_hash: 9203595cd445bec7
---
Updated the hook to instantiate SearchEngine and ThinkingSearchEngine directly instead of making HTTP calls:

- Creates instances of SearchEngine and ThinkingSearchEngine locally
- Both engines initialize VectorStore/ThinkingVectorStore with file-based locking
- Runs episodic and thinking searches sequentially (not in parallel)
- All database operations are protected by cross-process file locks
- Falls back gracefully if vector store initialization fails (returns empty results)

The sequential execution and file-based locking ensure no mutex conflicts occur.
