---
id: 97205d5a-c460-4d2d-beef-b22545bf04da
subject: >-
  Memory system redesigned to be immutable episodic log with content-based
  deduplication
keywords:
  - memory
  - idempotency
  - deduplication
  - architecture
  - episodic
applies_to: global
occurred_at: '2025-12-21T19:17:28.905Z'
content_hash: 6f6a9c92768134df
---
# Memory System Architecture Change

Shifted from mutable knowledge base to immutable episodic memory log, similar to how human memory works.

## Key Design Changes

1. **Immutability**: Memories cannot be updated or deleted programmatically. Only manual user deletion is allowed.

2. **Deduplication Strategy**: Each memory has three timestamps/hashes:
   - `occurred_at` - When the conversation/event happened (from transcript)
   - `created_at` - When the memory file was written
   - `content_hash` - SHA-256 hash prefix (16 chars) of memory content
   
   Deduplication key is `occurred_at + content_hash`. If a memory with the same timestamp and content hash already exists, it's skipped rather than recreated.

3. **Processing Scope**: Changed from processing only recent messages (30-second window) to processing entire transcript history. This allows full context capture while deduplication prevents duplicates when the same transcript is re-processed.

## Implementation Details

- `computeContentHash()` function uses SHA-256 truncated to 16 characters
- `findDuplicate()` method checks for existing memory by occurred_at + content_hash
- Removed mutable operations: no `updateMemory()` or deleteMemory operations from MCP tools
- Stop hook now processes entire transcript instead of using 30-second time window
