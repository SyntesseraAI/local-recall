---
id: 275931d6-1d20-45cf-a01e-1ea1b8f4900f
subject: Proper error handling pattern for spawned child processes with timeouts
keywords:
  - spawn
  - error handling
  - timeout
  - promise
  - safe resolve
applies_to: 'file:src/hooks/user-prompt-submit.ts'
occurred_at: '2025-12-21T18:27:26.099Z'
content_hash: f951a14c4c5b29bf
---
When spawning child processes in Node.js, use Promise.race() with a manual timeout instead of the built-in timeout option. Wrap the promise resolution in a guard function (e.g., `safeResolve`) that only allows the promise to resolve once. This prevents race conditions between timeout expiration and normal process completion. Always ensure error events and abort errors are properly caught with try-catch blocks around await statements.
