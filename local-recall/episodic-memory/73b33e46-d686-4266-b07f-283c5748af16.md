---
id: 73b33e46-d686-4266-b07f-283c5748af16
subject: Refactor stop.ts to use parseTranscriptForMemories from transcript.ts
keywords:
  - stop.ts
  - transcript.ts
  - parsing
  - deduplication
  - refactor
  - architecture
applies_to: 'file:src/hooks/stop.ts'
occurred_at: '2025-12-01T16:26:26.253Z'
content_hash: 173e491a2099cefb
---
The stop.ts hook had duplicate transcript parsing logic that was broken and didn't properly handle thinking blocks. Refactored to use a new `parseTranscriptForMemories()` function exported from transcript.ts instead. This function takes raw JSONL content and returns memory suggestions ready to save. The stop.ts hook now simply: 1) reads transcript file, 2) calls parseTranscriptForMemories(), 3) saves results. This removes all parsing logic from stop.ts and makes the functionality reusable elsewhere.

Key insight: Thinking blocks have a `thinking` property, not `text`. The old code was checking `c.text` on thinking blocks, causing them to be dropped.
