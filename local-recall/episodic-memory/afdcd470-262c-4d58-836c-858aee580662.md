---
id: afdcd470-262c-4d58-836c-858aee580662
subject: Fix AbortError in user-prompt-submit hook's Claude CLI subprocess handling
keywords:
  - abort error
  - spawn timeout
  - child process
  - promise rejection
  - user-prompt-submit hook
  - nodejs
  - error handling
applies_to: 'file:src/hooks/user-prompt-submit.ts'
occurred_at: '2025-12-01T15:55:46.979Z'
content_hash: 01984e1026a3a988
---
The user-prompt-submit hook was throwing an unhandled AbortError when calling Claude CLI for keyword extraction. The issue was caused by:

1. **Root cause**: The `spawn()` function had a `timeout: 30000` that triggered an AbortController, which killed the child process and rejected the promise with an AbortError
2. **Problem**: The promise rejection was not being caught, causing an unhandled rejection that crashed the hook
3. **Solution**: Wrapped the spawn call in try-catch and properly handled the AbortError case
4. **Key insight**: When using timeouts with spawn, the AbortError is thrown as a rejected promise, not as an error event on the child process
5. **Implementation**: Added proper error handling to catch both AbortError and regular errors from the subprocess
