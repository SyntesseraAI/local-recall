---
id: b4e87b56-668b-46e1-a4cb-a116682090c9
subject: >-
  Memory extractor parseClaudeResponse expects { memories: [...] } but Claude
  returns raw arrays sometimes
keywords:
  - memory-extractor
  - claude-response
  - parsing
  - array-wrapper
  - type-validation
applies_to: 'file:src/core/memory-extractor.ts'
occurred_at: '2025-12-21T18:26:15.052Z'
content_hash: 6506d282342a660d
---
In `parseClaudeResponse` at line 174, the schema expects an object with a `memories` key (`{ memories: [...] }`), but Claude (especially Haiku) sometimes returns a plain array directly (`[...]`). Added detection to wrap raw arrays in the expected format before validation. This handles the case where Claude returns memory objects as a top-level array instead of nested in an object.

The fix checks if the parsed JSON is an array and wraps it: `if (Array.isArray(parsed)) { parsed = { memories: parsed }; }`

This ensures consistent parsing regardless of whether Claude returns the structured format or the simpler array format.
