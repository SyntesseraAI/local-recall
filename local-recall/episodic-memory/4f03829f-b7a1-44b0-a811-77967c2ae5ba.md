---
id: 4f03829f-b7a1-44b0-a811-77967c2ae5ba
subject: >-
  Memory extractor must handle both array and object response formats from
  Claude
keywords:
  - memory-extractor
  - parseClaudeResponse
  - claude-response-format
  - error-handling
  - haiku
applies_to: 'file:src/core/memory-extractor.ts'
occurred_at: '2025-12-21T19:19:00.855Z'
content_hash: e5759a9b0d868240
---
The `parseClaudeResponse` method in memory-extractor.ts was failing when Claude returned memories as a plain array `[{...}]` instead of the expected object format `{ memories: [...] }`. Added array detection at line 174-177 that checks if the parsed JSON is an array and wraps it in the expected format before Zod validation. This handles the case where Claude (especially Haiku) returns the data directly without the wrapper object. This fix prevents 'Expected object, received array' validation errors.
