---
id: 1337d912-92dc-467d-b392-e3ba88f0dc1d
subject: sqlite-vec requires 'k = ?' parameter in JOIN queries with scope filtering
keywords:
  - sqlite-vec
  - sql
  - vector-search
  - scope-filter
  - join
applies_to: 'file:src/core/vector-store.ts'
occurred_at: '2025-12-21T18:17:02.145Z'
content_hash: a82b505a11ddd749
---
The sqlite-vec extension requires k = ? (limit parameter) in the match clause when using JOIN queries. When scope filtering is applied, sqlite-vec applies the k limit before the JOIN filter, reducing results below the requested limit. Solution: Fetch k * 2 results from sqlite-vec (without scope filter) and filter scopes in JavaScript code afterward. This ensures enough results pass the scope filter.
