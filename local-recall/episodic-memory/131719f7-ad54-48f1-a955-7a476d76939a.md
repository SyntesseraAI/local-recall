---
id: 131719f7-ad54-48f1-a955-7a476d76939a
subject: >-
  Memory deduplication uses occurred_at timestamp and content_hash to prevent
  duplicates
keywords:
  - deduplication
  - duplicate detection
  - occurred_at
  - content_hash
  - idempotent
  - memory creation
applies_to: global
occurred_at: '2025-12-21T19:04:31.826Z'
content_hash: e64d35b2dcd60a7c
---
## Problem

When creating memories, especially through automated extraction from transcripts, the same memory could be created multiple times.

## Solution

Memories are deduplicated using two fields:

1. **`occurred_at`** - ISO-8601 timestamp of when the original event occurred
2. **`content_hash`** - SHA-256 hash prefix (16 characters) of the memory content

## How It Works

When creating a new memory, the system:
1. Calculates the content hash of the memory content
2. Looks for existing memories with the same `occurred_at` and `content_hash`
3. Returns the existing memory if found (no duplicate created)
4. Creates a new memory only if no duplicate exists

## Benefits

- **Idempotent**: Creating the same memory multiple times always returns the same ID
- **Timestamp-based**: Allows memories of similar content created at different times
- **Hash-based**: Detects exact content matches even if metadata differs
- **Stable IDs**: Same event always produces same memory ID

## Code Location

`src/core/memory.ts` - `findDuplicate(occurredAt, contentHash)` and `createMemory()` implement deduplication logic.
