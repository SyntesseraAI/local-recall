---
id: 77718fa3-9915-4e02-a0e5-0ff64bdd09a5
subject: >-
  Mutex errors caused by concurrent sqlite-vec database operations across
  processes
keywords:
  - sqlite-vec
  - mutex
  - concurrency
  - database
  - locking
  - hooks
applies_to: global
occurred_at: '2025-12-03T10:13:19.759Z'
content_hash: 2046221de9c3da82
---
The mutex lock errors ("libc++abi: terminating due to uncaught exception of type std::__1::system_error: mutex lock failed: Invalid argument") were caused by concurrent database operations in sqlite-vec. The root cause:

1. Multiple processes (hooks) and the daemon were opening separate database connections
2. Each connection loaded sqlite-vec independently
3. sqlite-vec's internal mutexes corrupted when operations overlapped

The HTTP server approach (hooks → daemon → HTTP → vector store) was insufficient because it only serialized HTTP requests, not the actual database operations within the daemon.

Solution: Implemented cross-process file-based locking that serializes ALL sqlite-vec operations, not just the load step.
