---
id: 23677301-dc9f-4cb6-9d21-e71021bd7826
subject: 'Memory extraction is handled by MCP server daemon, not Stop hook'
keywords:
  - memory-extraction
  - mcp-server
  - stop-hook
  - disabled
  - background-daemon
  - transcript-processing
applies_to: 'area:memory-extraction'
occurred_at: '2025-12-02T17:53:06.258Z'
content_hash: 1d4a34a6d73b6f46
---
# Memory Extraction Architecture

## Current Implementation

Memory extraction is NOT handled by the Stop hook. Instead:
- The Stop hook is **disabled** in the hooks configuration
- Memory extraction is handled by the MCP server running as a **background daemon**
- The daemon processes transcripts **asynchronously every 5 minutes**

## Why This Design

1. **Performance**: Extracting memories on every Stop hook would block the user's workflow
2. **Reliability**: Asynchronous processing is more resilient to failures
3. **Efficiency**: Batch processing of multiple sessions is more efficient

## Implementation Details

The MCP server daemon:
- Syncs transcripts from Claude's cache (`~/.claude/projects/<project>/transcripts/`)
- Processes transcripts using `claude -p` to extract memories
- Tracks processed transcripts with content hashes for change detection
- Deletes and recreates memories when transcripts change
- Runs on a 5-minute interval

This is documented in the CLAUDE.md project instructions.
