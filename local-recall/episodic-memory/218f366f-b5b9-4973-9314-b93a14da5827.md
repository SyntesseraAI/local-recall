---
id: 218f366f-b5b9-4973-9314-b93a14da5827
subject: >-
  Refactor transcript parsing to avoid duplication between stop.ts and
  transcript.ts
keywords:
  - transcript parsing
  - code duplication
  - refactoring
  - memory extraction
  - jsonl
applies_to: global
occurred_at: '2025-12-01T23:16:45.613Z'
content_hash: 8f19635a84d7f2f9
---
The stop.ts hook had duplicate parsing logic that reimplemented transcript parsing instead of using shared utilities from transcript.ts. This caused bugs where thinking blocks weren't being captured correctly (the code checked c.text instead of c.thinking for thinking blocks). The fix was to:

1. Export parseTranscriptForMemories() from transcript.ts that takes raw JSONL content and returns memory suggestions
2. Simplify stop.ts to just read the transcript file, call parseTranscriptForMemories(), and save the results
3. This architectural pattern (raw content → parser → suggestions) allows transcript parsing to be reused elsewhere

This removes parsing and looping logic from stop.ts and centralizes memory extraction in transcript.ts.
