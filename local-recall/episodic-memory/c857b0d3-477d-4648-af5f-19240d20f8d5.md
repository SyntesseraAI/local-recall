---
id: c857b0d3-477d-4648-af5f-19240d20f8d5
subject: >-
  UserPromptSubmit hook causes infinite recursion by calling 'claude -p' which
  triggers itself
keywords:
  - userpromptsubmit
  - hook
  - recursion
  - infinite loop
  - claude command
  - subprocess
applies_to: 'file:src/hooks/user-prompt-submit.ts'
occurred_at: '2025-12-01T21:46:02.484Z'
content_hash: 6cabd26fa8165ccd
---
The UserPromptSubmit hook in src/hooks/user-prompt-submit.ts calls `claude -p` to extract keywords from user prompts. However, executing `claude -p` spawns a subprocess that triggers the same UserPromptSubmit hook, creating infinite recursion.

**Problem**: The hook was designed to use Claude to extract keywords, but this creates a circular dependency where the hook calls Claude, which calls the hook again.

**Solution**: Instead of using Claude to extract keywords, switch to a keyword extraction library like `keywords-extractor` or implement simple keyword extraction logic (e.g., using TF-IDF). This avoids the subprocess call and infinite recursion.

**Related files**: src/core/memory-extractor.ts may need updates to handle keyword extraction differently.
