---
id: c42bfcbc-3521-4d6d-a08a-de706e12a5a2
subject: sqlite-vec mutex lock error occurs with concurrent process initialization
keywords:
  - sqlite-vec
  - mutex-lock
  - concurrency
  - initialization
  - error-handling
applies_to: 'file:src/utils/database.ts'
occurred_at: '2025-12-21T18:17:33.752Z'
content_hash: 6cb03f4fc7151120
---
When multiple processes try to call `sqlite-vec.load(db)` simultaneously, a C++ runtime mutex lock error occurs. This happens because sqlite-vec initializes native extensions that require exclusive access during loading. The solution uses a file-based lock mechanism with a temporary `.lock` file to serialize access to sqlite-vec initialization across concurrent processes. Locks are automatically cleaned up if they become stale (older than 30 seconds), preventing deadlocks from abandoned lock files.
