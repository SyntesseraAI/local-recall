---
id: 3446fe4a-22fc-4a71-bdb0-8100415f496f
subject: UserPromptSubmit hook causes recursion when calling claude -p CLI
keywords:
  - hook
  - recursion
  - claude-p
  - user-prompt-submit
  - stdin
  - bug
applies_to: global
occurred_at: '2025-12-01T16:19:22.293Z'
content_hash: d17aaff766edcac9
---
The UserPromptSubmit hook invokes `claude -p` to extract keywords from user prompts. However, this creates a recursion problem: the inner Claude process also triggers UserPromptSubmit, which calls `claude -p` again, potentially creating infinite recursion.

**Current Implementation:** The hook in `src/hooks/user-prompt-submit.ts` calls `claude -p --model haiku` to extract keywords.

**The Problem:** When Claude is invoked with `claude -p`, it starts a new interactive session that triggers the UserPromptSubmit hook. This inner session will also try to call `claude -p`, creating a chain of nested processes.

**Solution:** The `claude -p` invocation needs to run in a way that doesn't trigger the hook again. Options:
1. Use `--disable-hooks` flag if available
2. Set an environment variable that the hook checks before executing
3. Use a different approach to extract keywords without invoking Claude (e.g., local keyword extraction)
4. Use the Claude API directly instead of the CLI
