---
id: 30edc98b-75e4-41dc-87ba-2755fc306aa7
subject: Mutex lock failures occur when multiple processes load sqlite-vec concurrently
keywords:
  - mutex
  - sqlite-vec
  - concurrent
  - process
  - locking
  - error
applies_to: global
occurred_at: '2025-12-21T18:21:04.841Z'
content_hash: f35ebd4203aa3ba6
---
# Mutex Lock Error with sqlite-vec

The codebase has a known issue where multiple processes loading sqlite-vec can trigger "mutex lock failed: Invalid argument" errors. This occurs during concurrent access to the sqlite-vec library.

## Context
- Located in src/mcp-server/server.ts:230
- Cross-process file locking is being used as a mitigation strategy
- Mutex errors happen specifically when multiple processes try to load sqlite-vec simultaneously

## Solution Applied
- Cross-process file locking prevents sqlite-vec mutex errors
- This suggests using file-based locks to serialize access to sqlite-vec across different processes

## Testing Note
- No existing tests found for mutex behavior (grep for 'mutex' and 'concurrent' returned no test files)
- Tests for concurrent access patterns should be added to prevent regressions
