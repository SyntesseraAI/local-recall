---
id: 2274ebc2-e1d9-4199-b609-e8e287c09ff1
subject: >-
  Memory extraction system processes its own internal prompts, causing infinite
  recursion
keywords:
  - memory extraction
  - transcript processing
  - LOCAL_RECALL_INTERNAL
  - recursion bug
  - transcript format
  - system prompts
applies_to: global
occurred_at: '2025-12-02T06:34:48.954Z'
content_hash: 7fcddcfa059443ae
---
The memory extraction system has a critical bug: it processes `[LOCAL_RECALL_INTERNAL]` prefixed messages in transcripts, which are actually the system's own internal prompts being echoed back into the transcript. This causes the system to re-process its own prompts recursively.

**Root Cause**: The transcript processing doesn't distinguish between user messages and system-injected prompts. When the memory extraction prompt is injected into the transcript context, it gets recorded in the transcript and then re-processed on the next cycle.

**Impact**: This leads to infinite recursion where the extraction prompt keeps generating the same memories over and over, or worse, processing garbled/incomplete versions of its own output.

**Solution**: Filter out `[LOCAL_RECALL_INTERNAL]` prefixed lines from transcripts before processing, or use a different mechanism to inject system prompts that doesn't pollute the transcript.

**Related Files**: 
- src/hooks/user-prompt-submit.ts (processes transcripts)
- src/core/transcript-collector.ts (collects transcript data)
- src/core/memory-extractor.ts (extracts memories from transcripts)
