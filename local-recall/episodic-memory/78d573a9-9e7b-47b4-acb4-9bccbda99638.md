---
id: 78d573a9-9e7b-47b4-acb4-9bccbda99638
subject: >-
  Architecture: Hooks should not directly load sqlite-vec, use HTTP daemon
  instead
keywords:
  - architecture
  - hooks
  - daemon
  - process isolation
  - sqlite-vec
applies_to: global
occurred_at: '2025-12-21T18:19:08.315Z'
content_hash: 3a2ef456d96a04ac
---
The local-recall system has a fundamental architectural issue: hooks (SessionStart, UserPromptSubmit) are attempting to directly load sqlite-vec for vector operations, but they run in sandboxed Claude Code hook processes that don't have proper process isolation.

The correct architecture:
- Hooks should NOT load sqlite-vec directly
- Hooks should use HTTP communication to a background daemon (MCP server) for vector operations
- Only the daemon process should load sqlite-vec to avoid mutex contention

This prevents mutex errors and provides better separation of concerns. The MCP daemon can run persistently while hooks remain lightweight.
