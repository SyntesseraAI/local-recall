---
id: 124013cd-93d7-4f92-9e4d-3b55eb1fc2bc
subject: MCP server background daemon transcript processing and memory extraction flow
keywords:
  - mcp-server
  - background-daemon
  - transcript-processing
  - memory-extraction
  - sync
  - deduplication
  - content-hash
applies_to: 'area:mcp-server'
occurred_at: '2025-12-01T15:56:44.059Z'
content_hash: 825d5a9de3cee340
---
# MCP Server Background Daemon

## Purpose

The MCP server runs a background daemon that:
1. Syncs transcripts from Claude's cache (`~/.claude/projects/<project>/transcripts/`)
2. Processes transcripts using `claude -p` to extract memories
3. Tracks processed transcripts with content hashes for change detection
4. Deletes and recreates memories when transcripts change
5. Runs every 5 minutes

## How It Works

1. **Transcript Discovery**: Daemon scans the Claude project's transcript directory
2. **Content Hash Tracking**: Each processed transcript is tracked by its content hash
3. **Memory Extraction**: Uses `claude -p` (claude prompt command) to extract structured memories from transcript content
4. **Deduplication**: If a transcript's content hash hasn't changed, skip reprocessing
5. **Memory Updates**: If transcript changes, delete old memories and create new ones

## Current Status

The Stop hook is disabled in favor of this background daemon approach, which allows asynchronous memory extraction without blocking the user's Claude session.

## Implementation Notes

- Runs every 5 minutes (configurable)
- Needs access to `~/.claude/projects/<project>/transcripts/` directory
- Must handle JSONL transcript format
- Should gracefully handle cases where transcript directory doesn't exist
