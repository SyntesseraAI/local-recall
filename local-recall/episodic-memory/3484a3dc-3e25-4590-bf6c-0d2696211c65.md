---
id: 3484a3dc-3e25-4590-bf6c-0d2696211c65
subject: >-
  onnxruntime-node native mutex issue with fastembed in concurrent hook
  processes
keywords:
  - mutex
  - fastembed
  - onnxruntime-node
  - native bindings
  - concurrency
  - embedding
  - hook process
applies_to: global
occurred_at: '2025-12-21T18:28:55.282Z'
content_hash: 04f20297391e80fc
---
After migrating from sqlite-vec to Orama, mutex errors persisted because fastembed (used for embeddings) depends on onnxruntime-node, which has native bindings that cause the same mutex contention issues as sqlite-vec when loaded by multiple concurrent hook processes. The solution is to serialize access using proper-lockfile with a file-based lock at `/tmp/local-recall-embedding.lock` with 10 retries and 30-second stale timeout, protecting both initialization and embedding operations.
