---
id: ac09c368-45f2-48f8-bc3e-eeaafc959269
subject: >-
  Session guarding for memory extraction prompts requires
  [LOCAL_RECALL_INTERNAL] prefix
keywords:
  - session-guarding
  - local-recall-internal
  - memory-extraction
  - recursion-prevention
  - hooks
applies_to: global
occurred_at: '2025-12-21T18:29:15.440Z'
content_hash: 225895eeafa6918b
---
The UserPromptSubmit hook filters out internal prompts that start with `[LOCAL_RECALL_INTERNAL]` to prevent infinite recursion. Memory extraction prompts sent by the MCP daemon via `claude -p` must include this prefix in the prompt itself. Without it, the hook processes the memory extraction prompt as a regular prompt, causing unwanted semantic search lookups. The prefix should be added at the start of `buildMemoryExtractionPrompt()` in `src/prompts/memory-extraction.ts`.
