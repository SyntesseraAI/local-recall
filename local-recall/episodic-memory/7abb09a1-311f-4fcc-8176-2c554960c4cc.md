---
id: 7abb09a1-311f-4fcc-8176-2c554960c4cc
subject: >-
  UserPromptSubmit hook infinite recursion when calling claude -p without
  disabling hooks
keywords:
  - userpromptsubmit
  - hook
  - claude -p
  - recursion
  - abort error
  - child process
applies_to: 'file:src/hooks/user-prompt-submit.ts'
occurred_at: '2025-12-02T01:18:17.369Z'
content_hash: a4adae1396c00864
---
When the UserPromptSubmit hook calls `claude -p` to extract keywords from user prompts, it triggers the UserPromptSubmit hook again, causing infinite recursion. This results in a child process abort error. The hook needs to disable itself when invoking `claude -p` to prevent this.

**Root cause:** The hook is triggered for every `claude -p` invocation, creating an infinite loop.

**Solution:** Use environment variable flag (e.g., `SKIP_CLAUDE_HOOKS=true`) to disable hooks when calling `claude -p` from within the hook itself.
