---
id: fd420261-80ee-41c9-ad07-5604e2ca8b73
subject: User-prompt-submit hook handles both episodic and thinking memory search
keywords:
  - user-prompt-submit
  - episodic
  - thinking
  - memory-search
  - configuration
applies_to: 'file:src/hooks/user-prompt-submit.ts'
occurred_at: '2025-12-21T18:26:12.039Z'
content_hash: 6036f821718092c1
---
## Architecture
The user-prompt-submit hook performs unified semantic search across two independent memory types based on configuration:

1. **Episodic Memory** - If `episodicEnabled` is true, searches episodic memories using Orama + Ollama embeddings
2. **Thinking Memory** - If `thinkingEnabled` is true, searches thinking memories separately

## Configuration Options
Each memory type has independent settings:
- **episodicMaxTokens** (default: 1000) - Maximum tokens of episodic memories to inject per prompt
- **episodicMinSimilarity** (default: 0.5) - Minimum similarity threshold for episodic matches
- **thinkingMaxTokens** (default: 1000) - Maximum tokens of thinking memories to inject
- **thinkingMinSimilarity** (default: 0.5) - Minimum similarity threshold for thinking matches

## Key Behavior
The hook skips internal prompts containing `[LOCAL_RECALL_INTERNAL]` tag to avoid processing memory extraction commands. Results are filtered by similarity threshold and token budget before combining and outputting to stdout for context injection.
