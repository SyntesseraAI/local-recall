---
id: 2fa6424f-e096-4e3d-a2ef-d81be713eb7a
subject: Memory extraction should be performed asynchronously by background daemon
keywords:
  - memory-extraction
  - transcript-processing
  - daemon
  - architecture
  - background-job
  - async
applies_to: 'area:memory-extraction'
occurred_at: '2025-12-02T22:01:19.831Z'
content_hash: 66872eb6a9c63a4f
---
# Asynchronous Memory Extraction Architecture

## Current Design Decision

Memory extraction from transcripts should NOT happen in the Stop hook. Instead, it should be performed by a background daemon that:
- Runs periodically (every 5 minutes)
- Processes transcripts asynchronously
- Handles transcript parsing and memory creation independently

## Rationale

1. **Stop Hook Simplicity**: The Stop hook should remain lightweight and fast (under 60 seconds timeout)
2. **Reliability**: Background processing is more resilient to failures
3. **Performance**: Extracting memories from large transcripts can be time-consuming and shouldn't block the user
4. **Decoupling**: Memory extraction logic is separated from the Claude Code hook lifecycle

## Implementation Location

The background daemon should be part of the MCP server:
- Main entry point: `src/mcp-server/server.ts`
- Implementation: `src/core/transcript-collector.ts` and `src/core/memory-extractor.ts`
- Schedule: Run every 5 minutes to detect and process new/modified transcripts

## Processing Flow

1. Collect transcripts from `~/.claude/projects/<project>/transcripts/`
2. Track processed transcripts (content hash + timestamp) to detect changes
3. For new or modified transcripts:
   - Condense the transcript using `transcript-condenser.ts`
   - Extract memories using `memory-extractor.ts`
   - Create memory files via `memory.ts`
4. Update processed log to avoid reprocessing

## Key Files

- `src/core/transcript-collector.ts` - Collect transcripts from disk
- `src/core/transcript-condenser.ts` - Condense transcripts for processing
- `src/core/memory-extractor.ts` - Extract memories using Claude
- `src/core/processed-log.ts` - Track which transcripts have been processed
- `src/core/memory.ts` - Create memory files
