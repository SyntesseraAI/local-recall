---
id: b58de580-9060-4a94-9792-a9894af8cd6c
subject: Database utility exports three functions for different access patterns
keywords:
  - database
  - utility
  - openDatabase
  - readonly
  - concurrency
applies_to: 'file:src/utils/database.ts'
occurred_at: '2025-12-03T09:48:06.256Z'
content_hash: a70bbf19084ffa7b
---
The database utility (`src/utils/database.ts`) provides:

1. **openDatabase(baseDir, readonly)** - Primary function for opening SQLite connections
   - Configures busy timeout (30s)
   - Enables WAL mode
   - Supports readonly parameter
   - Used by both vector stores

2. **withRetry()** - Async retry wrapper (not currently used by vector stores due to better-sqlite3 limitations)

3. **withRetrySync()** - Sync retry wrapper (not currently used)

**Design note**: Better-sqlite3 is synchronous, so async retry functions aren't applied. Retries happen at database open-time via busy timeout.
