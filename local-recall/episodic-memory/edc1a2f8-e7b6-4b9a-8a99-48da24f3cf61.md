---
id: edc1a2f8-e7b6-4b9a-8a99-48da24f3cf61
subject: >-
  Claude CLI spawn hangs with stdio: ['pipe', 'pipe', 'pipe'] - use 'ignore' for
  stdin
keywords:
  - claude-cli
  - spawn
  - stdio
  - stdin
  - hanging
  - timeout
  - child-process
applies_to: global
occurred_at: '2025-12-21T19:34:09.105Z'
content_hash: 141f0f36bf0f017f
---
When spawning the Claude CLI using Node.js `child_process.spawn()` with `stdio: ['pipe', 'pipe', 'pipe']`, the process hangs indefinitely waiting for stdin to be closed. The CLI expects stdin to be closed before it processes the prompt, but an open pipe that's never written to or closed causes it to hang.

**Solution**: Use `stdio: ['ignore', 'pipe', 'pipe']` instead. This tells the CLI to ignore stdin, allowing it to process immediately. Response time improves from 30+ seconds (timeout) to ~2-3 seconds.

**Affected files**:
- `src/hooks/user-prompt-submit.ts` line 53
- `src/core/memory-extractor.ts` line ~258

**Root cause**: The hook was timing out because the spawn was hanging for the full 30-second hook timeout before being aborted by Claude Code.
