---
id: 0d661b2b-c9d7-4d47-8b7b-4edb68fd122c
subject: >-
  Memory files must include occurred_at field for proper deduplication and
  sorting
keywords:
  - memory
  - deduplication
  - occurred_at
  - timestamp
  - content_hash
  - idempotent
  - duplicate-detection
applies_to: 'area:memory-management'
occurred_at: '2025-12-01T16:16:17.520Z'
content_hash: 478b1b3a1b422f8e
---
# Memory File Deduplication Requirements

Memory files require both `occurred_at` (ISO-8601 timestamp) and `content_hash` fields for proper deduplication.

## Deduplication Logic

The `findDuplicate()` function in `src/core/memory.ts` checks for existing memories by:
1. Matching the `occurred_at` timestamp
2. Matching the SHA-256 content hash prefix

If both match, a duplicate is found and the existing memory is returned instead of creating a new one.

## Why This Matters

- **Prevents duplicate memories**: When transcripts are re-processed, same memories should not be created twice
- **Enables memory updates**: By replacing old memories (delete + recreate), we can update memory content while maintaining deduplication through `occurred_at` and `content_hash`
- **Sorting capability**: `occurred_at` allows memories to be sorted chronologically

## Implementation Note

When creating memories from transcript events, ensure:
- `occurred_at` is set to the timestamp when the event occurred
- `content_hash` is the SHA-256 hash prefix of the memory content
- Both fields are essential for the idempotent memory creation pattern
