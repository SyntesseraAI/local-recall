---
id: a6b08418-e93b-4fd1-b992-d7382bf51035
subject: Memory extraction uses Claude API with streaming and token management
keywords:
  - memory-extractor
  - claude-api
  - streaming
  - token-counting
  - transcript-processing
applies_to: 'file:src/core/memory-extractor.ts'
occurred_at: '2025-12-02T01:14:24.584Z'
content_hash: b360bc734f127018
---
The memory extraction system in `memory-extractor.ts` uses the Anthropic Claude API with:
- Streaming responses for efficient token usage
- Token counting via `countTokens()` API before processing
- Proper error handling with retry logic for API failures
- Environment variable `ANTHROPIC_API_KEY` for authentication
- Async/await pattern for concurrent processing

Key functions:
- `extractMemoriesFromTranscript()` - Main entry point that processes condensed transcripts
- Uses Claude Haiku model for cost-effective memory extraction
- Handles large transcripts by streaming responses
- Validates extracted memories have required fields before storage
