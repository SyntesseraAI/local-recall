---
id: a88a357e-00a4-4b86-932a-5c5a702015b2
subject: Memory file deduplication uses content_hash and occurred_at fields
keywords:
  - deduplication
  - duplicate
  - content-hash
  - occurred-at
  - memory-creation
  - idempotent
applies_to: 'file:src/core/memory.ts'
occurred_at: '2025-12-02T01:05:32.579Z'
content_hash: de92dfd48778bd6a
---
# Memory File Deduplication

## How Deduplication Works

The `findDuplicate()` function checks for existing memories using two fields:
1. **`occurred_at`** - ISO-8601 timestamp of when the original event occurred
2. **`content_hash`** - SHA-256 hash prefix (16 characters) of the memory content

## Implementation

- Both fields must match to identify a duplicate
- The function scans all existing memory files and compares these fields
- If a duplicate is found, `createMemory()` returns the existing memory instead of creating a new one
- This makes memory creation idempotent - the same event creates the same memory

## Purpose

- Prevents the same memory from being created multiple times
- Ensures memories about the same event (same timestamp, same content) aren't duplicated
- Critical for MCP server background daemon that processes transcripts asynchronously
- Handles the case where a transcript is processed multiple times without creating duplicate memories

## Important Note

Both `content_hash` and `occurred_at` must be provided when calling `createMemory()` for deduplication to work properly.
