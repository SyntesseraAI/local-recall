---
id: 152dc887-b74c-4824-a35a-b9d5375e5998
subject: MCP server runs background daemon that processes transcripts asynchronously
keywords:
  - mcp-server
  - background-daemon
  - transcript-processing
  - async-processing
  - 5-minute-interval
applies_to: 'area:mcp-server'
occurred_at: '2025-12-01T16:22:35.411Z'
content_hash: 29eb843153d56690
---
# MCP Server Background Daemon

The MCP server includes a background daemon for asynchronous transcript processing.

## Functionality

1. **Interval**: Runs every 5 minutes
2. **Purpose**: Process Claude transcripts to extract memories
3. **Detection**: Uses content hashes to identify changed transcripts
4. **Actions**:
   - Deletes old memories if transcript content changed
   - Recreates memories from updated transcript content
   - Maintains accurate memory-to-transcript mapping

## Why Async?

- Transcript processing can be expensive (involves Claude API calls or processing)
- Hook execution must be fast (SessionStart, UserPromptSubmit have timeouts)
- Background processing allows the hooks to remain responsive
- Memories can be extracted without blocking user interactions

## Transcript Syncing

The daemon:
1. Scans `~/.claude/projects/<project>/transcripts/`
2. Compares content hashes with last processed state
3. For changed transcripts: deletes associated memories and creates new ones
4. For unchanged transcripts: skips processing

## Related Systems

- Uses transcript-collector.ts to find and parse transcripts
- Creates memories via memory.ts CRUD operations
- Maintains processing state to avoid reprocessing

## Stop Hook Status

The Stop hook is currently disabled in favor of this background daemon approach because:
- More reliable (retries on failure)
- Better resource management (off-peak processing)
- Handles transcript updates gracefully
