---
id: 1c0fcc08-4b34-401e-8e0b-3427edc32e76
subject: Memory extraction uses Claude API with streaming for efficient token usage
keywords:
  - memory-extractor
  - claude-api
  - streaming
  - token-efficiency
  - transcript-processing
applies_to: 'file:src/core/memory-extractor.ts'
occurred_at: '2025-12-02T02:37:47.579Z'
content_hash: 2e02e55b7305e23d
---
The memory extraction system in `memory-extractor.ts` uses Claude's API with streaming enabled to process transcripts efficiently. The extraction is done through the `extractMemories()` function which:

1. Takes a condensed transcript as input
2. Sends it to Claude (currently hardcoded to use Claude 3.5 Sonnet) with the extraction prompt
3. Uses streaming to receive the response token-by-token
4. Parses the streamed response to extract individual memory objects
5. Creates memories with proper metadata (id, occurred_at, content_hash)

Key implementation details:
- Uses `anthropic.messages.create()` with `stream: true`
- Processes stream events and accumulates text
- Parses markdown JSON code blocks from the response
- Handles errors and logging via the logger utility
- Each extracted memory includes a content_hash (SHA-256 prefix) for deduplication

This approach is more token-efficient than non-streaming alternatives for processing longer transcripts.
