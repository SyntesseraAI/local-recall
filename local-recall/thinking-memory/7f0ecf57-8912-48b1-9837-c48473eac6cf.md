---
id: 7f0ecf57-8912-48b1-9837-c48473eac6cf
subject: >-
  I see, the issue is the type constraint on `JsonlStore`. The problem is that
  TypeScript is checking...
applies_to: global
occurred_at: '2025-12-21T17:50:06.373Z'
content_hash: c14d2b332718d076
---
## Thought

I see, the issue is the type constraint on `JsonlStore`. The problem is that TypeScript is checking the entry schema type against the TEntry parameter. Let me look at the constructor:

```typescript
this.store = new JsonlStore<EpisodicEntry, Memory>({
  filePath,
  entrySchema: episodicEntrySchema,  // This doesn't type-check because EpisodicEntry has applies_to: string
  ...
});
```

The issue is that `EpisodicEntry` (inferred from `z.infer<typeof episodicEntrySchema>`) has `applies_to: string`, but we're saying the `TEntry` is `EpisodicEntry` which then causes a type mismatch.

The cleanest solution is to make the generic `JsonlStore` accept `z.ZodSchema<unknown>` and let the caller do the type casting. Or, we can use `z.any()` for the `applies_to` field.

Let me simplify the approach: I'll use a less strict Zod type and rely on runtime validation rather than compile-time types. The type system is being too strict here.

## Output

The issue is the TypeScript type inference from Zod. Let me simplify by making the `JsonlStore` more flexible with its schema type:
