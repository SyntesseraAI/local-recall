---
id: 3cde2ec3-98a8-4a09-a28d-9fd8c819e260
subject: >-
  Good, all background processes are cleaned up. Let me summarize what I fixed
  for the user.
applies_to: global
occurred_at: '2025-11-30T15:20:39.938Z'
content_hash: 387192518a630c99
---
## Thought

Good, all background processes are cleaned up. Let me summarize what I fixed for the user.

## Output

## Summary

I found and fixed the issue with the UserPromptSubmit hook. Here's what was happening:

### Root Cause
When spawning the Claude CLI with `stdio: ['pipe', 'pipe', 'pipe']`, the CLI was waiting for stdin to be closed before processing. Since the stdin pipe was opened but never written to or closed, it hung indefinitely until the hook timeout fired (30 seconds), causing the `AbortError`.

### Fixes Applied

1. **`src/hooks/user-prompt-submit.ts`** - Changed `stdio` from `['pipe', 'pipe', 'pipe']` to `['ignore', 'pipe', 'pipe']` so stdin is not connected

2. **`src/core/memory-extractor.ts`** - Same fix for the transcript processing spawn

3. **`dev-marketplace/local-recall-plugin/config/hooks.json`** - Increased UserPromptSubmit timeout from 30s to 60s for extra margin

4. **Created `tests/integration/claude-cli-spawn.test.ts`** - New integration tests to verify Claude CLI spawning works correctly

### Results
- Before: Claude CLI spawn hung for 30 seconds then timed out with `AbortError`
- After: Claude CLI responds in ~2-3 seconds

The fix is simple but the root cause was subtle - the Claude CLI waits for stdin to be closed before executing when stdin is connected but no data is provided.
