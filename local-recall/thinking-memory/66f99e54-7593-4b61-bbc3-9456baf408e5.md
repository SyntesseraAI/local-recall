---
id: 66f99e54-7593-4b61-bbc3-9456baf408e5
subject: >-
  The user is asking an excellent question. If the user-prompt-submit hook is
  only doing read...
applies_to: global
occurred_at: '2025-12-03T08:34:42.573Z'
content_hash: 51871caeab651e39
---
## Thought

The user is asking an excellent question. If the user-prompt-submit hook is only doing read operations (semantic search), we could open the database in read-only mode which might avoid the mutex contention issue with sqlite-vec.

SQLite in WAL mode allows multiple readers to work concurrently with one writer. But the mutex error might be happening at the sqlite-vec extension level during initialization.

Let me check if better-sqlite3 supports read-only mode and update the openDatabase function to support it. This could be a cleaner solution than retry logic for read-only operations.

Let me modify the database utility to support read-only mode, then update the hooks to use it.

## Output

Good point! The hooks only do read operations (search), so we can use SQLite's read-only mode which avoids write locks entirely. Let me update the database utility to support this:
