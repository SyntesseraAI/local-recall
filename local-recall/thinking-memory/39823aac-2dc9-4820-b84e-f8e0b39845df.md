---
id: 39823aac-2dc9-4820-b84e-f8e0b39845df
subject: >-
  Let me analyze this transcript to extract valuable memories about the hooks
  issue and what was...
applies_to: global
occurred_at: '2025-12-21T17:40:05.532Z'
content_hash: d6aa77f5d349a82f
---
## Thought

Let me analyze this transcript to extract valuable memories about the hooks issue and what was learned.

Key findings from the transcript:
1. The hooks issue was that they were not returning output to Claude
2. The root cause was identified: plugin-layer hooks require JSON format output (with hookSpecificOutput.additionalContext) not plain console.log()
3. session-start.ts was using plain console.log() which gets swallowed
4. user-prompt-submit.ts was already using the correct JSON format
5. The hooks were executing and working correctly when tested manually, but their output wasn't being injected into Claude's context
6. The fix was to update session-start.ts to use the JSON format like user-prompt-submit.ts does
7. The issue was specific to how plugin-layer hooks (SessionStart:Callback) handle output - they require a specific JSON structure

Important memories to extract:
1. Plugin hooks must use JSON output format with hookSpecificOutput field
2. Plain console.log() output from plugin hooks gets ignored
3. The specific output format used in user-prompt-submit.ts is correct and should be replicated
4. This applies to both episodic and thinking memories in session-start hook
5. The bundled hooks need to be rebuilt after TypeScript changes

Let me create the JSON output:

## Output

```json
{
  "memories": [
    {
      "subject": "Plugin hooks require JSON output format with hookSpecificOutput field",
      "keywords": ["hooks", "plugin", "output format", "json", "sessionstart", "claude code"],
      "applies_to": "file:src/hooks/session-start.ts",
      "content": "Plugin-layer hooks (SessionStart:Callback, UserPromptSubmit:Callback) require stdout to be in JSON format with a `hookSpecificOutput` object containing `additionalContext` field. Plain `console.log()` output is swallowed by the plugin layer and only shows a status message like 'hook success: Success' without injecting content into Claude's context.\n\nCorrect format (from user-prompt-submit.ts line 270):\n```javascript\nconst output = {\n  hookSpecificOutput: {\n    additionalContext: memoryContent\n  }\n};\nconsole.log(JSON.stringify(output));\n```\n\nIncorrect format:\n```javascript\nconsole.log(memoryContent); // Gets ignored by plugin layer\n```"
    },
    {
      "subject": "session-start hook was using plain console.log instead of JSON format",
      "keywords": ["session-start", "hooks", "output format", "bug", "fix"],
      "applies_to": "file:src/hooks/session-start.ts",
      "content": "The session-start hook was using plain `console.log()` statements to output memories, which doesn't work with plugin-layer hooks. The hook was executing correctly and producing output when tested manually, but Claude Code wasn't receiving the memory content because the output wasn't in the required JSON format.\n\nThis was a regression/inconsistency - the user-prompt-submit hook already uses the correct JSON format, but session-start had not been updated to match."
    },
    {
      "subject": "Hook output format requirements for episodic and thinking memories",
      "keywords": ["hooks", "episodic", "thinking", "output", "format", "json"],
      "applies_to": "global",
      "content": "When hooks output memories to Claude's context, they must wrap the content in a JSON structure with `hookSpecificOutput.additionalContext`. This applies to both episodic memories (from vector search) and thinking memories. The session-start hook injects 5 recent memories and the user-prompt-submit hook injects search results - both need to follow this format for Claude to receive the content."
    },
    {
      "subject": "Debugging plugin hooks - test manually to verify they work",
      "keywords": ["hooks", "debugging", "testing", "plugin", "transcript"],
      "applies_to": "global",
      "content": "When hooks aren't producing visible output in Claude Code, manually test them with `echo '...' | node path/to/hook.js` to verify the hook code itself is working. Plugin hooks can appear to 'succeed' while producing no context injection if there's an output format issue. Check the recall.log and transcripts for hook_response entries with `stdout:\"\"` to identify silent failures."
    },
    {
      "subject": "Bundled hooks in local-recall-plugin directory must be rebuilt after source changes",
      "keywords": ["build", "hooks", "plugin", "typescript", "distribution"],
      "applies_to": "global",
      "content": "Changes to TypeScript hook source files (src/hooks/*.ts) need to be compiled and bundled into the local-recall-plugin directory (local-recall-plugin/scripts/hooks/) via `npm run build`. The plugin distribution includes these bundled hooks, so they need to be current for users to get the fixes."
    }
  ]
}
```
