---
id: 57ee8190-3afc-4e53-afc1-e1b5b87a210c
subject: >-
  The user is asking two questions: 1. Does the vector store sort by occurred_at
  to ensure newest...
applies_to: global
occurred_at: '2025-12-02T11:53:07.346Z'
content_hash: cc76bfdee016b499
---
## Thought

The user is asking two questions:
1. Does the vector store sort by occurred_at to ensure newest memories are first?
2. What is the scoring method for vectors?

Let me look at the vector store search implementation again to answer these questions. I already read vector-store.ts earlier, but let me review the search method specifically.

## Output

Looking at the vector store search in `src/core/vector-store.ts:200-270`:

## 1. Sorting by `occurred_at`?

**No** - the vector store sorts by **distance** (similarity), not `occurred_at`:

```typescript
// Lines 222-230
const sql = `
  SELECT
    m.id, m.subject, m.keywords, m.applies_to, m.occurred_at, m.content_hash, m.content,
    e.distance
  FROM memory_embeddings e
  JOIN memories m ON e.id = m.id
  WHERE e.embedding MATCH ? AND k = ?
  ORDER BY e.distance   // <-- Sorted by similarity, not time
`;
```

The most semantically similar results come first, regardless of when they were created.

## 2. Scoring Method

The score is derived from **cosine distance** (`vector-store.ts:255-258`):

```typescript
// Convert distance to similarity score (lower distance = higher similarity)
// Using cosine distance, so 0 = identical, 2 = opposite
score: 1 - row.distance / 2,
```

- `sqlite-vec` returns cosine distance (range: 0 to 2)
- `distance = 0` means identical vectors → `score = 1.0` (100%)
- `distance = 2` means opposite vectors → `score = 0.0` (0%)
- The formula `1 - distance/2` converts to a 0-1 similarity score

The embeddings are generated using **BGE-small-en-v1.5** via `fastembed` (`embedding.ts`), which combines the memory's subject and content into a single embedding vector.

---

Would you like the search to incorporate recency as a factor (e.g., weighted combination of similarity + recency)?
