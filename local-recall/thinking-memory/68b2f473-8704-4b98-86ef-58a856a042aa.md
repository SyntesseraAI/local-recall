---
id: 68b2f473-8704-4b98-86ef-58a856a042aa
subject: >-
  The user is showing me log output from the local-recall plugin and says
  "Something just isn't...
applies_to: global
occurred_at: '2025-11-30T20:43:54.642Z'
content_hash: 8fae171443d83d45
---
The user is showing me log output from the local-recall plugin and says "Something just isn't right." Let me analyze the logs to identify the issues:

1. **First issue - Recursion/Internal prompts being processed:**
   ```
   UserPromptSubmit input received: { ... "prompt": "[LOCAL_RECALL_INTERNAL] You are analyzing a Claude Code session transcript...
   ```
   The UserPromptSubmit hook is receiving internal prompts meant for memory extraction. There's a log line showing it's being skipped:
   ```
   [DEBUG] [hooks] UserPromptSubmit: Skipping internal Local Recall prompt to prevent recursion
   ```
   So that's good - it's being handled.

2. **Second issue - Memory extraction returning empty objects:**
   ```
   [DEBUG] [extractor] Normalized response structure: {
     "memories": [
       {},
       {},
       {},
       {}
     ]
   }
   ```
   The Claude response is returning 4 empty objects in the memories array, which then fails Zod validation because they're missing required fields (subject, keywords, applies_to, content).

3. **Third issue - E2BIG error:**
   ```
   [WARN] [extractor] Claude CLI attempt 1 failed: spawn E2BIG
   ```
   This is a Unix error that occurs when the argument list is too long. The transcript being passed to `claude -p` is too large to fit in the command line arguments.

4. **The raw response parsing issue:**
   Looking at the raw response, it seems like the extractor is getting a full transcript/session data instead of just the memory extraction response. The raw response contains system messages, init data, etc.

Let me read the relevant source files to understand what's happening:
1. `src/core/memory-extractor.ts` - to see how it processes Claude responses
2. `src/hooks/user-prompt-submit.ts` - to see how it handles prompts
   
I'm seeing critical parsing problems with the memory extraction process. The system is struggling to correctly extract meaningful memory data, with multiple symptoms pointing to fundamental issues in response handling. Specifically, the extraction mechanism is failing to parse the response correctly, resulting in empty memory objects and potential data loss.

The core challenges involve incorrect JSON parsing, oversized transcript handling, and incomplete response filtering. These issues suggest a need for more robust parsing logic and improved error handling in the memory extraction pipeline.
