---
id: 9025df2a-e78d-4f46-ae45-33396a2b2529
subject: >-
  Both changes have been made and the build is successful. Let me summarize what
  I fixed: 1....
applies_to: global
occurred_at: '2025-11-30T15:00:38.272Z'
content_hash: ec05bf8fea9e0d0d
---
## Thought

Both changes have been made and the build is successful. Let me summarize what I fixed:

1. **Session guarding fix**: Added `[LOCAL_RECALL_INTERNAL]` prefix to the memory extraction prompt in `src/prompts/memory-extraction.ts`. Now when the MCP server daemon calls `claude -p` with the memory extraction prompt, the UserPromptSubmit hook will detect the prefix and skip processing, preventing recursion.

2. **Timeout increase**: Changed the timeout in `src/core/memory-extractor.ts` from 120000ms (2 minutes) to 600000ms (10 minutes) to allow more time for memory extraction.

3. **Test update**: Added a test to verify the `[LOCAL_RECALL_INTERNAL]` prefix is present to prevent regression.

## Output

Done! I made two fixes:

1. **Session guarding fix** (`src/prompts/memory-extraction.ts:62-63`): Added the `[LOCAL_RECALL_INTERNAL]` prefix to the memory extraction prompt. Now when the MCP daemon calls `claude -p` for memory extraction, the UserPromptSubmit hook will detect this prefix and skip processing, preventing the recursion you saw in the logs.

2. **Timeout increase** (`src/core/memory-extractor.ts:40`): Changed the timeout from 2 minutes to 10 minutes (600000ms).

3. **Test added** (`tests/unit/prompts/memory-extraction.test.ts:11-15`): Added a regression test to ensure the prefix is always present.
