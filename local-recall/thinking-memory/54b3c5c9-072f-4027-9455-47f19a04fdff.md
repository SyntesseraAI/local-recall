---
id: 54b3c5c9-072f-4027-9455-47f19a04fdff
subject: >-
  The user is asking me to extract memories from this transcript. This is a
  session where they worked...
applies_to: global
occurred_at: '2025-12-21T17:20:08.571Z'
content_hash: 8350a5dfca5a9883
---
## Thought

The user is asking me to extract memories from this transcript. This is a session where they worked on documentation updates and then discussed architecture for handling embeddings in a distributed system.

Let me analyze what was learned and what is now known:

1. **Documentation gaps discovered**: The assistant found that the documentation was out of date - it referenced old technologies (SQLite+fastembed) instead of the new ones (Orama+Ollama), referenced old configuration options, old hook structure, etc.

2. **Multiple instance problem**: When multiple local-recall instances run in the same folder, they have concurrent write issues on the Orama index files and processed-log files. This is a known problem.

3. **Isolation with separate folders**: Each project folder has its own isolated storage, so there's no conflict if instances are in separate folders/codebases.

4. **Need for server-side memory creation**: Cloud agents need to be able to save memories via MCP server without embeddings.

5. **Proposed solution - sidecar embedding files**: The architecture discussion started about storing embedding vectors alongside memory files in `.embedding.json` files that could be git-tracked.

6. **Three modes of operation**: 
   - Standard mode (create embeddings if needed via Ollama)
   - No-embeddings mode (cloud agents, use pre-computed embeddings only)
   - Load-from-disk mode (prefer existing embeddings, fall back to Ollama)

Let me extract valuable memories:

1. Documentation was out of date - references to SQLite, fastembed, old config options, old hook structure
2. Multiple instances in same folder have concurrent write conflicts on Orama index and processed-log
3. Separate folders provide natural isolation
4. Need sidecar embedding files (.embedding.json) for git-tracked embeddings
5. Need "no-embeddings" mode for cloud agents that can't run Ollama
6. Standard mode should try disk embeddings first, then Ollama as fallback

These are all specific to this codebase and would be helpful for future work.

## Output

```json
{
  "memories": [
    {
      "subject": "Multiple local-recall instances in same folder have concurrent write conflicts",
      "keywords": ["concurrency", "multi-instance", "orama-index", "processed-log", "file-locking"],
      "applies_to": "global",
      "content": "When multiple Claude Code instances run local-recall on the same codebase folder, they cause concurrent write conflicts:\n\n- `orama-episodic-index.json` and `orama-thinking-index.json`: Multiple processes write without coordination, causing lost updates\n- `processed-log.jsonl`: Same transcript could be processed by multiple daemon instances\n- `recall.log`: Duplicate log entries\n\nEach instance spawns its own MCP server process with its own Orama instance, all writing to the same shared index files without locking.\n\n**Isolation workaround**: Each project in a separate folder/codebase has its own isolated `local-recall/` directory, so there's no conflict."
    },
    {
      "subject": "Proposed architecture: Sidecar embedding files for distributed git-tracked memories",
      "keywords": ["embeddings", "sidecar", "git-tracked", "cloud-agents", "distributed"],
      "applies_to": "global",
      "content": "To support cloud agents creating memories without Ollama access, and to allow embeddings to be version-controlled:\n\n1. **Sidecar embedding files**: Store embedding vectors alongside memory files\n   - `episodic-memory/abc123.md` (memory content, git-tracked)\n   - `episodic-memory/abc123.embedding.json` (embedding vector, git-tracked)\n   - Cloud agents can create memories without embeddings\n\n2. **Three modes of operation**:\n   - **Standard mode**: Try to load embedding from disk `.embedding.json`, fall back to Ollama if missing\n   - **No-embeddings mode**: Cloud agents create memories, load Orama from disk embeddings only, cannot create new embeddings\n   - **Full mode**: Can create and embed memories (traditional mode)\n\n3. **Embedding file format**:\n   ```json\n   {\n     \"model\": \"nomic-embed-text\",\n     \"dimensions\": 768,\n     \"created_at\": \"ISO-8601 timestamp\",\n     \"vector\": [float, ...]\n   }\n   ```\n\nThis allows git to track embeddings alongside memories, enabling reproducible semantic search across distributed systems."
    },
    {
      "subject": "Documentation was significantly out of date with multiple tech stack changes",
      "keywords": ["documentation", "outdated", "fastembed", "sqlite", "orama", "ollama"],
      "applies_to": "global",
      "content": "The documentation files were outdated and referenced old technology choices:\n\n- **README.md**: Referenced old MCP tools, missing Ollama/vector search info, wrong tool names\n- **docs/hooks.md**: Referenced SQLite+fastembed instead of current Orama+Ollama, referenced separate thinking hook (now unified UserPromptSubmit)\n- **docs/configuration.md**: Missing new config options, wrong log level default (debug→error), wrong port (3000→7847)\n- **docs/mcp-server.md**: Referenced old `memory.sqlite` database\n\nAll documentation files were comprehensively updated in commit ca8cd80 to reflect current architecture."
    }
  ]
}
```
