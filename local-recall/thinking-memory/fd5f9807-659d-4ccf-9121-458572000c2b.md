---
id: fd5f9807-659d-4ccf-9121-458572000c2b
subject: >-
  The plugin's hooks.json looks correct - it's using the unified
  user-prompt-submit.js hook. The...
applies_to: global
occurred_at: '2025-12-03T12:04:49.967Z'
content_hash: 8c355b54c358a276
---
## Thought

The plugin's hooks.json looks correct - it's using the unified user-prompt-submit.js hook. The build script bundles the hooks into `dev-marketplace/local-recall-plugin/scripts/hooks/`.

Let me summarize what was done:

1. **MCP search results now include:**   - `content` - the actual memory content   - `occurred_at` - timestamp for recency   - `tokens_used` - how many tokens were used

2. **Recency weighting added:**
   - Both VectorStore and ThinkingVectorStore now apply a 10% max boost for recency   - Formula: `boostedScore = baseScore * (1 + 0.1 * recencyFactor)`   - Where recencyFactor is 0.0 for oldest, 1.0 for newest3. **Token limit added:**   - MCP search tools now accept `max_tokens` parameter (default: 2000)   - Results are limited to fit within the token budgetThe code is now shared:
- Both hooks and MCP tools use the same SearchEngine → VectorStore path
- The recency weighting is in the vector stores, so both paths benefit- Token limiting is done at the MCP tool level and hook level separately (same logic)Let me double check the hooks are also using token limits correctly.

## Output

The plugin hooks.json looks correct. Here's a summary of changes made:

**MCP Search Results now include:**
- `content` - actual memory text
- `occurred_at` - timestamp for recency
- `tokens_used` - token count for response

**Recency Weighting (10% max boost):**
- Applied in both `VectorStore` and `ThinkingVectorStore`
- Formula: `score = similarity * (1 + 0.1 * recencyFactor)`
- `recencyFactor`: 0.0 for oldest → 1.0 for newest

**Token Limit:**
- MCP: `max_tokens` parameter (default: 2000)
- Hooks: Already had token limiting via `episodicMaxTokens`/`thinkingMaxTokens` config

**Code sharing:**
- Both hooks and MCP use the same `SearchEngine` → `VectorStore` path
- Recency weighting is applied at the vector store level, so it's consistent everywhere

The MCP server will pick up the changes on next restart. Tests all pass (288/289, 1 skipped).
