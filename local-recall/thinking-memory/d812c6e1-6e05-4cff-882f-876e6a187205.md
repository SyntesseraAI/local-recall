---
id: d812c6e1-6e05-4cff-882f-876e6a187205
subject: >-
  The `http-server.ts` was deleted during the Orama migration. The DaemonClient
  references are only...
applies_to: global
occurred_at: '2025-12-03T11:13:09.977Z'
content_hash: 6add33c5919d216d
---
## Thought

The `http-server.ts` was deleted during the Orama migration. The DaemonClient references are only in old memories and documentation now.

The issue is clear:
1. The old architecture had: Hooks → HTTP → Daemon (owns sqlite-vec & onnxruntime) → No mutex issues
2. The current architecture has: Hooks load fastembed directly → onnxruntime mutex issues

Options:
1. **Restore HTTP daemon architecture** - hooks call daemon for search, daemon owns onnxruntime
2. **Use file locking** - ensure only one hook process loads onnxruntime at a time
3. **Lazy load with singleton** - but this won't work across processes
4. **Use a pure JS embedding** - none as good as fastembed currently

The cleanest fix is to restore the daemon architecture. The MCP server already runs as a daemon - it just needs to expose HTTP endpoints for the hooks to call.

Let me check the MCP server to see what we have:

## Output

The `http-server.ts` was deleted during the Orama migration. The daemon architecture was the solution to this exact problem but got removed.

**Root cause**: `onnxruntime-node` (used by `fastembed`) has the same native mutex issue as `sqlite-vec`. When multiple hook processes load it concurrently, you get mutex errors.

**Solution**: Restore the daemon architecture where:
- Hooks make HTTP calls to the MCP daemon
- Only the daemon loads `fastembed`/`onnxruntime-node`
- No concurrent native module loading

Want me to restore the HTTP server in the MCP daemon and update the hooks to use it?
