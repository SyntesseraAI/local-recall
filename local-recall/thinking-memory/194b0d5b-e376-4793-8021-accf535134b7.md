---
id: 194b0d5b-e376-4793-8021-accf535134b7
subject: >-
  Let me analyze this transcript to extract valuable memories about the
  local-recall project. The...
applies_to: global
occurred_at: '2025-12-21T18:18:49.404Z'
content_hash: 3b8cd00a8ee788ac
---
## Thought

Let me analyze this transcript to extract valuable memories about the local-recall project. The transcript shows a comprehensive documentation review and some architectural discussions about the MCP server setup.

Key things I learned/discovered:

1. **Documentation Updates Made**: The assistant went through the codebase and updated multiple documentation files to reflect current architecture (Orama + Ollama instead of SQLite + fastembed)

2. **MCP Server Isolation**: The MCP server already runs as a stdio process - each Claude Code instance spawns its own process. This provides some isolation.

3. **Multi-Instance Cross-Communication Issue**: When multiple local-recall instances are running on the SAME codebase/folder, they can cross-communicate and cause conflicts with:
   - Index files (orama-episodic-index.json, orama-thinking-index.json)
   - processed-log.jsonl (transcripts could be processed twice)
   - recall.log (duplicate entries)

4. **Isolation with Separate Folders**: If each project is in a separate folder, they don't interfere because they each have their own local-recall directory

5. **New Architecture Proposal**: The user wants to support cloud agents that can save memories without embeddings. This requires:
   - Sidecar embedding files stored alongside memory files (git tracked)
   - A "no-embeddings" mode for cloud agents
   - Standard mode that attempts to load from disk but uses Ollama as fallback

The transcript cuts off mid-discussion about the embedding file format.

Let me extract the memories:

1. **MCP Server Concurrency Issue**: Multiple instances of local-recall running on the same codebase can cause race conditions on index files - should extract this as a known issue

2. **Index Files Not Git-Tracked**: The orama index files are gitignored, which causes problems when cloud agents need access - this is a design trade-off that needs documenting

3. **Embedding Architecture Change**: The proposal is to store embeddings as sidecar JSON files alongside memories to enable cloud deployment
 
I'll focus on the new insights about cloud agent deployment and architectural isolation. Cloud agents require a flexible memory storage approach that supports pre-computed embeddings and works across different deployment environments. The key is creating a modular system that can handle both local and cloud-based memory management without introducing conflicts or dependencies.

The proposed solution involves creating a no-embeddings mode that allows cloud agents to work with pre-generated embedding files, ensuring seamless integration and deployment flexibility. By implementing strict directory isolation, the system prevents cross-communication issues between different local-recall instances.

## Output

```json
{
  "memories": [
    {
      "subject": "MCP server concurrency issue with shared codebase folders",
      "keywords": ["mcp", "concurrency", "race condition", "index", "multiple-instances", "stdio"],
      "applies_to": "global",
      "content": "When multiple Claude Code instances run on the SAME codebase folder, each spawns its own MCP server process (stdio isolation). However, they all write to the same `orama-episodic-index.json`, `orama-thinking-index.json`, and `processed-log.jsonl` files without coordination, causing race conditions:\n\n- Index file updates lost (multiple processes overwrite each other's changes)\n- Transcripts processed multiple times by different daemon processes\n- Duplicate entries in recall.log\n\nThis ONLY occurs with shared folders. Separate projects with separate local-recall directories are fully isolated."
    },
    {
      "subject": "Gitignored index files prevent cloud agent access to local-recall",
      "keywords": ["cloud", "agent", "index", "gitignore", "embedding", "distributed"],
      "applies_to": "global",
      "content": "The Orama index files (`orama-episodic-index.json`, `orama-thinking-index.json`) are gitignored by design because they contain pre-computed embeddings (768 dimensions each, large files). This works for single-machine use but breaks cloud agent access:\n\n- Cloud agents can't access local memories without indexes\n- Indexes can't be regenerated without the embedding model (Ollama)\n- Creates deployment friction for distributed AI systems\n\nProposed solution: Store embeddings as sidecar `.embedding.json` files alongside memory files and track in git."
    },
    {
      "subject": "Proposed sidecar embedding files for cloud deployment",
      "keywords": ["embedding", "sidecar", "cloud", "git-tracked", "architecture"],
      "applies_to": "global",
      "content": "Design to enable local-recall on cloud agents:\n\n1. **Memory Files**: Keep existing `.md` files in git (episodic-memory/, thinking-memory/)\n2. **Embedding Files**: Add `.embedding.json` sidecar files alongside memories, tracked in git\n   - Format: {model, dimensions, created_at, vector}\n   - Example: `abc123.md` + `abc123.embedding.json`\n3. **Two Operating Modes**:\n   - **Standard mode** (local): Load embeddings from disk, fall back to Ollama if missing\n   - **No-embeddings mode** (cloud): Load pre-computed embeddings from git, skip Ollama, can create memories without embeddings\n4. **Workflow**: Local machine computes embeddings → pushes to git → cloud agents use cached embeddings"
    },
    {
      "subject": "Documentation migration from fastembed/SQLite to Orama/Ollama",
      "keywords": ["migration", "documentation", "fastembed", "orama", "ollama", "embedding-model"],
      "applies_to": "global",
      "content": "Recent documentation updates reflected major architectural changes:\n\n- **Embedding Model**: Migrated from fastembed (BGE-small-en-v1.5, 384 dims) to Ollama nomic-embed-text (768 dims)\n- **Storage**: Changed from SQLite in-process to Orama (pure JS, no dependencies)\n- **Hook Architecture**: Unified UserPromptSubmit hook (previously separate episodic/thinking hooks)\n- **MCP Tools**: Updated from memory.sqlite references to episodic_*/thinking_* tools\n- **Configuration Defaults**: Fixed LOG_LEVEL default (debug→error), port (3000→7847)\n\nKey breaking change: Vector dimension increase (384→768) requires index rebuild. See docs/troubleshooting for migration steps."
    },
    {
      "subject": "Isolation model: separate folders prevent cross-communication",
      "keywords": ["isolation", "folders", "project", "multi-project", "no-interference"],
      "applies_to": "global",
      "content": "Multiple local-recall instances DO NOT interfere when in separate project folders because:\n\n- Each project has its own `./local-recall/` directory\n- Index files (`orama-*-index.json`) are per-project\n- Processed transcript logs are per-project\n- Environment variable `LOCAL_RECALL_DIR` points to project-specific directory\n\nRecommendation: When deploying local-recall across multiple projects, always ensure separate LOCAL_RECALL_DIR paths for complete isolation."
    }
  ]
}
```
