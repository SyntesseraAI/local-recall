---
id: e822ebab-86e4-4b17-82bc-2c1011ce3df6
subject: >-
  Now I need to look at the `database.ts` utility to see how `openDatabase` and
  `withDbMutex` are...
applies_to: global
occurred_at: '2025-12-03T10:32:01.255Z'
content_hash: 97d9aa407aa1319d
---
## Thought

Now I need to look at the `database.ts` utility to see how `openDatabase` and `withDbMutex` are implemented. The mutex error is happening despite the file-based locking. Let me check:

1. The `openDatabase` function - how does it load sqlite-vec?
2. The `withDbMutex` function - how does the cross-process file locking work?

The issue might be:
1. The mutex happens BEFORE the file lock is acquired (during the sqlite-vec extension loading)
2. The file lock isn't preventing concurrent sqlite-vec loads across processes
3. Something about how sqlite-vec handles its internal mutex that file locking can't prevent

## Output

Let me check the database utility to understand the locking mechanism:
