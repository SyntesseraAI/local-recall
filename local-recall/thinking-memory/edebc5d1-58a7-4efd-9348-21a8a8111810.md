---
id: edebc5d1-58a7-4efd-9348-21a8a8111810
subject: All done. Let me provide a summary of the changes made.
applies_to: global
occurred_at: '2025-12-03T10:19:43.897Z'
content_hash: 3972d982ea2a7455
---
## Thought

All done. Let me provide a summary of the changes made.

## Output

I've improved the logging to help debug the mutex error. Here's what was added:

## Changes Made

### `src/utils/database.ts`
- **PID logging**: Every log entry now includes `[PID:xxxx]` to identify which process is running
- **Lock acquisition logging**: Shows attempt count and elapsed time when acquiring file locks
- **sqlite-vec load timing**: Detailed timing around the `sqliteVec.load(db)` call with separate vec load time and total time
- **Stack traces on failure**: Full stack traces are logged when sqlite-vec loading fails
- **Waiting status logs**: Every ~1 second of lock waiting logs status

### `src/hooks/user-prompt-submit.ts`
- **Hook timing**: Total execution time logged at completion
- **Per-search timing**: Episodic and thinking searches log their individual durations
- **Stack traces on errors**: Full stack traces for any search failures
- **PID in all messages**: Every log entry includes process ID

## How to Debug

After the next prompt submission, check `local-recall/recall.log` for entries like:

```
[2025-12-03T...] [INFO] [search] [PID:12345] Opening database at ...
[2025-12-03T...] [INFO] [search] [PID:12345] Loading sqlite-vec extension...
[2025-12-03T...] [ERROR] [search] [PID:12345] SQLITE-VEC LOAD FAILED after 5ms: mutex lock failed
[2025-12-03T...] [ERROR] [search] [PID:12345] Stack trace: ...
```

This will show:
1. Which process is failing
2. Whether the lock was acquired
3. Exactly when the failure occurs
4. Full stack trace for root cause analysis
