---
id: 9665807c-028c-441d-ad69-f2d3632174ce
subject: >-
  The user is asking me to extract memories from this Claude Code session
  transcript where we...
applies_to: global
occurred_at: '2025-12-21T18:29:31.473Z'
content_hash: 17bc73c83eaccfc9
---
## Thought

The user is asking me to extract memories from this Claude Code session transcript where we investigated why hooks weren't working in the Local Recall project.

The main findings from the session were:

1. **Root cause identified**: The session-start hook was using plain `console.log()` instead of the JSON format required by Claude Code plugin hooks. Plugin hooks need to return `hookSpecificOutput.additionalContext` format for content to be injected into Claude's context.

2. **Key insight**: Plugin-layer hooks (`:Callback` suffix) don't inject stdout content directly - they only show status messages. The output format matters.

3. **Fix applied**: Modified session-start.ts to use the same JSON output format as user-prompt-submit.ts, with `hookSpecificOutput.additionalContext`.

4. **Technical details**: 
   - `user-prompt-submit.ts` already had correct JSON format (lines 270+)
   - `session-start.ts` was using plain console.log which gets swallowed
   - Both hooks needed to be rebuilt and bundled after the fix

Let me extract the valuable memories:

1. Hook output format issue - specific to this codebase's Claude Code integration
2. Plugin layer hook execution differs from direct execution
3. The :Callback suffix indicates plugin-layer hooks
4. Both episodic and thinking memory hooks need the JSON format

These are actionable, specific memories that will help future developers working on this hooks system.

## Output

```json
{
  "memories": [
    {
      "subject": "Claude Code plugin hooks require JSON output format with hookSpecificOutput",
      "keywords": ["hooks", "plugin", "output format", "json", "claudecode", "context injection"],
      "applies_to": "area:hooks",
      "content": "## Plugin Hook Output Format Issue\n\nClaude Code plugin hooks (identified by `:Callback` suffix) require a specific JSON output format for stdout to be injected into Claude's context. Plain text output via `console.log()` gets swallowed by the plugin layer, which only shows a status message like \"hook success: Success\".\n\n### Correct Format\nUse `hookSpecificOutput.additionalContext` wrapper:\n```json\n{\n  \"hookSpecificOutput\": {\n    \"additionalContext\": \"Memory content here\"\n  }\n}\n```\n\n### Incorrect Format\n```javascript\nconsole.log(\"memory content\") // Gets swallowed\n```\n\nBoth session-start.ts and user-prompt-submit.ts hooks must use this format for content to appear in Claude's context."
    },
    {
      "subject": "session-start hook was returning plain text instead of JSON format",
      "keywords": ["session-start", "hook", "output format", "console.log", "json"],
      "applies_to": "file:src/hooks/session-start.ts",
      "content": "## Session Start Hook Output Format Fix\n\nThe session-start.ts hook was using plain `console.log()` statements to output memories. While the hook executed successfully and produced valid memory content when tested manually, the plugin layer couldn't inject this output into Claude's context because it wasn't in the required JSON format.\n\nThe fix involved:\n1. Wrapping output in `hookSpecificOutput.additionalContext` JSON structure\n2. Aligning with the format already used in user-prompt-submit.ts (line 270+)\n3. Rebuilding and bundling the hooks via `npm run build`\n\nAfter the fix, the hook output is valid JSON that the plugin layer can properly inject as additional context."
    },
    {
      "subject": "Plugin-layer hooks execute differently than direct hook execution",
      "keywords": ["hooks", "plugin", "callback", "execution", "context"],
      "applies_to": "global",
      "content": "## Plugin-Layer Hook Execution Model\n\nHooks registered through the Claude Code plugin system execute differently than hooks run directly:\n\n1. **Hook name convention**: Plugin hooks show `:Callback` suffix (e.g., `SessionStart:Callback`)\n2. **Output handling**: Only structured JSON with `hookSpecificOutput` gets injected into context\n3. **Status visibility**: Users see \"hook success: Success\" status regardless of output content\n4. **Manual testing**: Hooks can appear to work correctly when tested manually but fail to inject content when run through the plugin layer\n\nThis distinction is critical for debugging hook issues - always verify the output format, not just the hook execution status."
    },
    {
      "subject": "Both episodic and thinking memory hooks must use consistent JSON output format",
      "keywords": ["hooks", "episodic", "thinking", "output format", "consistency"],
      "applies_to": "area:hooks",
      "content": "## Hook Output Format Consistency\n\nFor both episodic (session-start) and thinking memory (user-prompt-submit) hooks:\n\n1. **user-prompt-submit.ts** already had the correct JSON format with `hookSpecificOutput.additionalContext`\n2. **session-start.ts** needed to be updated to match\n3. Both hooks provide memories with metadata and formatted content\n4. The JSON wrapper allows the plugin layer to properly inject memories into Claude's context\n\nWhen adding new hooks or modifying existing ones, always ensure they output structured JSON with the `hookSpecificOutput` wrapper for compatibility with the Claude Code plugin system."
    }
  ]
}
```
