---
id: dad27766-686f-488b-9a05-125ff5f9ac7b
subject: I have now completed both tasks. Let me summarize the findings for the user.
applies_to: global
occurred_at: '2025-12-02T11:44:09.198Z'
content_hash: f856b66062466b19
---
## Thought

I have now completed both tasks. Let me summarize the findings for the user.

## Output

Done. I've updated CLAUDE.md to reflect the SQLite migration.

## How Data is Loaded into SQLite

There are **three pathways** for data to enter the SQLite vector store:

### 1. On Memory Creation (immediate)
In `src/core/memory.ts:107-113`, when a memory is created via `MemoryManager.createMemory()`:
- Memory is written to disk as a markdown file
- Then immediately added to the vector store with `vectorStore.add(memory)`
- This generates an embedding and inserts into both `memories` and `memory_embeddings` tables

### 2. MCP Server Startup Sync (deferred)
In `src/mcp-server/server.ts:88-93`, the server runs an initial vector sync 2 seconds after startup:
```typescript
setTimeout(() => {
  runVectorSync()  // Calls vectorStore.sync(memories)
}, 2000);
```

The `sync()` method (`vector-store.ts:292-323`):
- Loads all file-based memories via `memoryManager.listMemories()`
- Compares with what's in the SQLite store
- Adds any missing memories, removes any orphaned entries

### 3. Periodic Background Sync
The MCP server also syncs every 10 minutes (`VECTOR_SYNC_INTERVAL_MS`) to catch any drift between files and SQLite.

### Summary
The SQLite store is populated:
- **Immediately** when memories are created
- **On startup** via initial sync
- **Periodically** (every 10 minutes) as a safety net

It's **not** a full reload every time - `sync()` does a delta comparison using `getStoredIds()` and only adds/removes what's changed.
