---
id: db9f72a3-55ec-4cba-8a26-0ff10396a05d
subject: >-
  Good, I updated the SearchEngine. The tests still use the legacy constructor
  `new...
applies_to: global
occurred_at: '2025-12-03T09:34:33.366Z'
content_hash: 7caf4a872164bef9
---
## Thought

Good, I updated the SearchEngine. The tests still use the legacy constructor `new SearchEngine(memoryManager)` which now sets `this.baseDir = config.memoryDir`. This is still a problem because the config might not be updated.

Actually, looking at the test more closely - the test sets `process.env['LOCAL_RECALL_DIR'] = testDir` before creating anything, but it doesn't call `loadConfig()` after setting the env var. So `getConfig()` might return a cached config with the wrong memoryDir.

The better fix is to make the SearchEngine extract the baseDir from the MemoryManager when using the legacy constructor. But MemoryManager doesn't expose its baseDir.

Let me think about this... The simplest fix for now is to update the test to pass the baseDir explicitly. But that's not ideal. A better approach is to have the SearchEngine use the MemoryManager's directory.

Actually, MemoryManager stores `this.baseDir` privately. Let me add a getter or make the SearchEngine smarter about this.

Actually, the cleanest fix is to make MemoryManager expose its baseDir (or have SearchEngine get it from config which should be updated).

Wait, looking at the test setup again:
```typescript
beforeEach(async () => {
  resetVectorStore();
  testDir = await fs.mkdtemp(...);
  process.env['LOCAL_RECALL_DIR'] = testDir;
  memoryManager = new MemoryManager(testDir);
  searchEngine = new SearchEngine(memoryManager);
});
```

The issue is that `getConfig()` returns a cached config. The env var is set, but `loadConfig()` isn't called to reload the config with the new env var.

The proper fix is to either:
1. Have the test call `loadConfig()` after setting the env var
2. Have the SearchEngine get the baseDir from the MemoryManager

Let me add a getter to MemoryManager so SearchEngine can use it. Or better yet, I can update the integration tests to be more explicit. But for the long-term fix, let me make MemoryManager expose its baseDir.

## Output

The issue is that when using the legacy constructor `SearchEngine(memoryManager)`, the SearchEngine doesn't know the MemoryManager's baseDir. Let me add a getter to MemoryManager and update SearchEngine to use it:
