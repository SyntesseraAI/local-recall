---
id: 81f1ab05-1fd9-4a3e-9c35-fc5d8ccd9d39
subject: >-
  I've read all the changed files. Now I understand the implementation: 1.
  **src/core/index.ts** -...
applies_to: global
occurred_at: '2025-11-29T21:29:15.217Z'
content_hash: ef3323f669f9339b
---
## Thought

I've read all the changed files. Now I understand the implementation:

1. **src/core/index.ts** - IndexManager class for managing keyword indexes. Has methods like `buildIndex()`, `getIndex()`, `refreshIndex()`, `getMemoryIdsByKeyword()`, etc.

2. **src/core/memory.ts** - MemoryManager class with CRUD operations. Key methods: `createMemory()` (idempotent with duplicate detection), `getMemory()`, `listMemories()`. Has `findDuplicate()` that uses `occurred_at` and `content_hash` for deduplication.

3. **src/core/types.ts** - TypeScript interfaces and Zod schemas. Key types include `Memory`, `MemoryFrontmatter`, `MemoryIndex`, `CreateMemoryInput`, `SearchResult`, etc. Notable fields: `occurred_at` (when the memory happened) and `content_hash` (for deduplication).

4. **src/hooks/stop.ts** - Stop hook that processes transcripts and creates memories. Parses JSONL transcript, extracts messages, calls `analyzeForMemories()` to get suggested memories, then creates them.

5. **src/index.ts** - Main entry point that exports all public APIs.

6. **src/mcp-server/tools.ts** - MCP tool definitions and handlers. Tools: `memory_create`, `memory_get`, `memory_search`, `memory_list`, `index_rebuild`. Uses singleton instances for managers.

7. **src/utils/markdown.ts** - Markdown utilities including `parseMarkdown()`, `serializeMemory()`, `extractKeywordsFromText()` (uses keyword-extractor library), `formatMemoryForDisplay()`.

8. **src/utils/transcript.ts** - Transcript parsing utilities. Key insight: **`analyzeForMemories()` stores ALL messages as memories without filtering or summarization**. 

The system's memory management approach emphasizes comprehensive content preservation. Every interaction is captured without filtering, ensuring a complete record of conversations. Deduplication prevents redundant entries using content hash and timestamp. Automatic keyword extraction enables efficient searching and indexing. The design prioritizes maintaining the full context of each message, including role-specific prefixes, to provide a rich, detailed memory storage mechanism.

## Output

Now I have a clear understanding of the implementation. Let me update the documentation.
