---
id: dbbf4d5e-8466-480f-ae71-0353a13641e2
subject: >-
  I need to rewrite the JsonlStore to handle multiple files. The key changes
  are: 1. Instead of a...
applies_to: global
occurred_at: '2025-12-21T18:16:00.322Z'
content_hash: 96f45549b7d55a0c
---
## Thought

I need to rewrite the JsonlStore to handle multiple files. The key changes are:

1. Instead of a single `filePath`, use a base directory and prefix (e.g., `episodic-` for `episodic-001.jsonl`, `episodic-002.jsonl`, etc.)
2. Load: Read all files in order (sorted by name)
3. Append: Check current file's entry count, if >= 500, create next file
4. Compaction: Rewrite all files, keeping 500 entries per file

Let me design the new interface:
- `baseDir` - Directory for all files
- `filePrefix` - Prefix for files (e.g., "episodic" for `episodic-001.jsonl`)
- `entriesPerFile` - Max entries per file (default 500)

File naming: `{prefix}-{###}.jsonl` where ### is zero-padded 3 digits (001, 002, etc.)

## Output

Now I'll rewrite the JsonlStore to support multi-file storage with 500 entries per file:
