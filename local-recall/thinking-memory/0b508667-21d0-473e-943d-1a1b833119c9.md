---
id: 0b508667-21d0-473e-943d-1a1b833119c9
subject: >-
  Looking at the code, I can see: 1. Lines 42-47: `extractThinkingFromBlocks`
  filters for blocks with...
applies_to: global
occurred_at: '2025-12-03T17:24:45.139Z'
content_hash: 7a656b638a9adf30
---
## Thought

Looking at the code, I can see:

1. Lines 42-47: `extractThinkingFromBlocks` filters for blocks with `type === 'thinking'` and joins multiple thinking blocks together with `\n`

2. Lines 78-79 in `AggregatedMessage`: There's a `thinkingParts: string[]` which is an array, indicating that multiple thinking parts can be collected

3. Lines 129-134: When processing each JSONL line, it extracts thinking content and pushes to `thinkingParts` array if there's content

4. Lines 145-146: When converting to final output, it joins all `thinkingParts` with `\n`

So YES, the code does handle multiple thinking blocks - they get collected into an array (`thinkingParts`) and then joined together. But let me verify if this is intentional or if in practice there are actually multiple thinking blocks per message.

The user is asking specifically if there can be multiple thinking blocks before a message. Looking at the code structure:
- `AggregatedMessage.thinkingParts` is an array of strings
- Multiple entries with the same `messageId` can each contribute thinking content
- All thinking parts are joined with newlines

So yes, the code supports multiple thinking blocks. But does Claude actually produce multiple thinking blocks in a single response? Let me check if there's test data or examples.

## Output

Yes, the code already handles multiple thinking blocks. Looking at the `AggregatedMessage` interface (lines 74-80):

```typescript
interface AggregatedMessage {
  messageId: string;
  timestamp: string;
  thinkingParts: string[];  // Array - can hold multiple thinking blocks
  textParts: string[];
}
```

The extraction logic at lines 133-134 pushes each thinking block found to the array:

```typescript
if (thinkingContent.trim()) {
  aggregated.thinkingParts.push(thinkingContent);
}
```

And at line 146, they're all joined together:

```typescript
const thinking = aggregated.thinkingParts.join('\n');
```

So **multiple thinking blocks before a message are already supported** - they get aggregated into `thinkingParts[]` and joined with newlines.

However, I'm not sure if Claude actually produces multiple thinking blocks in practice, or if this is defensive coding. Want me to check an actual transcript to see the real format?
