---
id: e645eef3-7fc1-4caf-b7ea-1d5997b727e2
subject: All done. Let me summarize what was implemented.
applies_to: global
occurred_at: '2025-12-03T09:00:08.877Z'
content_hash: e62134216454c689
---
## Thought

All done. Let me summarize what was implemented.

## Output

Done! Here's a summary of the changes:

**Thinking Extractor** (`src/core/thinking-extractor.ts`):
- Now extracts both thinking blocks AND their corresponding text output
- Skips tool-only responses (only captures responses with text output)
- Stores combined content as `## Thought\n\n{thinking}\n\n## Output\n\n{output}`

**Retrieval** (`src/hooks/user-prompt-submit-thinking.ts`):
- Changed from count-based (10 items) to **token-based** limiting
- Adds memories until hitting the token budget (default: 1000 tokens)
- Only includes memories above **similarity threshold** (default: 80%)

**Configuration** (`src/core/types.ts`, `src/utils/config.ts`):
- `thinkingMaxTokens` / `LOCAL_RECALL_THINKING_MAX_TOKENS` - default 1000
- `thinkingMinSimilarity` / `LOCAL_RECALL_THINKING_MIN_SIMILARITY` - default 0.8

**Documentation** (`CLAUDE.md`):
- Added "Thinking Memories" section explaining the format
- Added example showing how memories appear in context
- Updated configuration table with all new env vars

To reprocess existing transcripts with the new format, you'll need to reset thinking memories:
```bash
rm local-recall/thinking-processed-log.jsonl
rm -rf local-recall/thinking-memory/
```
