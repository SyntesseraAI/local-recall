---
id: 83e71d37-50e1-4e71-a28f-dbdd411b21ac
subject: >-
  Looking at the code: 1. `search.ts` uses `VectorStore` for semantic search,
  not `IndexManager` 2....
applies_to: global
occurred_at: '2025-12-01T18:24:40.323Z'
content_hash: b15ba3d745dead82
---
## Thought

Looking at the code:

1. `search.ts` uses `VectorStore` for semantic search, not `IndexManager`
2. `IndexManager` is used in:
   - `mcp-server/tools.ts` - for `index_rebuild` tool and stats
   - `hooks/stop.ts` - for refreshing index after creating memories  
   - `memory-extractor.ts` - need to check this

The IndexManager creates/maintains `index.json` which is a JSON keyword index. Now that we have `memory.sqlite` with:
- All memory metadata
- Vector embeddings for semantic search

The IndexManager and index.json seem redundant. We should:
1. Remove IndexManager usage from mcp-server/tools.ts
2. Remove IndexManager usage from hooks/stop.ts
3. Remove the index_rebuild MCP tool (or replace it with vector store sync)
4. Delete src/core/index.ts

But this is a bigger refactor. Let me first finish the SessionStart hook fix, then ask the user if they want me to do this larger cleanup.

## Output

You're right. Now that we have SQLite with vector embeddings, the `IndexManager` and `index.json` are redundant. Here's what I found:

**IndexManager is used in:**
- `src/mcp-server/tools.ts` - `index_rebuild` tool and stats
- `src/hooks/stop.ts` - refreshes index after creating memories
- `src/core/memory-extractor.ts` - imports it
- Tests

**Redundant with SQLite:**
- `index.json` stores keyword lookups → SQLite already has this
- `IndexManager.refreshIndex()` → `VectorStore.sync()` does this better
- The `index_rebuild` MCP tool → should become `vector_sync`

This is a larger refactor. Do you want me to:
1. First finish the current SessionStart fix and rebuild
2. Then remove IndexManager and consolidate to SQLite only

Or should I tackle both now? The IndexManager removal would touch:
- `src/core/index.ts` (delete)
- `src/mcp-server/tools.ts` (remove index_rebuild, use VectorStore)
- `src/hooks/stop.ts` (use VectorStore.sync instead)
- `src/index.ts` (remove export)
- Related tests
