---
id: 723e97ea-fa31-445c-920f-314484ff8a30
subject: >-
  The bundled hooks are importing `fastembed` directly. But the esbuild config
  marks `fastembed` and...
applies_to: global
occurred_at: '2025-12-03T11:12:45.706Z'
content_hash: 851c4a8ba386cae5
---
## Thought

The bundled hooks are importing `fastembed` directly. But the esbuild config marks `fastembed` and `onnxruntime-node` as external:

```
--external:fastembed --external:onnxruntime-node
```

This means the bundled scripts try to load the native `onnxruntime-node` module at runtime. When multiple processes load `onnxruntime-node` concurrently, it causes mutex errors - similar to the original sqlite-vec problem!

The fix was supposed to use the daemon architecture to avoid loading native modules directly in hooks. Let me check the current hook implementation to see if it's still loading the embedding service directly or using the daemon HTTP API:

## Output

Found it! The bundled hook imports `fastembed` directly. `onnxruntime-node` (which `fastembed` depends on) has native bindings that cause the **same mutex issue** as sqlite-vec when loaded by multiple concurrent processes.

Let me check if the hook is supposed to use the daemon HTTP API instead:
