---
id: 870e0e4f-549f-43be-ad4d-84c3e82d41d2
subject: >-
  The error message is clear now - it's an `AbortError: The operation was
  aborted` coming from the...
applies_to: global
occurred_at: '2025-11-30T15:08:44.762Z'
content_hash: 0ded3f7327b777d7
---
## Thought

The error message is clear now - it's an `AbortError: The operation was aborted` coming from the child_process module. This is happening despite the code having a manual timeout handler.

Looking at the code, I can see the issue. The code spawns a child process to call Claude CLI at line 48-50:

```javascript
const child = spawn('claude', args, {
  stdio: ['pipe', 'pipe', 'pipe'],
});
```

And then sets a manual timeout at lines 56-60:

```javascript
const timeoutId = setTimeout(() => {
  logger.hooks.warn('Claude CLI timed out for keyword extraction');
  child.kill('SIGTERM');
  safeResolve([]);
}, 30000);
```

The issue is that somewhere an AbortSignal is being passed to the spawn function, but I don't see it explicitly in this code. However, the error message mentions `abortChildProcess` from node's child_process module, which suggests that the Node.js process itself might be receiving an abort signal from elsewhere (perhaps from the parent Claude Code process when the hook times out).

Wait, looking at the stack trace more carefully:
- `abortChildProcess (node:child_process:750:27)` 
- `AbortSignal.onAbortListener (node:child_process:820:7)`

This suggests that somewhere an AbortSignal is being used. But I don't see it in this code directly. This might be:

1. Coming from the hooks.json timeout configuration
2. Coming from Claude Code's hook runner itself
3. An issue with how the promise is structured

Actually, looking at the code again, there's no `.catch()` on the Promise. The error says "by rejecting a promise which was not handled with .catch()". But the `callClaudeForKeywords` function returns a `new Promise((resolve) => {...})` and it never calls `reject()`, it always calls `resolve()` (via `safeResolve`).


I suspect the spawn initialization might have an unhandled error path. The error listener is attached after spawning, which means any initialization errors could slip through. This creates a potential race condition where errors occurring during process creation aren't properly captured. The AbortSignal seems to be triggering an unhandled rejection that's causing the entire operation to fail silently.

The root cause likely involves a timing issue with error handling and signal management in the child process creation. Without explicit error catching during spawn, Node.js is throwing an unhandled error that breaks the promise chain.

I'll investigate implementing more robust error handling strategies to prevent these silent failures. The proposed fixes involve comprehensive error trapping and potentially adjusting process spawn configuration to improve signal isolation.

## Output

I can see the error now. The `AbortError: The operation was aborted` is happening when spawning the Claude CLI process. This is an unhandled promise rejection from Node.js's child_process module.

The issue is that even though you have error handling for the child process events, if an AbortSignal triggers during the spawn operation itself, the error can propagate as an unhandled rejection. Let me also check the hooks.json timeout configuration:
