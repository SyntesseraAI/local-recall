---
id: bc337d58-01ee-4d1c-9b84-42853141b55e
subject: Now I understand the structure. The memory extraction happens in...
applies_to: global
occurred_at: '2025-12-01T18:09:40.958Z'
content_hash: 2e76257f199b90bd
---
Now I understand the structure. The memory extraction happens in `MemoryExtractor.processTranscript()` which calls `callClaudeCLIWithRetry()`. When Claude returns a rate limit message like "5-hour limit reached - resets [time]", I need to:

1. Detect this rate limit message in the response
2. Parse the reset time
3. Pause processing until reset time + 5 minutes
4. NOT mark the transcript as processed

The rate limit detection should happen either:
- In `callClaudeCLI()` - check the stdout for rate limit message
- In `parseClaudeResponse()` - check before trying to parse JSON
- In `processTranscript()` - check the response before processing

I think the best place is in `callClaudeCLIWithRetry()` or in a dedicated method that checks for rate limits. When a rate limit is detected, we should:
1. Throw a special RateLimitError with the reset time
2. In `processAllTranscripts()`, catch this error and pause until reset time + 5 minutes

Let me implement this:

1. Create a `RateLimitError` class with a `resetTime` property
2. Add a method to detect rate limit messages and parse the reset time
3. Update `callClaudeCLI()` or add a response check to detect rate limits
4. Update `processAllTranscripts()` to handle rate limits gracefully

Let me look at what the rate limit message format looks like. The user mentioned "5-hour limit reached - resets [time]". I need to handle this pattern.
