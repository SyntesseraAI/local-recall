---
id: 00255afd-23d7-4266-bc31-1160c0d1318a
subject: >-
  The user is experiencing a mutex error that's happening because both the MCP
  server's background...
applies_to: global
occurred_at: '2025-12-03T08:33:42.090Z'
content_hash: cbde3d9b6a8b029f
---
## Thought

The user is experiencing a mutex error that's happening because both the MCP server's background daemon (which processes transcripts) and the hooks are trying to access the same SQLite database (`memory.sqlite`) simultaneously. This is a classic database concurrency issue.

Looking at the thinking memories from previous sessions, this issue has been encountered before:
1. Both hooks and the MCP server daemon share the same `memory.sqlite` file
2. The `sqlite-vec` extension may have issues with concurrent access
3. When two processes try to open the same SQLite file with `better-sqlite3` and `sqlite-vec`, mutex errors can occur

The user is asking for:
1. A fix for this concurrency issue - possibly a retry mechanism
2. To also fix merge issues and ensure test, lint and typecheck are working

Let me first understand the current state of the code and then implement a solution. I should:
1. Look at how the database is being accessed
2. Add retry logic or busy timeout configuration
3. Run tests, lint, and typecheck to ensure everything works

Let me start by checking the current state of the codebase and understanding the database access patterns.

## Output

Yes, this is a database concurrency issue. Both the MCP server daemon and the hooks are trying to access the same `memory.sqlite` file simultaneously, and the `sqlite-vec` extension has issues with concurrent access.

Let me investigate and add a retry mechanism with proper busy timeout configuration.
