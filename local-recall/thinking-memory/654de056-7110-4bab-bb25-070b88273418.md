---
id: 654de056-7110-4bab-bb25-070b88273418
subject: >-
  The fix would be to deduplicate thinking and text parts. A simple approach is
  to use a Set or check...
applies_to: global
occurred_at: '2025-12-03T17:30:52.352Z'
content_hash: 7ea74fcf7f0acd95
---
## Thought

The fix would be to deduplicate thinking and text parts. A simple approach is to use a Set or check for duplicates before pushing. Let me suggest an edit.

## Output

Would you like me to add deduplication to prevent duplicate thinking blocks from being joined? The fix would be at lines 145-147:

```typescript
// Convert aggregated messages to thinking blocks
for (const aggregated of messageMap.values()) {
  // Deduplicate thinking and text parts (streaming can create duplicates)
  const uniqueThinking = [...new Set(aggregated.thinkingParts)];
  const uniqueText = [...new Set(aggregated.textParts)];
  
  const thinking = uniqueThinking.join('\n');
  const output = uniqueText.join('\n');
  // ...
}
```
